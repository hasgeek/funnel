{% set current_page = 'project' %}
{% extends "project_layout.html.jinja2" %}
{% block titleblock %}{{ project.title }}{%- endblock %}
{% from "baseframe/components.html.jinja2" import alertbox %}

{%- block pageheaders %}
  {% assets "css_leaflet" -%}
    <link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}" />
  {%- endassets -%}
  {%- if project.schedule_start_at %}
    <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Event",
      "name": {{ project.title|tojson }},
      "url": {{ project.url_for(_external=true)|tojson }},
      "startDate": {{ project.schedule_start_at_localized|tojson }},
      "endDate": {{ project.schedule_end_at_localized|tojson }},
      "eventStatus": "https://schema.org/EventScheduled",
      {% if project.primary_venue -%}
      "location": {
        "@type": "Place",
        "name": {{ project.primary_venue.title|tojson }},
        "address": {
          "@type": "PostalAddress",
          "streetAddress": {{ project.primary_venue.address1|tojson }},
          "addressLocality": {{ project.primary_venue.city|tojson }},
          "addressRegion": {{ project.primary_venue.state|tojson }},
          "postalCode": {{ project.primary_venue.postcode|tojson }},
          "addressCountry": {{ project.primary_venue.country|tojson }}
        }
      },
      "eventAttendanceMode": "https://schema.org/OfflineEventAttendanceMode",
      {%- else %}
      "location": {
        "@type": "VirtualLocation",
        "url": {{ project.url_for(_external=true)|tojson }}
      },
      "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
      {%- endif -%}
      {%- if project.bg_image.url %}
      "image": [
        "{{ project.bg_image }}"
       ],
      {% endif -%}
      "description": {{ project.tagline|tojson }},
      "organizer": {
        "@type": "Organization",
        "name": {{ project.profile.title|tojson }},
        "url": {{ project.profile.url_for(_external=true)|tojson }}
      }
    }
    </script>
  {%- endif -%}
{% endblock %}

{% block baseheadline %}
  <div class="mui--hidden-md mui--hidden-lg mui--hidden-xl">
    <div class="mobile-nav mui--z1">
      <a href="{{ url_for('index') }}" aria-label="{% trans %}Back to the project{% endtrans %}" class="mui--text-dark mobile-nav__icon" data-ga="Back to the project page">{{ faicon(icon='arrow-left', icon_size='title') }}</a>
    </div>
  </div>
  {% if project.features.tickets() or project.features.rsvp() %}
    <div class="project-footer mui--visible-xs-block mui--visible-sm-block">
      {{ registerblock(project) }}
    </div>
  {% endif %}
{% endblock %}

{% block base_content_inner %}
  {% if project.view_for('edit').is_available() and project.features.schedule_no_sessions() %}
    {{ alertbox('warning', gettext("This project will not be listed as it has no sessions in the schedule")) }}
  {% endif %}
  {% if project.view_for('view').is_available() and project.state.DRAFT %}
    <div class="alert alert--warning alert--dismissable">
      <a class="alert__close" href="javascript:void(0);" aria-label="{% trans %}Close{% endtrans %}">{{ faicon(icon='times', baseline=false, icon_size='title') }}</a>
      <p class="alert__text"><a href="{{ project.url_for('settings') }}">{% trans %}This project is not published. Visit settings to publish{% endtrans %} {{ faicon(icon='arrow-right') }}</a></p>
    </div>
  {% endif %}
  <div class="about project-section" id="about">
    <div class="about__details">{{ project.description }}</div>
    {%- if project.subprojects %}
      <hr class="mui-divider">
      <h2 class="mui--text-display1 mui--text-left mui--text-bold">{% trans %}Related events{% endtrans %}</h2>
      <ul class="grid grid-no-left-padding grid-no-right-padding">
        {% for subproject in project.subprojects %}
          <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6">
            <a href="{{ subproject.url_for() }}" class="clickable-card card" aria-label="{{ subproject.title }}" data-ga="View subproject">
              <div class="card__header">
                <div class="card__header__title">
                  <h3 class="mui--text-title card__title__heading">{{ subproject.title }}</h3>
                  <h4 class="mui--text-subhead card__title__heading">{{ subproject.datelocation }}</h4>
                </div>
              </div>
              {% if subproject.tagline %}
                <div class="card__body">
                  <p>{{ subproject.tagline }}</p>
                </div>
              {% endif %}
            </a>
          </li>
        {%- endfor -%}
      </ul>
    {%- endif %}
  </div>

  {% if featured_proposals.count() > 0 %}
    <div class="project-section" id="submissions">
      <h2 class="mui--text-headline project-section__headline mui--text-left">{% trans %}Submissions{% endtrans %}</h2>
      <ul class="mui-list--unstyled ">
        {% for proposal in featured_proposals %}
          <li>
            {{ proposal_card(proposal, full_width=true) }}
          </li>
        {%- endfor -%}
      </ul>
      <p class="mui--text-center"><a href="{{ project.url_for('view_proposals') }}" class="mui--text-subhead">{% trans %}See all{% endtrans %}</a></p>
    </div>
  {%- endif %}

  {% if project.featured_sessions  %}
    <div class="project-section" id="sessions" >
      <h2 class="mui--text-headline project-section__headline mui--text-left">{% trans %}Sessions{% endtrans %}</h2>
      <ul class="mui-list--unstyled">
        {% for session in project.featured_sessions %}
          {% if session.scheduled %}
            <li>
              <a class="card clickable-card card--shaped" href="{{ session.url_for() }}" aria-label="{{ session.title }}" data-ga="View session">
                <div class="card__body proposal-card proposal-card--fullwidth">
                  <div class="proposal-card__body">
                    <div class="proposal-card__body__details">
                      <h3 class="mui--text-subhead mui--text-bold zero-bottom-margin">{{ session.title }}</h3>
                      <p class="mui--text-body2 mui--text-light">{{ session.speaker }}</p>
                      {% if session.banner_image_url.url %}<img src="{{ session.banner_image_url }}" class="proposal-card__video-thumbnail">{%- endif %}
                      <div class="mui--text-light mui--text-body2 margin-bottom">{{ session.description.html|firstline|truncate(150) }}</div>
                      <p class="mui--text-body2 mui--text-light">{{ session.start_at|datetime }}</p>
                    </div>
                  </div>
                  {% if session.banner_image_url.url %}
                    <div class="proposal-card__video proposal-card__video--desktop"><img class="proposal-card__video__thumbnail" src="{{ session.banner_image_url }}"/></div>
                  {%- endif %}
                </div>
              </a>
            </li>
          {%- endif %}
        {%- endfor -%}
      </ul>
      {%- if project.schedule_state.PUBLISHED %}<p class="mui--text-left mui--clearfix"><a class="mui-btn mui-btn--raised mui-btn--accent" href="{{ project.url_for('schedule') }}">{% trans %}View Schedule{% endtrans %}</a></p>{%- endif %}
    </div>
  {%- endif %}

  {% if project.sessions_with_video|length > 0 %}
    <div class="project-section" id="videos">
      <h2 class="mui--text-headline project-section__headline mui--text-left">{% trans %}Videos{% endtrans %}</h2>
      <div class="grid grid-no-left-padding grid-no-right-padding">
        {% for session in project.sessions_with_video %}
          <div class="grid__col-xs-12 grid__col-sm-6">
            {{ video_thumbnail(session) }}
          </div>
        {% endfor %}
      </div>
    </div>
  {%- endif %}

  {% if project.hasjob_embed_url.url -%}
    <div class="project-section" id="related-jobs">
      <h2 class="mui--text-headline mui--text-left project-section__headline">{% trans %}Related jobs{% endtrans %}</h2>
      <div class="hasjob-embed" data-href="{{ project.hasjob_embed_url }}" {% if project.hasjob_embed_limit -%}data-jobpost-limit="{{ project.hasjob_embed_limit }}"{%- else %}data-jobpost-limit="8"{%- endif %}></div>
      <script src="{{ config['HASJOB_SERVER']|url_join('embed.js') }}" type="text/javascript"></script>
    </div>
  {%- endif %}

  {%- if project.primary_venue -%}
    <div class="project-section" id="venue">
      <h2 class="mui--text-headline mui--text-left project-section__headline">{% trans %}Venue{% endtrans %}</h2>
      <div class="mui--text-body2">
        <p class="zero-bottom-margin">{{ project.primary_venue.title }}</p>
        <p class="zero-bottom-margin">{{ project.primary_venue.address1 }}</p>
        <p class="zero-bottom-margin">{{ project.primary_venue.address2 }}</p>
        <p class="zero-bottom-margin">{{ project.primary_venue.city }}{% if project.primary_venue.city and  project.primary_venue.postcode %} - {{ project.primary_venue.postcode }}{%- endif %}</p>
        {%- if project.primary_venue.state and project.primary_venue.country -%}
          <p>{{ project.primary_venue.state }}, {{ project.primary_venue.country }}</p>
        {%- endif %}
      </div>
      {%- if project.primary_venue.has_coordinates -%}
        <div id="venue-map" class="project-section__map" data-label="{{ project.primary_venue.title|striptags }}" data-markerlat="{{ project.primary_venue.latitude }}" data-markerlng="{{ project.primary_venue.longitude }}"><h2>{% trans %}Loadingâ€¦{% endtrans %}</h2></div>
      {%- endif %}
    </div>
  {% elif project.view_for('venues').is_available() %}
    <div class="project-section">
      <p><a href="{{ project.url_for('venues') }}" class="mui-btn mui-btn--raised mui-btn--dark">{% trans %}Add venue{% endtrans %}</a></p>
    </div>
  {%- endif %}
{% endblock %}

{% block footerinnerscripts %}
  <script src="{{ url_for('static', filename=asset_path('project')) }}" type="text/javascript"></script>
  <script type="text/javascript">
    $(function() {
      var projectConfig = {};

      {%- if project.primary_venue.has_coordinates -%}
        projectConfig.venue = {
          mapId: "venue-map",
          latitude: {{ project.primary_venue.latitude|tojson }},
          longitude: {{ project.primary_venue.longitude|tojson }}
        };
      {%- endif %}

      window.Hasgeek.ProjectInit(projectConfig);
    });
  </script>
{% endblock %}
