{% extends "layout.html.jinja2" %}
{% from "baseframe/components.html.jinja2" import faicon %}
{%- from "macros.html.jinja2" import account_tabs %}

{% block title %}{% trans %}My contacts{% endtrans %}{% endblock %}

{% block bodytag %}
  {%- if not config['LEGACY'] -%}
    <body class="mui--bg-primary hg-app tabs-navbar">
  {%- else %}
    <body class="mui--bg-primary">
  {%- endif %}
{% endblock %}

{% block headline -%}
  <div class="tabs-wrapper tabs-wrapper--sticky">
    <div class="mui-container">
      <div class="grid">
        <div class="grid__col-12">
          {{ account_tabs(active_tab='contacts') }}
        </div>
      </div>
    </div>
  </div>
{%- endblock %}

{% block basecontent %}
  <div class="mui-container tab-content">
    <div class="grid">
      <div class="grid__col-xs-12 grid__col-sm-6">
        {% for project,dates in contacts %}
          <div class="tab-content__results zero-bottom-margin">
            <div class="collapsible__header collapsible__header--smaller mui--pull-left" role="button" aria-expanded="false" aria-controls="collapse-{{project.id}}">
              <p class="mui--text-subhead zero-bottom-margin collapsible__header__title">
                {{ faicon(icon='angle-right', css_class='collapsible__icon') }}
                {{ faicon(icon='angle-down', css_class='collapsible__icon mui--hide') }}
                {{ project.title }}
              </p>
            </div>
            <div class="collapsible__dropdown mui-dropdown mui--pull-right mui--align-middle">
              <button class="mui-btn mui-btn--nostyle mui--text-subhead" data-mui-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="{% trans %}Dropdown menu{% endtrans %}">{{ faicon(icon='ellipsis-v', icon_size='subhead') }}
              </button>
              <ul class="mui-dropdown__menu mui-dropdown__menu--right">
                <li>
                  <a href="{{ url_for('contacts_project_csv', uuid_b58=project.uuid_b58) }}" download aria-label="{% trans %}Download CSV{% endtrans %}">
                    {{ faicon(icon='download', icon_size='subhead') }} {% trans %}CSV{% endtrans %}
                  </a>
                </li>
              </ul>
            </div>
            <div class="collapsible__body mui-list--aligned" id="collapse-{{project.id}}">
              {% for daterow in dates %}
                <div class="collapsible">
                  <div class="collapsible__header collapsible__header--smaller mui--pull-left" role="button" aria-expanded="false" aria-controls="collapse-{{daterow.date}}">
                    <p class="mui--text-subhead zero-bottom-margin collapsible__header__title">
                      {{ faicon(icon='angle-right', css_class='collapsible__icon') }}
                      {{ faicon(icon='angle-down', css_class='collapsible__icon mui--hide') }} {{ daterow.date.isoformat()  }} ({{ daterow.count }})</span></p>
                  </div>
                  <div class="collapsible__dropdown mui-dropdown mui--pull-right mui--align-middle" id="collapse-{{daterow.date}}">
                    <button class="mui-btn mui-btn--nostyle mui--text-subhead" data-mui-toggle="dropdown" aria-haspopup="true" aria-expanded="false" aria-label="{% trans %}Dropdown menu{% endtrans %}">
                      {{ faicon(icon='ellipsis-v', icon_size='subhead') }}
                    </button>
                    <ul class="mui-dropdown__menu mui-dropdown__menu--right">
                      <li>
                        <a href="{{ url_for('contacts_project_date_csv', uuid_b58=project.uuid_b58, datestr=daterow.date) }}" download arial-label="{% trans %}Download contacts CSV{% endtrans %}" >
                          {{ faicon(icon='download', icon_size='subhead') }} {% trans %}CSV{% endtrans %}
                        </a>
                      </li>
                    </ul>
                  </div>
                  <div class="collapsible__body mui-list--aligned">
                    {% for contact in daterow.contacts.all() %}
                      <div class="user">
                        <div class="user__box">
                          <div class="user__box__gravatar user__box__gravatar--initials">{{ contact.participant.fullname|initials }}</div>
                          <div class="mui--clearfix">
                            <div class=" mui--pull-left">
                              <p class="mui--text-subhead zero-bottom-margin">{{ contact.participant.fullname }}</p>
                              <p class="mui--text-body2">{{ contact.participant.email }}</p>
                            </div>
                            <a class="mui--pull-right contact-download-btn" onclick="HasGeek.downloadVcard(this,'{{contact.participant.fullname}}', '{{contact.participant.email}}', '{{contact.participant.phone}}', '{{contact.participant.company}}')" download href="" aria-label="download contact">
                              {{ faicon(icon='address-card', icon_size='headline') }}
                            </a>
                          </div>
                        </div>
                      </div>
                    {%- endfor -%}
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- endfor -%}
      </div>
    </div>
  </div>
{% endblock %}

{% block footerscripts %}
  <script src="{{ url_for('static', filename=asset_path('contact')) }}" type="text/javascript"></script>
{% endblock %}
