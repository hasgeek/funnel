{% extends "layout.html.jinja2" %}
{% from "baseframe/forms.html.jinja2" import renderfield, renderform_inner, rendersubmit, ajaxform %}
{% from "password_login_form.html.jinja2" import passwordlogin %}
{% from "baseframe/components.html.jinja2" import faicon %}

{% block title %}{% trans %}Login{% endtrans %}{% endblock %}

{% block headline %}{% endblock %}

{% block content %}
  <div class="alert alert--error cookies-required-alert test alert--dismissable">
    <a class="alert__close" href="javascript:void(0);" aria-label="close">{{ faicon(icon='times', icon_size='title') }}</a>
    <p class="alert__text">{% trans %}Cookies are required to login. Please enable cookies in your browserâ€™s settings and reload this page.{% endtrans %}</p>
  </div>
  <div class="cookies-required mui-form mui-form--margins">
    <div><h2>
      {% trans %}Login with your existing account at any of these <small>(pick one)</small>{% endtrans %}
    </h2></div>
    <div>
      <p>
      {% for provider in login_registry %}
        <a class="mui-btn mui-btn--small mui-btn--raised login login-{{ provider }}" href="{{ url_for('login_service', service=provider, next=request.args.get('next')) }}" data-action="login using {{ provider }}" aria-label="login using {{ provider }}"><img src="{{ url_for('static', filename='img/' + login_registry[provider].icon + '.svg') }}" class="icon-img" alt="{{ login_registry[provider]['title'] }}" aria-label="hidden"/></i>{{ login_registry[provider]['title'] }}</a>
      {% endfor %}
      </p>
    </div>
    {%- for service, formdata in service_forms.items() %}{% with form = formdata['form'] %}
      <form id="form-{{ service }}" method="POST" class="jshidden" accept-charset="UTF-8">
        <input type="hidden" name="next" value="{{ formdata['next'] }}"/>
        {% if formdata['error'] %}<div class=error>{{ formdata['error'] }}</div>{% endif %}
        {{ renderform_inner(form, service) }}
        {{ rendersubmit([(None, "Login", 'btn-primary')], "small") }}
      </form>
    {%- endwith %}{% endfor %}
    <div id="passwordform">
      <h2 class="passwordform-heading">
        {% trans %}Or, login with a password{% endtrans %}
      </h2>
      <div class="grid__col-xs-12 grid__col-md-6 grid__col--bleed">
        {{ passwordlogin(loginform, Markup) }}
      </div>
    </div>
  </div>
{% endblock %}

{% block footerscripts %}
  {{ ajaxform('passwordlogin', request, True) }}
{% endblock %}
