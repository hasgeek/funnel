{% set current_page = 'updates' %}
{% extends "project_layout.html.jinja2" %}
{% from "baseframe/forms.html.jinja2" import renderfield, widgetscripts %}
{%- from "js/update.js.jinja2" import updates_template %}
{% block title %}{% trans %}Updates{% endtrans %}{% endblock %}


{% block base_content_inner %}
  <div class="project-section" id="updates">
    {% if project.features.post_update() -%}
      <a class="update-form-block" href="{{ project.url_for('new_update') }}" aria-label="{% trans %}Add new update{% endtrans %}" data-cy-btn="add-update">
        <div class="user">
          <div class="user__box">
            {{ useravatar(current_auth.user, add_profile_link=false) }}
            <input type="text" placeholder="{% trans %}Post an updateâ€¦{% endtrans %}" />
          </div>
        </div>
      </a>
    {%- endif %}
    {{ updates_template() }}
    {% if not project.published_updates -%}
      <p class="mui-panel mui--bg-accent">{% trans %}This project has not posted any updates yet.{% endtrans %}</p>
    {%- endif %}
  </div>
{% endblock %}

{% block footerinnerscripts %}
  <script src="{{ url_for('static', filename=asset_path('update')) }}" type="text/javascript"></script>
  <script type="text/javascript">
    $(function() {
      var updateConfig = {
        draft: {% if draft_updates -%} {{ draft_updates|tojson }} {%- else -%} [] {%- endif %},
        updates: {% if published_updates -%} {{ published_updates|tojson }} {%- else -%} [] {%- endif %},
        divElem: "#updates-wrapper",
        updateTemplate: '#update-template',
        isEditor: {{ project.features.post_update()|tojson }},
        addReadMore: true,
      };
      window.Hasgeek.UpdatesInit(updateConfig);
    });
  </script>
{% endblock %}
