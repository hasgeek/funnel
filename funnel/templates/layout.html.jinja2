{% extends "baseframe.html.jinja2" -%}
{% from "baseframe/components.html.jinja2" import hgtopnav with context %}

{%- block titletags %}
  <title>{% block title %}{{ title }}{% if config['SITE_TITLE'] %} â€” {{ config['SITE_TITLE'] }}{% endif %}{% endblock %}</title>
  <meta name="DC.title" content="{{ self.title()|e }}" />
  <meta property="og:title" content="{{ self.title()|e }}" />
  <link rel="preconnect" crossorigin href="https://fonts.googleapis.com/">
  <link rel="preconnect" crossorigin href="https://ajax.googleapis.com/">
  <link rel="preconnect" crossorigin href="https://imgee.s3.amazonaws.com/">
  <link rel="preconnect" crossorigin href="https://images.hasgeek.com/">
  <link rel="preconnect" crossorigin href="{{ url_for('static', filename='') }}">
  <link rel="preconnect" crossorigin href="{{ url_for('static', filename='') }}">
{%- endblock %}

{% block description %}{% if g.profile %}{{ g.profile.description|striptags }}{% endif %}{% endblock %}

{%- block layoutheaders %}
  {%- if not config['LEGACY'] -%}
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#816894">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="#816894">
  <meta name="apple-mobile-web-app-title" content="js">
  <link rel="icon" sizes="192x192" href="/static/img/android-chrome-192x192.png">
  <link rel="apple-touch-icon" href="/static/img/apple-touch-icon.png">
  {%- endif -%}
  {% block pageheaders %}{% endblock %}
{%- endblock %}

{% block sidedrawer -%}
{%- endblock %}

{% block header -%}
  {% macro site_title() %}
    {%- if g.profile -%}
      <a href="{{ url_for('index') }}" class="header__site-title__item">
        {%- if config['LEGACY'] -%}
          <img src="{{ url_for('static', filename='img/funnel-logo.png') }}" class="header__site-title__logo header__site-title__logo--funnel"/>
        {%- else -%} 
         <img src="{{ url_for('static', filename='img/hg-logo.png') }}" class="header__site-title__logo"/>
        {%- endif -%}
      </a><i class="material-icons mui--text-subhead mui--align-center">chevron_right</i>
      <a href="{{ g.profile.url_for() }}" class="header__site-title__item mui--text-dark">{{ g.profile.title }}</a>
      {%- if project %}
        {%- if project.parent_project %}
          <i class="material-icons mui--text-subhead mui--align-center">chevron_right</i>
          <a href="{{ project.parent_project.url_for() }}" class="header__site-title__item">{{ project.parent_project.short_title() }}</a>
        {%- endif %}
        <i class="material-icons mui--text-subhead mui--align-center">chevron_right</i>
        <a href="{{ project.url_for() }}" class="header__site-title__item">{{ project.short_title() }}</a>
      {%- endif %}
    {%- else -%}
      <a href="{{ url_for('index') }}" class="header__site-title__item">
        {%- if config['LEGACY'] -%}
          <img src="{{ url_for('static', filename='img/funnel-logo.png') }}" class="header__site-title__logo header__site-title__logo--margin header__site-title__logo--funnel"/>
        {%- else -%} 
         <img src="{{ url_for('static', filename='img/hg-logo.png') }}" class="header__site-title__logo header__site-title__logo--margin"/>
        {%- endif -%}
        {{ config['SITE_TITLE'] }}
      </a>
    {%- endif -%}
  {% endmacro %}
  {{ hgtopnav(site_title=site_title()) }}
{%- endblock %}

{% block bodytag %}<body class="mui--bg-primary">{% endblock %}

{% block contenthead %}
  {% block banner %}
  {% endblock %}
  {% block headline -%}
    <div class="content-head content-head--top-padding mui--bg-accent">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-xs-12">
            {% block top_title %}
            <h1 class="mui--text-display1">
              {{ self.title()|e }}
            </h1>
            {% endblock %}
          </div>
        </div>
      </div>
    </div>
  {%- endblock %}
{% endblock %}

{%- block baseheadline %}
  {% block ads %}
  {% endblock %}
{% endblock %}

{% block basecontent %}
  <div class="page-content">
    {% block contentwrapper %}
    <div class="grid">
      <div class="grid__col-xs-12">
        {% block content %}{% endblock %}
      </div>
    </div>
    {% endblock %}
  </div>
{% endblock %}

{% block footer %}
  {%- if not config['LEGACY'] -%}
  <div class="mui-container">
    <div class="grid mui--text-body2">
      <div class="grid__col-sm-6 mui--text-center">
        <p>{% if 'FOOTER_MESSAGE' in config %}{{ config['FOOTER_MESSAGE'] }}{% else %}{% trans %} Copyright &copy; 2010-19 HasGeek.  All rights reserved.{% endtrans %}{% endif %} <a href="/about/" title="about"><br>About us and site policies</a>.</p>
      </div>
      <div class="grid__col-sm-6 mui--text-center">
        <p>
          #2699, 19th Main, 5th Cross, Indiranagar HAL 2nd Stage, Bangalore - 560008, <a href="mailto:info@hasgeek.com" title="mailto">info@hasgeek.com</a>, <a href="tel:+917676332020" title="tel">+91 7676 33 2020</a>
        </p>
      </div>
      </div>
    </div>
  </div>
  {%- else -%}
    <span class="no-print">{% if 'FOOTER_MESSAGE' in config %}{{ config['FOOTER_MESSAGE'] }}{% else %}{% trans %}Copyright &copy; 2010-19 HasGeek{% endtrans %}{% endif %}</span>
  {%- endif -%}
{% endblock %}

{% block jquery -%}
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript">
  if (typeof jQuery === 'undefined') {
    var jqueryScript = document.createElement('script');
    jqueryScript.setAttribute('type','text/javascript');
    jqueryScript.setAttribute('src','{{ url_for("baseframe.static", filename="js/jquery-2.2.4.min.js") }}');
    document.head.appendChild(jqueryScript);
  }
</script>
{%- endblock %}

{% block layoutscripts %}
  <script src="{{ url_for('static', filename=asset_path('app')) }}" type="text/javascript"></script>
  {%- if not config['LEGACY'] -%}
  <script type="text/javascript">
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function() {
        navigator.serviceWorker.register('/service-worker.js')
        .then(function(registration) {
          console.log('Service Worker registration successful with scope: ',
          registration.scope);
        })
        .catch(function(err) {
          console.log('Service Worker registration failed: ', err);
        });
      });

      // Setup a listener to track Add to Homescreen events.
      window.addEventListener('beforeinstallprompt', event => {
        event.userChoice.then(choice => {
          if (window.ga) {
            window.ga('send', 'event', 'Add to Home', choice.outcome);
          }
        });
      });
    }
  </script>
  {%- endif -%}
  {% block footerscripts %}{% endblock %}
{% endblock %}
