{%- set banner_img = 1500 %}
{%- set profile_logo = 240 %}
{%- set profile_logo_small = 80 %}


{%- macro faicon(icon, icon_size='body', baseline=true, css_class='') -%}
  {% assets "fa5-sprite" %}<svg class="fa5-icon {%- if icon_size %} fa5-icon--{{icon_size}} {%- endif -%} {%- if baseline %} fa5--align-baseline {%- endif -%} {%- if css_class %} {{ css_class }} {%- endif -%}" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL|make_relative_url }}#{{icon}}"></use></svg>{% endassets %}
{%- endmacro %}

{%- macro alertbox(category, message="", dismissable=true, css_class='') %}
  <div class="alert alert--{{category}} {% if dismissable %}alert--dismissable{%- endif -%} {%- if css_class %} {{ css_class }} {%- endif -%}">
    {%- if dismissable %}
      <a class="alert__close" href="javascript:void(0);" aria-label="{% trans %}Close{% endtrans %}">
      {{ faicon(icon='times', icon_size='title', baseline=true) }}
      </a>
    {%- endif -%}
    <p class="alert__text">{{ message }}</p>
  </div>
{%- endmacro %}

{%- macro csrf_tag() %}
<input id="csrf_token" name="csrf_token" type="hidden" value="{{ csrf_token() }}">
{%- endmacro %}

{% macro project_title(project) %}
  {%- if project.short_title == project.title -%}
    {#- Project title is not an extension of profile title, so display profile title too -#}
    {{ project.profile.title }} › {{ project.title }}
  {%- else -%}
    {#- Project title derives from profile title, so profile is not needed. -#}
    {{ project.title }}
  {%- endif %}
{%- endmacro %}

{% macro calendarwidget(calendar, compact=true) %}
  <div class="card__calendar {% if compact %} card__calendar--compact {% endif %}" aria-hidden="true">
    <div class="calendar">
      {% set event = namespace(month='', year='', first_week='', previous='', next='') %}
      <div class="calendar__weekdays {% if calendar.weeks|length > 1 %} calendar__weekdays--rows {% endif %}">
        {% for week in calendar.weeks|sort(attribute='year') %}
          {% set event.previous = false %}
          {% set event.next = false %}
          {% if not event.first_week and week.upcoming %}
            {% set event.first_week = week %}
            {% if loop.index0 > 0 %}
              {% set event.previous = true %}
            {% endif %}
            {% if loop.index != calendar.weeks|length and calendar.weeks[loop.index].upcoming %}
              {% set event.next = true %}
            {% endif %}
          {% endif %}
          <p class="calendar__month {% if week.upcoming %}calendar__month--upcoming{% endif %} {% if event.first_week == week %}calendar__month--upcoming--first calendar__month--latest{% endif %} {% if week.month != event.month %}calendar__month--unique{% endif %} {% if loop.index == calendar.weeks|length and not week.upcoming %}calendar__month--latest{% endif %}"><span class="calendar__month__counting" data-today="{{ calendar.today }}" data-month="{{ week.month }}"></span><span class="calendar__month__name mui--text-light">{{ week.month }} {{ week.year }}</span></p>
          {% set event.month = week.month  %}
          {% set event.year = week.year  %}
          <div class="calendar__weekdays__dates {% if week.upcoming %}calendar__weekdays__dates--upcoming{% endif %} {% if event.first_week == week %}calendar__weekdays__dates--upcoming--first calendar__weekdays__dates--latest {% endif %} {% if loop.index == calendar.weeks|length and not week.upcoming %}calendar__weekdays__dates--latest {% endif %}"  data-month="{{ week.month }}">
            <p class="calendar__weekdays__dates__date calendar__weekdays__dates__icon calendar__weekdays__dates__icon--left">
              {% if event.previous %}{{ faicon(icon='chevron-left', icon_size='caption', baseline=false, css_class='calendar__weekdays__dates__icon__next') }}{% endif %}
            </p>
            {% for date in week.dates %}
              <p class="calendar__weekdays__dates__date {% if date.count > 0 %}calendar__weekdays__dates__date--active {% elif date.isoformat == calendar.today %} calendar__weekdays__dates__date--today{% endif %} {% if date.day_start_at %} calendar__weekdays__dates__date--showtime{% endif %} {% if date.isoformat >= calendar.today %} calendar__weekdays__dates__date--latest{% endif %} calendar__weekdays__dates__date--{{ loop.index }}" {% if date.count > 0 %} data-event-date="{{ date.isoformat }}" {% endif %} data-event-month="{{ week.month }}">
                <span class="calendar__weekdays__dates__date__day">{{ date.day }}</span>
                <span class="calendar__weekdays__dates__date__name">{{ calendar.days[loop.index-1] }}</span>
                {% if date.day_start_at %}<span class="calendar__weekdays__dates__time">{{ date.day_start_at }} – {{ date.day_end_at }}</span>{% endif %}
              </p>
            {% endfor %}
            <p class="calendar__weekdays__dates__date calendar__weekdays__dates__icon calendar__weekdays__dates__icon--right">
              {% if event.next  %}{{ faicon(icon='chevron-right', icon_size='caption', baseline=false, css_class='calendar__weekdays__dates__icon__next') }}{% endif %}
            </p>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro saveprojectform(project, iconsize='body', formid='save-form') %}
  <form id="{{ formid }}" class="js-save-form" action="{{ project.url_for('save') }}" method="POST">
    {{ current_view.SavedProjectForm().hidden_tag() }}
    <div class="bookmark-wrapper">
      {%- if current_auth.is_anonymous %}
        <a class="mui--text-light"  href="{{ url_for('login', next=request.path) }}" data-ga="Login to save project" aria-label="{% trans %}Login to save this project{% endtrans %}">{{ faicon(icon='bookmark', baseline=true, icon_size=iconsize, css_class='mui--text-light') }}</a>
      {%- else %}
        <input type="hidden" name="save" value="">
        <button type="submit" value="true" class="mui-btn mui-btn--nostyle animate-btn {% if not project.is_saved_by(current_auth.user) %} animate-btn--show {% endif %}" data-ga="Save this project" onclick="this.form.save.value=this.value" data-cy="bookmark" aria-label="{% trans %}Save this project{% endtrans %}">{{ faicon(icon='bookmark', baseline=true, icon_size=iconsize, css_class='mui--text-light') }}
        </button>
        <button type="submit" value="false" class="mui-btn mui-btn--nostyle animate-btn animate-btn--saved{% if project.is_saved_by(current_auth.user) %} animate-btn--show {% endif %}" data-ga="Unsave this project" onclick="this.form.save.value=this.value" data-cy="bookmarked" aria-label="{% trans %}Unsave this project{% endtrans %}">{{ faicon(icon='bookmark-solid', baseline=true, icon_size=iconsize, css_class='bookmarked') }}</button>
      {%- endif %}
    </div>
  </form>
{% endmacro %}

{% macro share_dropdown(url, title, css_class='') %}
  <ul class="mui-dropdown__menu mui-dropdown__menu--right mui-dropdown__menu--hg-link {% if css_class %}{{ css_class }}{%- endif %}" data-cy="share-dropdown">
    <li><a class="mui--text-body2 js-copy-link" href="javascript:void(0)" data-ga="Copy link to share" role="menuitem">{{ faicon(icon='copy', baseline=true, css_class='mui--text-light fa-icon--right-margin') }}{% trans %}Copy link{% endtrans %}<span class="js-copy-url" aria-hidden="true">{{ url}}?utm_campaign=webshare</span></a></li>
    <li><a class="mui--text-body2" href="mailto:?subject={{ title }}&amp;body={{ url }}&amp;utm_campaign=share-email" data-ga="Email" role="menuitem">{{ faicon(icon='envelope', baseline=true, css_class='mui--text-light fa-icon--right-margin') }}{% trans %}Email{% endtrans %}</a></li>
    <li><a class="mui--text-body2" target="_blank" rel="noopener" href="//twitter.com/share?url={{ url }}&amp;via=Hasgeek&amp;text={{ title }}&amp;utm_campaign=share-twitter" data-url="{{ url }}" data-via="Hasgeek" data-text="{{ title }}" data-ga="Tweet" role="menuitem">{{ faicon(icon='twitter-square', baseline=true, css_class='mui--text-light fa-icon--right-margin') }}{% trans %}Twitter{% endtrans %}</a></li>
    <li><a class="mui--text-body2" target="_blank" rel="noopener" href="//www.facebook.com/sharer.php?u={{ url }}&amp;t={{ title }}&amp;utm_campaign=share-facebook" data-href="{{ url }}" data-ga="Share on facebook" role="menuitem">{{ faicon(icon='facebook-square', baseline=true,css_class='mui--text-light fa-icon--right-margin') }}{% trans %}Facebook{% endtrans %}</a></li>
    <li><a class="mui--text-body2" href="https://www.linkedin.com/shareArticle?mini=true&url={{ url }}&title={{ title }}&amp;utm_campaign=share-linkedin" data-ga="Share on linkedin" role="menuitem">{{ faicon(icon='linkedin', baseline=true, css_class='mui--text-light fa-icon--right-margin') }}{% trans %}LinkedIn{% endtrans %}</a></li>
  </ul>
{% endmacro %}

{% macro embed_video_player(video) %}
  {% if video.source != 'raw' %}
    <iframe src="{{ video.embeddable_url }}" frameborder="0" allowfullscreen></iframe>
  {% else %}
    <p class="video_txt">
      {{ faicon(icon='video', icon_size='display1') }}<br>
      <a href="{{ video.id }}" target="_blank" rel="noopener" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
    </p>
  {%- endif %}
{% endmacro %}

{% macro video_action_bar(video, proposal='', session='', share=true) %}
  {%- if video.source == 'youtube' -%}
    <p class="zero-bottom-margin mui--pull-left"><a href="https://videoken.com" target="_blank" rel="noopener" class="mui--text-caption details__box__control__link">Powered by VideoKen</a></p>
  {%- endif %}

  {%- if proposal and proposal.current_roles.editor %}
    <a class="details__box__control__link mui--text-subhead" href="{{ proposal.url_for('edit') }}#field-video" data-cy="edit-video" aria-label="{% trans %}Edit submission video{% endtrans %}">{{ faicon(icon='edit', icon_size='subhead', css_class='fa5--link') }}</a>
  {% elif session and session.project.current_roles.editor %}
    <a class="details__box__control__link mui--text-subhead" href="{{ session.url_for('edit') }}" data-cy="edit-video" aria-label="{% trans %}Edit session video{% endtrans %}">{{ faicon(icon='edit', icon_size='subhead', css_class='fa5--link') }}</a>
  {%- endif %}

  {%- if share and (proposal or session) %}
    {%- if proposal %}
      {% set url, title = proposal.url_for(_external=true), proposal.title  %}
    {% else %}
      {% set url, title = session.url_for(_external=true), session.title %}
    {%- endif %}
    <a href="javascript:void(0)" class="details__box__control__link mui--text-subhead hg-link-btn mui--hide" data-ga="Share dropdown" data-cy="share-project" data-url="{{ url }}?utm_campaign=webshare" aria-label="{% trans %}Share{% endtrans %}">{{ faicon(icon='share-alt', icon_size='subhead') }}</a>
    <div class="mui-dropdown">
      <a href="javascript:void(0)" class="details__box__control__link mui--text-subhead project-links" data-mui-toggle="dropdown" data-ga="Share dropdown" data-cy="share-project" role="button" aria-haspopup="true" aria-expanded="false" aria-label="{% trans %}Share{% endtrans %}">{{ faicon(icon='share-alt', icon_size='subhead') }}</a>
      {{ share_dropdown(url, title) }}
    </div>
  {%- endif %}
{% endmacro %}

{% macro account_tabs(active_tab='account') %}
  <div class="tabs" id="jquery-scroll-tabs">
    <a {% if active_tab != 'account' %}href="{{ url_for('account') }}"{%- endif %} class="tabs__item mui--text-body2 {% if active_tab == 'account' %}tabs__item--active{%- endif %}">{% trans %}Account{% endtrans %}</a>
    <a {% if active_tab != 'organizations' %}href="{{ url_for('organizations') }}"{%- endif %} class="tabs__item mui--text-body2 {% if active_tab == 'organizations' %}tabs__item--active{%- endif %}">{% trans %}Organizations{% endtrans %}</a>
    <a {% if active_tab != 'notification_preferences' %}href="{{ url_for('notification_preferences') }}"{%- endif %} class="tabs__item mui--text-body2 {% if active_tab == 'notification_preferences' %}tabs__item--active{%- endif %}">{% trans %}Notifications{% endtrans %}</a>
    <a {% if active_tab != 'saved' %}href="{{ url_for('saved') }}"{%- endif %} class="tabs__item mui--text-body2 {% if active_tab == 'saved' %}tabs__item--active{%- endif %}">{% trans %}Saved projects{% endtrans %}</a>
    <a {% if active_tab != 'scan' %}href="{{ url_for('scan_contact') }}"{%- endif %} class="tabs__item mui--text-body2 {% if active_tab == 'scan' %}tabs__item--active{%- endif %}">{% trans %}Scan badge{% endtrans %}</a>
    <a {% if active_tab != 'contacts' %}href="{{ url_for('contacts') }}"{%- endif %} class="tabs__item mui--text-body2 {% if active_tab == 'contacts' %}tabs__item--active{%- endif %}">{% trans %}Contacts{% endtrans %}</a>
  </div>
{% endmacro %}

{% macro projectcard(project, include_calendar=true, calendarwidget_compact=true, save_form_id_prefix='spf_') %}
  <a class="card card--upcoming clickable-card" href="{{ project.url_for() }}" aria-label="{{ project.title }}" data-cy-title="{{ project.title }}" data-ga="View project">
    <div class="card__image-wrapper {% if not project.bg_image.url %}card__image-wrapper--default{% endif %}">
      {% if project.bg_image.url %}
        <img class="card__image js-lazyload-img" data-src="{{ project.bg_image.resize(banner_img) }}" alt="{{ project.title }}"/>
        <noscript>
          <img class="card__image" src="{{ project.bg_image.resize(banner_img) }}" alt="{{ project.title }}"/>
        </noscript>
      {% else %}
        <img class="card__image" src="{{ url_for('static', filename='img/default-banner.png') }}" alt="{{ project.title }}"/>
        <p class="card__image__tagline mui--text-body2">{{ project.title }}</p>
      {% endif %}
    </div>
    <div class="card__body">
      {%- if not current_auth.is_anonymous and not include_calendar %}
        {% set save_form_id = save_form_id_prefix + project.uuid_b58 %}
        <div class="card__body__bookmark card__body__bookmark--pushup">{{ saveprojectform(project, formid=save_form_id) }}</div>
      {% endif %}
      {%- if include_calendar%}
        {% if calendarwidget_compact and project.start_at and project.calendar_weeks_compact.weeks and project.calendar_weeks_compact.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_compact) }}
          </div>
        {% elif project.start_at and project.calendar_weeks_full.weeks and project.calendar_weeks_full.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_full, compact=false) }}
          </div>
        {% endif %}
        <h3 class="card__body__title mui--text-subhead {% if not project.start_at %} card__body__subtitle {% endif %}"><span class="mui--text-bold">{{ project.title_inline }}</span> <span class="mui--text-light js-truncate" data-truncate-lines="2">{{ project.tagline }}</span></h3>
        <p class="card__body__location mui--text-light">{% if project.primary_venue %}{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}{% elif project.location %}{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {{ project.location }}{% endif %}</p>
        {%- if not current_auth.is_anonymous %}
          {% set save_form_id = save_form_id_prefix + project.uuid_b58 %}
          <div class="card__body__bookmark card__body__bookmark--pushup">{{ saveprojectform(project, formid=save_form_id) }}</div>
        {% endif %}
      {% else %}
        <h3 class="card__body__subtitle mui--text-subhead mui--text-bold">{{ project.title }}</h3>
        <p class="mui--text-caption mui--text-light js-truncate" data-truncate-lines="2">{{ project.tagline }}</p>
        {% if project.cfp_end_at_localized %}
          <hr class="separator">
          <p class="mui--text-caption zero-bottom-margin secondary-color-txt"><em>{% trans date=project.cfp_end_at_localized|datetime(format='dd MMM YYYY, hh:mm a') %}Submissions close {{ date }}{% endtrans %}</em></p>
        {% endif %}
      {% endif %}
    </div>
  </a>
{% endmacro %}

{% macro featured_section(featured_project) %}
  {% if featured_project %}
    {% with current_sessions = featured_project.current_sessions() if
    featured_project is not none else none %}
    {% if current_sessions and current_sessions.sessions|length > 0 %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">
              {% if not featured_project.livestream_urls and current_sessions.sessions|length > 0 %}
                {% trans %}Live schedule{% endtrans %}
              {% elif featured_project.livestream_urls and not current_sessions.sessions|length > 0 %}
                {% trans %}Livestream{% endtrans %}
              {% elif featured_project.livestream_urls and current_sessions.sessions|length > 0 %}
                {% trans %}Livestream and schedule{% endtrans %}
              {% endif %}
            </h2>
          </div>
          <div class="grid__col-xs-12">
            <div class="card card--spotlight card--spotlight--live">
              <div class="card__image-wrapper">
                {% if featured_project.bg_image.url %}
                  <img class="card__image" src="{{ featured_project.bg_image.resize(banner_img) }}" alt="{{ featured_project.title }}"/>
                {% else %}
                  <img class="card__image" src="{{ url_for('static', filename='img/default-banner.png') }}" alt="{{ featured_project.title }}"/>
                  <p class="card__image__tagline">{{ featured_project.title }}</p>
                {% endif %}
              </div>
              <div class="card__body">
                <h3 class="card__body__title mui--text-headline mui--text-bold zero-top-margin">
                  <a class="clickable-card" href="{{ featured_project.url_for() }}">{{ featured_project.title }}</a>
                </h3>
                <p class="mui--text-title mui--text-bold primary-color-txt zero-bottom-margin">Live</p>
                {% if current_sessions.sessions|length > 0 %}
                  <p class="mui--text-subhead mui--text-light">{{ faicon(icon='clock') }} {% trans session=current_sessions.sessions[0].start_at_localized|time %}Session starts at {{ session }}{% endtrans %}</p>
                {% endif %}
                <div>
                  {%- if featured_project.livestream_urls %}
                    <a class="mui-btn mui-btn--primary mui-btn--raised" aria-label="{% trans %}Watch livestream{% endtrans %}" href="{{ featured_project.url_for() }}">{% trans %}Livestream{% endtrans %}</a>
                  {%- endif %}
                  {%- if current_sessions.sessions|length > 0 %}
                    <a class="mui-btn mui-btn--primary mui-btn--raised" href="{{ featured_project.url_for('schedule') }}">{% trans %}Schedule{% endtrans %}</a>
                  {%- endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
    {% endwith %}

    <div class="projects-wrapper">
      <div class="spotlight">
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Spotlight{% endtrans %}</h2>
            </div>
          </div>
        </div>
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              <a class="card card--spotlight clickable-card" href="{{ featured_project.url_for() }}" aria-label="{{ featured_project.title }}" data-cy="spotlight-project" data-ga="View spotlight project">
                <div class="card__image-wrapper">
                  {% if featured_project.bg_image.url %}
                    <img class="card__image" src="{{ featured_project.bg_image.resize(banner_img) }}" alt="{{ featured_project.title }}"/>
                  {% else %}
                    <img class="card__image" src="{{ url_for('static', filename='img/default-banner.png') }}" alt="{{ featured_project.title }}"/>
                    <p class="card__image__tagline">{{ featured_project.title }}</p>
                  {% endif %}
                </div>
                <div class="card__body">
                  <h3 class="card__body__title mui--text-headline mui--text-bold">{{ featured_project.title }}</h3>
                  {% if featured_project.tagline %}
                  <p class="card__body__subtitle mui--text-subhead zero-top-margin js-truncate mui--text-light" data-truncate-lines="3">{{ featured_project.tagline }}</p>
                  {% endif %}
                  {% if featured_project.calendar_weeks_compact.weeks and featured_project.calendar_weeks_compact.weeks|length > 0 %}
                    <div aria-label="{{ featured_project.datelocation }}">
                      {{ calendarwidget(featured_project.calendar_weeks_compact) }}
                    </div>
                  {% endif %}
                  {% if featured_project.primary_venue %}
                    <p class="card__body__location mui--text-light">{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {{ featured_project.primary_venue.title }}{% if featured_project.primary_venue.city %}, {{ featured_project.primary_venue.city }}{% endif %}</p>
                  {% elif featured_project.location %}
                    <p class="card__body__location mui--text-light">{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {{ featured_project.location }}</p>
                  {% endif %}
                  {%- if not current_auth.is_anonymous %}
                    {% set save_form_id = "featured_" + featured_project.uuid_b58 %}
                    <div class="card__body__bookmark">
                      {{ saveprojectform(featured_project, formid=save_form_id) }}
                    </div>
                  {% endif %}
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro upcoming_section(upcoming_projects) %}
  {% if upcoming_projects|length > 0 %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Upcoming{% endtrans %}</h2>
          </div>
        </div>
        <ul class="mui-list--unstyled grid upcoming" role="list">
          {% for project in upcoming_projects %}
          <li class="grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
            {{ projectcard(project, save_form_id_prefix='upcoming_spf_') }}
          </li>
          {%- endfor -%}
        </ul>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro open_cfp_section(open_cfp_projects) %}
  {% if open_cfp_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Accepting submissions{% endtrans %}</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in open_cfp_projects %}
            <li class="grid__col-xs-12 grid__col-sm-4 grid__col-lg-3 js-cfp-projects {% if loop.index > 4 %}mui--hide{% endif %}"
              role="listitem">
              {{ projectcard(project, include_calendar=false, save_form_id_prefix='open_spf_') }}
            </li>
          {%- endfor -%}
        </ul>
        {% if open_cfp_projects|length > 4 %}
          <div class="mui--text-center">
            <a href="javascript:void(0)" data-target="show all cfp projects" class="jquery-show-all mui--text-uppercase" data-projects="js-cfp-projects" data-ga="Show all cfp projects" aria-expanded="true">{% trans %}Show more{% endtrans %}</a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro all_projects_section(all_projects) %}
  {% if all_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}All projects{% endtrans %}</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in all_projects %}
            <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
              {{ projectcard(project, save_form_id_prefix='all_spf_') }}
            </li>
          {%- endfor -%}
        </ul>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro profile_admin_buttons(profile) %}
  <div class="mui-dropdown mui--d-inlineblock">
    <a href="javascript:void(0)" class="mui--text-title mui-btn profile-dropdown-btn" data-mui-toggle="dropdown" data-ga="Open profile menu" data-cy="admin-dropdown" aria-label="{% trans %}Profile menu{% endtrans %}" role="button" aria-haspopup="true" aria-expanded="false">{{ faicon(icon='ellipsis-v', icon_size='title', baseline=false) }}</a>
    <ul class="mui-dropdown__menu mui-dropdown__menu--right" role="menu" aria-labelledby="profile-edit-menu">
      {%- if profile.organization %}<li><a href="{{ profile.urls['members'] }}" data-cy-btn="profile-crew">{%- if profile.current_roles.owner %}{% trans %}Manage admins{% endtrans %}{% else %}{% trans %}View admins{% endtrans %}{% endif %}</a></li>{% endif %}
      <li><a href="{{ profile.url_for('edit') }}" data-cy-btn="edit-details">{% trans %}Edit this profile{% endtrans %}</a></li>
      {%- if profile.features.make_private() %}<li><a href="#make-private-modal" rel="modal:open" role="button" aria-haspopup="true">{% trans %}Make profile private{% endtrans %}</a></li>{% endif %}
    </ul>
  </div>
  <div class="modal" id="make-private-modal" role="dialog" aria-labelledby="profile-private-modal-title" aria-modal="true" tabindex="-1">
    <div class="modal__header">
      <a class="mui-btn mui-btn--nostyle modal__close mui--text-dark" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close" href="javascript:void(0);" role="button" tabindex="0">{{ faicon(icon='times', baseline=false, icon_size='title') }}</a>
      <p class="mui--text-title mui--text-bold mui--text-dark" id="profile-private-modal-title">{% trans %}Make this profile private?{% endtrans %}</p>
    </div>
    <div class="modal__body">
      <ul class="mui-list--aligned mui--text-body2">
        <li>{% trans %}Your profile will not be visible to anyone other than you{% endtrans %}</li>
        <li>{% trans %}It will not be listed in search results{% endtrans %}</li>
        <li>{% trans %}You cannot host projects from this profile{% endtrans %}</li>
        <li>{% trans %}Any existing projects will become inaccessible until the profile is public again{% endtrans %}</li>
      </ul>
      <form action="{{ profile.url_for('transition') }}" method="post">
        {{ profile.forms.transition().hidden_tag() }}
        <button name="transition" value="make_private" class="mui-btn mui-btn--accent mui--pull-right mui-btn--flat">{% trans %}Make private{% endtrans %}</button>
      </form>
    </div>
  </div>
{% endmacro %}

{% macro profile_header(profile, class='', current_page='profile') %}
  <div class="mui-container {% if class %}{{ class }}{% endif %}">
    <div class="profile">
      <div class="profile__banner">
        <div class="profile__banner__box">
          {%- if profile.banner_image_url.url %}
            <img class="profile__banner__box__img" src="{{ profile.banner_image_url.resize(banner_img) }}" alt="{{ profile.title }}" data-cy="profile-banner-img"/>
          {% else %}
            <img class="profile__banner__box__img profile__banner__box__img--default" src="{{ url_for('static', filename='img/default-banner-profile.png') }}" alt="{{ profile.title }}"/>
          {% endif %}
        </div>
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              {%- if profile.current_roles.admin %}
                <a href="{{ profile.url_for('update_banner') }}" class="mui-btn mui-btn--default mui-btn--raised profile__banner__upload js-modal-form" aria-label="{% trans %}Add cover photo url{% endtrans %}" data-cy="add-banner" rel="modal:open" data-hash="edit_banner" aria-haspopup="true">{{ faicon(icon='camera', icon_size='body2', css_class='profile__banner__icon') }} <span class="mui--hidden-xs mui--hidden-sm">{% trans %}Add cover photo{% endtrans %}</span></a>
              {% endif %}
              <div class="profile__logo">
                {%- if profile.logo_url.url %}
                  <img class="profile__logo__img" src="{{ profile.logo_url.resize(profile_logo) }}" alt="{{ profile.title }}"/>
                {% else %}
                  <span class="profile__logo__nologo">{{ faicon(icon='user-solid', css_class='profile__logo__icon') }}</span>
                {% endif %}
                {%- if profile.current_roles.admin %}
                  <a href="{{ profile.url_for('update_logo') }}" class="profile__logo__upload mui--text-dark js-modal-form" rel="modal:open" data-hash="edit_logo" role="button" aria-haspopup="true">{{ faicon(icon='camera', baseline=false, icon_size='body2', css_class='profile__logo__upload__icon') }}</a>
                {% endif %}
                <div class="mui--hidden-xs mui--hidden-sm profile__logo__details">
                  <h2 class="mui--text-dark mui--text-bold zero-bottom-margin"><a class="mui--text-dark" data-cy="profile-title" href="{{ profile.url_for() }}">{{ profile.title }}</a></h2>
                  <p class="mui--text-title mui--text-light">@{{ profile.name }}</p>
                </div>
              </div>
              <div class="profile__banner__btns mui--hidden-xs mui--hidden-sm">
                {% if profile.features.new_project()  %}
                  <a class="mui-btn mui-btn--primary mui-btn--raised profile-create-btn" href="{{ profile.url_for('new_project') }} ">{{ faicon(icon='plus', icon_size='caption') }}  {% trans %}New project{% endtrans %}</a>
                {% elif profile.features.make_public() %}
                  <a class="mui-btn mui-btn--raised mui-btn--primary" href="#make-public-modal" rel="modal:open" role="button" aria-haspopup="true">{% trans %}Make profile public{% endtrans %}</a>
                  <div class="modal" id="make-public-modal" role="dialog" aria-labelledby="profile-public-modal-title" aria-modal="true" tabindex="-1">
                    <div class="modal__header">
                      <a class="modal__close mui--text-dark" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close" href="javascript:void(0);" role="button" tabindex="0">{{ faicon(icon='times', baseline=false, icon_size='title') }}</a>
                      <p class="mui--text-title mui--text-bold mui--text-dark" id="profile-public-modal-title">{% trans %}Make this profile public?{% endtrans %}</p>
                    </div>
                    <div class="modal__body">
                      <ul class="mui-list--aligned mui--text-body2">
                        <li>{% trans %}Your profile will be visible to anyone visiting the page{% endtrans %}</li>
                        <li>{% trans %}Your profile will be listed in search results{% endtrans %}</li>
                        {#- <li>{% trans %}You can host projects{% endtrans %}</li> #}
                      </ul>
                      <form action="{{ profile.url_for('transition') }}" method="post">
                        {{ profile.forms.transition().hidden_tag() }}
                        <button name="transition" value="make_public" class="mui-btn mui-btn--accent mui-btn--flat mui--pull-right">{% trans %}Make public{% endtrans %}</button>
                      </form>
                    </div>
                  </div>
                {% endif %}
                {%- if profile.current_roles.admin %}
                  <div class="mui--d-inlineblock">{{ profile_admin_buttons(profile) }}</div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mui-container profile-details {% if class %}{{ class }}{% endif %}">
    <div class="grid">
      <div class="grid__col-12">
        <div class="mui--hidden-md mui--hidden-lg mui--hidden-xl">
          <h2 class="mui--text-bold zero-bottom-margin" data-cy="profile-title"><a href="{{ profile.url_for() }}" class="mui--text-dark">{{ profile.title }}</a></h2>
          <p class="mui--text-title mui--text-light">@{{ profile.name }}</p>
        </div>
        <ul class="bullet-separated-list">
          <li class="">{{ faicon(icon='history') }} {% trans date=profile.owner.created_at|date(format='MMM YYYY')%}Joined {{ date }}{% endtrans %}</li>
          {% if profile.website %}
            <li><a href="{{ profile.website }}" target="_blank" rel="noopener nofollow">{{ faicon(icon='globe') }} {{ profile.website|cleanurl }}</a></li>
          {% endif %}
        </ul>
        <div class="markdown">{{ profile.description.html }}</div>
        <div class="mui--visible-xs-block mui--visible-sm-block">
          {% if profile.features.new_project() %}
            <div class="mui--d-inlineblock profile-create-btn profile-create-btn--mobile"><a class="mui-btn mui-btn--primary mui-btn--raised" href="{{ profile.url_for('new_project') }} ">{{ faicon(icon='plus', icon_size='caption') }}  {% trans %}New project{% endtrans %}</a></div>
          {% elif profile.features.make_public() %}
            <div class="mui--d-inlineblock profile-create-btn"><a class="mui-btn mui-btn--primary mui-btn--raised" href="#make-public-modal" rel="modal:open">{% trans %}Make profile public{% endtrans %}</a></div>
          {% endif %}
          {%- if profile.current_roles.admin %}
            <div class="mui--d-inlineblock {% if profile.features.new_user_project() %}floating-menu-btns{% endif %}">{{ profile_admin_buttons(profile) }}</div>
          {% endif %}
        </div>
      </div>
      </div>
    </div>
  </div>
  <div class="sub-navbar-container sub-navbar-container--sticky mui--bg-primary mui--z1 {% if class %}{{ class }}{% endif %}">
    <div class="mui-container">
      <div class="sub-navbar-container__inner">
        <nav class="sub-navbar" id="page-navbar">
          {% if profile.is_organization_profile %}
            <a class="sub-navbar__item mui--text-subhead mui--text-dark mui--hidden-xs mui--hidden-sm {% if current_page == 'profile' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'profile' -%}{{ profile.url_for() }}{%- endif %}" data-cy-navbar="profile">{% trans %}Home{% endtrans %}</a>
            <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if current_page == 'admins' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'admins' -%}{{ profile.urls['members'] }}{%- endif %}" data-cy-navbar="admins">{% trans %}Admins{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
          {% else %}
          <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if current_page == 'profile' %}sub-navbar__item--active{%- endif %}" href="{{ profile.url_for() }}">{% trans %}Sessions{% endtrans %}</a>
          <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if current_page == 'projects' %}sub-navbar__item--active{%- endif %}" href="{{ profile.url_for('user_participated_projects') }}">{% trans %}Projects{% endtrans %}<span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
          <a class="sub-navbar__item mui--text-subhead  mui--text-dark {% if current_page == 'submissions' %}sub-navbar__item--active{%- endif %}" href="{{ profile.url_for('user_proposals') }}" data-cy="submissions">{% trans %}Submissions{% endtrans %}<span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
          {% endif %}
        </nav>
      </div>
    </div>
  </div>
{% endmacro %}

{% macro page_footer() %}
  <footer class="sub-navbar-container sub-navbar-container--footer mui--bg-accent">
    <nav class="sub-navbar mui-container" id="page-navbar">
      <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if path == 'index' %}sub-navbar__item--active{%- endif %}" href="/about">{% trans %}About Hasgeek{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-dark" href="/hasgeek">{% trans %}Team &amp; careers{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if path == 'contact' %}sub-navbar__item--active{%- endif %}" href="/about/contact">{% trans %}Contact{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if path == 'policy' %}sub-navbar__item--active{%- endif %}" href="/about/policy">{% trans %}Site policies{% endtrans %}</a>
    </nav>
  </footer>
{% endmacro %}

{% macro video_thumbnail(session) %}
  <div class="video">
    <a class="video__thumbnail {%- if not (session.views.video.thumbnail or session.banner_image_url.url) %} video__thumnail--novideo {%- endif %}" href="{%- if session.proposal %}{{ session.proposal.url_for() }}{%- else %}{{ session.url_for() }}{%- endif %}" data-ga="view session video">
      {%- if session.views.video.thumbnail %}
        <img src="{{ session.views.video.thumbnail }}" class="video__thumbnail__img img-responsive" data-cy="thumbnail" alt="{{ session.title }}">
        <div class="video__thumbnail__icon">{{ faicon(icon='play', icon_size='headline', baseline=false) }}</div>
      {%- elif session.banner_image_url.url %}
        <img src="{{ session.banner_image_url }}" class="video__thumbnail__img img-responsive" data-cy="thumbnail" alt="{{ session.title }}">
      {%- endif %}
    </a>
    <p class="mui--text-subhead mui--text-bold video__txt" data-cy="title">{{ session.title }}</p>
    {%- if session.speaker %}<p class="mui--text-body2 mui--text-light video__txt">{{ session.speaker }}</p>{%- endif %}
    {%- if session.views.video %}
      <div class="mui--text-caption mui--text-light">
        {%- if session.views.video.duration %}<span>{{ session.views.video.duration|timedelta }}</span>{%- endif %}
        {%- if session.views.video.uploaded_at %}<span class="mui--pull-right">{{ session.views.video.uploaded_at|longdate }}</span>{%- endif %}
      </div>
    {%- else %}
    <div class="mui--text-caption mui--text-light">
      {%- if session.start_at_localized %}<span>{{ session.start_at_localized|date }}</span>{%- endif %}
    </div>
    {%- endif %}
  </div>
{% endmacro %}

{%- macro proposal_list(proposals, project='', css_class='') %}
  <table id="submissions-table" class="proposal-list-table mui-table">
    <tbody>
      {%- with reorderable=project and project.features.reorder_proposals() %}
      {% for proposal in proposals %}
        <tr id="{{ proposal.uuid_b58 }}" {%- if reorderable %}class="sortable" data-drag-placeholder="proposal-placeholder" draggable="true"{%- endif %}>
          <td class="js-searchable {%- if reorderable %} drag-box drag-box--no-border ui-draggable-box{%- endif %}">
            {%- if project and reorderable %}
              {{ proposal_card(proposal, full_width=true, details=true, css_class=css_class, project=project, draggable=true) }}
            {%- else %}
              {{ proposal_card(proposal, full_width=true, details=true, css_class=css_class, project=project, draggable=false) }}
            {%- endif %}
          </td>
        </tr>
      {% else %}
        <tr>
          <td><em>{% trans %}(No sessions have been submitted){% endtrans %}</em></td>
        </tr>
      {% endfor %}
      {%- endwith %}
    </tbody>
  </table>
{%- endmacro %}

{%- macro useravatar(user, css_class='', add_profile_link=true,  size='medium') %}
  {% if size == 'big' %}
    {%- set imgsize = 160 %}
  {%- elif size == 'medium' %}
    {%- set imgsize = 80 %}
  {%- else %}
    {%- set imgsize = 48 %}
  {% endif %}
  {% if user.profile_url and add_profile_link %}<a href="{{ user.profile_url }}" class="nounderline">{% endif %}
  {% if user and user.avatar %}
    <img class="user__box__gravatar {% if css_class %}{{ css_class }}{% endif %}" src="{{ user.avatar.resize(imgsize) }}" alt="{{ user.title }}"/>
  {%- else %}
    <div class="user__box__gravatar user__box__gravatar--initials {% if css_class %}{{ css_class }}{% endif %}" role="img" aria-label="{{ user.title }}">{{ user.title|initials }}</div>
  {% endif %}
  {% if user.profile_url and add_profile_link%}</a>{% endif %}
{%- endmacro %}

{%- macro proposal_card(proposal, full_width=false, details=false, css_class='', project='', draggable=false) %}
  {% if draggable %}
    <div class="card {%- if not full_width %} card--shaped{%- endif -%} {%- if css_class %} {{ css_class }}{%- endif -%}">
  {%- else -%}
    <a class="card clickable-card {%- if not full_width %} card--shaped{%- endif -%} {%- if css_class %} {{ css_class }}{%- endif -%}" href="{{ proposal.url_for() }}" aria-label="{{ proposal.title }}" data-ga="View submission" data-cy-proposal="{{ proposal.title }}">
  {%- endif %}
    <div class="card__body proposal-card">
      <div class="proposal-card__body">
        <div {% if draggable %}class="drag-box__header"{%- endif %}>
          {% if not project %}
            <p class="mui--text-title margin-bottom">{{ proposal.project.title }}</p>
          {%- else -%}
            <div class="flex-wrapper flex-wrapper--wrap">
            {%- for member in proposal.memberships %}{% if not member.is_uncredited %}
              <div class="user user--smaller right-padding">
                <div class="user__box">
                  {% if draggable %}
                    {{ useravatar(member.user, add_profile_link=true, size='small') }}
                  {%- else -%}
                    {{ useravatar(member.user, add_profile_link=false, size='small') }}
                  {%- endif %}
                  <div class="user__box__header">
                    <p class="mui--text-caption user__box__fullname">{{ member.user.fullname }} {%- if member.label %} <span class="badge">{{ member.label }}</span>{% endif %}</p>
                  </div>
                </div>
              </div>
            {%- endif %}{% endfor %}
            </div>
          {%- endif %}
          {% if draggable %}
            {{ faicon(icon='grip-vertical', baseline=false, css_class='drag-handle') }}
          {%- endif %}
        </div>
        <div class="proposal-card__body__inner {%- if full_width and proposal.views.video and proposal.views.video.thumbnail %} proposal-card__body__inner--flex {%- endif -%}">
          {% if proposal.views.video and proposal.views.video.thumbnail %}
            <div class="proposal-card__body__inner__details">
              <div class="proposal-card__body__inner__details__video">
                <div  class="proposal-card__body__inner__details__video__thumbnail"><img src="{{ proposal.views.video.thumbnail }}"></div>
                <div class="proposal-card__body__inner__details__video__thumbnail__icon">{{ faicon(icon='play', icon_size='headline', baseline=false) }}</div>
              </div>
            </div>
          {%- endif -%}
          <div class="proposal-card__body__inner__headline">
            {% if draggable %}
              <h3 class="mui--text-title mui--text-bold zero-top-margin" data-cy="proposal-card"><a class="nounderline mui--text-dark" href="{{ proposal.url_for() }}" data-cy-proposal="{{ proposal.title }}">{{ proposal.title }}</a></h3>
            {%- else -%}
              <h3 class="mui--text-title mui--text-bold zero-top-margin" data-cy="proposal-card">{{ proposal.title }}</h3>
            {%- endif %}
            {% if proposal.body.html %}
              <div class="proposal-card__body__inner__headline__content mui--text-light">{{ proposal.body.html|preview(max=400) }} {% if draggable %}<a class="nounderline" href="{{ proposal.url_for() }}">{%- endif %}<span class="chip">{% trans %}more{% endtrans %} {{ faicon(icon='caret-right-solid', baseline=false, css_class='mui--align-middle') }}</span>{% if draggable %}</a>{%- endif %}</div>
            {%- endif -%}
            {% if details %}
              <div class="proposal-card__body__inner__headline__info">
                <ul class="mui-list--inline mui--text-light mui--text-body2 zero-bottom-margin list-item-rgborder">
                  {%- if project and proposal.project.title != project.title %}
                    <li>{{ proposal.project.short_title }}</li>
                  {% endif %}
                  {%- if proposal.commentset %}
                    <li>{{ proposal.commentset.count }} comments</li>
                  {% endif %}
                  <li>
                    {{ proposal.state.label.title }}
                  </li>
                  <li class="no-border">{{ proposal.datetime|datetime(format='dd MMM YYYY') }}</li>
                  {% if proposal.views.video %}
                    <li class="no-border" data-toggle="tooltip" data-placement="top" title="{% trans %}This proposal has a preview video{% endtrans %}" aria-label="{% trans %}This proposal has a preview video{% endtrans %}">
                      {{ faicon(icon='video', icon_size='subhead', baseline=true, css_class='proposal-card__body__inner__headline__info__icon') }}
                    </li>
                  {% endif %}
                </ul>
                <div class="margin-top">
                  {%- for label in proposal.labels %}
                    {% if not label.restricted %}
                      <span class="label mui--text-bold">{% if label.icon_emoji %}{{ label.icon_emoji }} {% endif %}{% if label.main_label %}{{ label.main_label.title }}: {% endif %}{{ label.title }}</span>
                    {%- endif %}
                  {%- endfor %}
                  {%- if proposal.current_roles.project_editor %}
                    {%- for label in proposal.labels %}
                      {%- if label.restricted %}
                        <span class="label mui--text-bold">{% if label.icon_emoji %}{{ label.icon_emoji }} {% endif %}{% if label.main_label %}{{ label.main_label.title }}: {% endif %}{{ label.title }}</span>
                      {%- endif %}
                    {%- endfor %}
                  {% endif %}
                </div>
              </div>
            {%- else -%}
              <div class="proposal-card__body__inner__headline__info">
                <p class="mui--text-light mui--text-body2 margin-bottom">{{ proposal.datetime|datetime(format='dd MMM YYYY') }}</p>
              </div>
            {%- endif -%}
          </div>
        </div>
      </div>
    </div>
  </a>
{%- endmacro %}
