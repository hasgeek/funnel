{% from "baseframe/forms.html.jinja2" import renderform %}
{% from "baseframe/components.html.jinja2" import faicon, alertbox %}

{% macro calendarwidget(calendar, compact=true) %}
  <div class="card__calendar {% if compact %} card__calendar--compact {% endif %}" aria-hidden="true">
    <div class="calendar">
      {% set event = namespace(month='', year='', first_week='', previous='', next='') %}
      <div class="calendar__weekdays mui--bg-accent {% if calendar.weeks|length > 1 %} calendar__weekdays--rows {% endif %}">
        {% for week in calendar.weeks|sort(attribute='year') %}
          {% set event.previous = false %}
          {% set event.next = false %}
          {% if not event.first_week and week.upcoming %}
            {% set event.first_week = week %}
            {% if loop.index0 > 0 %}
              {% set event.previous = true %}
            {% endif %}
            {% if loop.index != calendar.weeks|length and calendar.weeks[loop.index].upcoming %}
              {% set event.next = true %}
            {% endif %}
          {% endif %}
          <p class="calendar__month-name {% if week.upcoming %}calendar__month-name--upcoming{% endif %} {% if event.first_week == week %}calendar__month-name--upcoming--first calendar__month-name--latest{% endif %} {% if week.month != event.month %}calendar__month-name--unique{% endif %} {% if loop.index == calendar.weeks|length and not week.upcoming %}calendar__month-name--latest{% endif %}">{{ week.month }} {{ week.year }}<span class="calendar__counting" data-today="{{ calendar.today }}" data-month="{{ week.month }}"></span></p>
          {% set event.month = week.month  %}
          {% set event.year = week.year  %}
          <div class="calendar__weekdays__dates {% if week.upcoming %}calendar__weekdays__dates--upcoming{% endif %} {% if event.first_week == week %}calendar__weekdays__dates--upcoming--first calendar__weekdays__dates--latest {% endif %} {% if loop.index == calendar.weeks|length and not week.upcoming %}calendar__weekdays__dates--latest {% endif %}"  data-month="{{ week.month }}">
            {% if event.previous  %}
              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__icon calendar__weekdays__dates__icon--left">
                {{ faicon(icon='chevron-left',  baseline=false, css_class='calendar__weekdays__dates__icon__next') }}
              </p>
            {% endif %}
            {% for date in week.dates %}
              <p class="calendar__weekdays__dates__date {% if date.count > 0 %}calendar__weekdays__dates__date--active {% elif date.isoformat == calendar.today %} calendar__weekdays__dates__date--today{% endif %} {% if date.day_start_at %} calendar__weekdays__dates__date--showtime{% endif %} calendar__weekdays__dates__date--{{ loop.index }}" {% if date.count > 0 %} data-event-date="{{ date.isoformat }}" {% endif %} data-event-month="{{ week.month }}">
                <span class="calendar__weekdays__dates__date__day">{{ date.day }}</span>
                <span class="calendar__weekdays__dates__date__name">{{ calendar.days[loop.index-1] }}</span>
                {% if date.day_start_at %}<span class="calendar__weekdays__dates__time">{{ date.day_start_at }} â€“ {{ date.day_end_at }}</span>{% endif %}
              </p>
            {% endfor %}
            {% if event.next  %}
              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__icon calendar__weekdays__dates__icon--right">
                {{ faicon(icon='chevron-right',  baseline=false, css_class='calendar__weekdays__dates__icon__next') }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro saveprojectform(project, form, formid='save-form', txt=false) %}
  <form id={{formid}} class="js-save-form" action="{{ project.url_for('save') }}" method="POST">
    {{ form.hidden_tag() }}
    <p class="no-jshidden zero-bottom-margin">
      {%- if current_auth.is_anonymous %}
        <a class="mui--text-body2"  href="{{ url_for('login') }}" data-action="Login to save project"><span class="mui--text-body2 mui--text-light login-txt">{% trans %}Login{% endtrans %} <span class="mui--hidden-xs mui--hidden-sm">{% trans %}to save{% endtrans %}</span></span>{{ faicon(icon='bookmark', css_class='mui--text-light') }}</a>
      {%- else %}
        <input type="hidden" name="save" value="">
        <button type="submit" value="true" class="mui-btn mui-btn--nostyle animate-btn {% if not project.is_saved_by(current_auth.user) %} animate-btn--show {% endif %}" data-action="Save {{project.title}}" onclick="this.form.save.value=this.value" data-cy="bookmark">{% if txt %}<span class="mui--text-body2 mui--text-light txt">{% trans %}Save <span class="mui--hidden-xs mui--hidden-sm">this project</span>{% endtrans %}</span>{% endif %}{{ faicon(icon='bookmark', icon_size='caption', baseline=false, css_class='mui--text-light') }}
        </button>
        <button type="submit" value="false" class="mui-btn mui-btn--nostyle animate-btn animate-btn--saved{% if project.is_saved_by(current_auth.user) %} animate-btn--show {% endif %}" data-action="Unsave {{project.title}}" onclick="this.form.save.value=this.value" data-cy="bookmarked">{% if txt %}<span class="mui--text-body2 mui--text-light txt">{% trans %}Unsave <span class="mui--hidden-xs mui--hidden-sm">this project</span>{% endtrans %}</span>{% endif %}{{ faicon(icon='bookmark-solid', icon_size='caption', baseline=false, css_class='bookmarked') }}</button>
      {%- endif %}
    </p>
  </form>
{% endmacro %}

{% macro share_dropdown(url, title) %}
  <ul class="mui-dropdown__menu mui-dropdown__menu--right" data-cy="share-dropdown">
    <li><a class="details__box__control__link mui--text-title" target="_blank" rel="noopener" href="//twitter.com/share?url={{ url }}&amp;via=Hasgeek&amp;text={{ title }}&amp;utm_campaign=share-twitter" data-url="{{ url }}" data-via="Hasgeek" data-text="{{ title }}" data-action="Tweet video">Twitter</a></li>
    <li><a class="details__box__control__link mui--text-title" target="_blank" rel="noopener" href="//www.facebook.com/sharer.php?u={{ url }}&amp;t={{ title }}&amp;utm_campaign=share-facebook" data-href="{{ url }}" data-action="Share video on facebook">Facebook</a></li>
    <li><a class="details__box__control__link mui--text-title" href="mailto:?subject={{ title }}&amp;body={{ url }}&amp;utm_campaign=share-email" data-action="Email video">Email</a></li>
    <li><a class="details__box__control__link mui--text-title" href="https://www.linkedin.com/shareArticle?mini=true&url={{ url }}&title={{ title }}&amp;utm_campaign=share-linkedin" data-action="Share about {{ title }} on linkedin">Linkedin</a></li>
  </ul>
{% endmacro %}

{% macro project_share(project, project_save_form) %}
  <div class="project-banner__footer">
    <div class="bookmark">{{ saveprojectform(project, project_save_form, txt=true) }}</div>
    {% if project.schedule_state.PUBLISHED %}
      <a class="add-calendar" aria-label="Add to calendar" href="{{ project.url_for('subscribe_schedule') }}" rel="modal:open" aria-label="Add to calendar" data-action="Add to calendar" data-cy="add-to-calendar"><span class="mui--text-body2 mui--text-light txt">{% trans %}Add to calendar{% endtrans %}</span>{{ faicon(icon='calendar-plus', baseline=false, css_class='mui--text-light') }}</a>
    {% endif %}
    <div class="mui-dropdown">
      <a href="javascript:void(0)" class="details__box__control__link mui--text-subhead share" data-mui-toggle="dropdown" data-action="Share dropdown" data-cy="share-project"><span class="mui--text-body2 mui--text-light txt">{% trans %}Share <span class="mui--hidden-xs mui--hidden-sm">this project</span>{% endtrans %}</span>{{ faicon(icon='share-square', icon_size='subhead', baseline=false, css_class='mui--text-light') }}</a>
      {{ share_dropdown(project.url_for(_external=true), project.title) }}
    </div>
  </div>
{% endmacro %}

{% macro livestream_edit_btn(project) %}
  {% if project.view_for('edit_livestream').is_available() %}
    <a href="{{ project.url_for('edit_livestream') }}" class="mui-btn mui-btn--raised icon-btn project-banner__box__add-btn" aria-label="{% trans %}Update livestream URLs{% endtrans %}">{{ faicon(icon='video-plus', baseline=false) }}</a>
  {% endif %}
{% endmacro %}

{% macro banner_edit_btn(project) %}
  {% if project.view_for('edit_banner').is_available() %}
    <a href="{{ project.url_for('edit_banner') }}" class="mui-btn mui-btn--raised icon-btn project-banner__box__add-btn project-banner__box__add-btn--second js-modal-form" aria-label="{% trans %}Update banner image{% endtrans %}" rel="modal:open" data-hash="edit_banner">{{ faicon(icon='camera', baseline=false) }}</a>
  {% endif %}
{% endmacro %}

{% macro project_header(project, project_save_form, csrf_form, class='', current_page='project', pinned=true) %}
  {% if current_auth.user.is_site_editor %}
    <div class="site-admin">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-sm-12">
            <a href="#featured-form-modal" rel="modal:open" class="mui--text-light mui--text-subhead"></a>
            <div class="mui-checkbox">
              <label class="mui--text-light mui--text-subhead">
                <input type="checkbox" {% if project.featured %}checked{% endif %} onclick="event.preventDefault(); $('#featured-form-modal').modal()">
                {% trans %}Featured project{% endtrans %}
              </label>
            </div>
            <div class="modal" id="featured-form-modal">
              <div class="modal__header">
                <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
              </div>
              <div class="modal__body">
                <form action="{{ project.url_for('toggle_featured') }}" method="post">
                  {{ csrf_form.hidden_tag() }}
                  <span class="mui--text-title mui--text-bold mui--text-dark">Confirmation</span>
                  <button name="transition" class="mui-btn mui-btn--accent mui-btn--flat mui--pull-right">
                    {% if project.featured %}
                      {% trans %}Remove featured{% endtrans %}
                    {% else %}
                      {% trans %}Make featured{% endtrans %}
                    {% endif %}
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  <div class="mui-container project-banner {% if class %}{{ class }}{% endif %}">
    <div class="grid">
      {% if project.view_for('edit').is_available() and project.features.schedule_no_sessions() %}
        <div class="grid__col-sm-12">
          {{ alertbox('warning', gettext("This project will not be listed as it has no sessions in the schedule")) }}
        </div>
      {% endif %}
      {% if project.view_for('view').is_available() and project.state.DRAFT %}
      <div class="grid__col-sm-12">
        {{ alertbox('warning', gettext("This project is currently not published")) }}
      </div>
      {% endif %}
      <div class="grid__col-sm-12">
        <div class="project-banner__profile-details">
          {%- if project.profile.logo_url.url %}
            <a href="{{ project.profile.url_for() }}" class="project-banner__profile-details__logo-wrapper" data-action="View {{ project.profile.title }}(project page)">
              <img class="project-banner__profile-details__logo_wrapper__logo" src="{{ project.profile.logo_url }}" alt="{{ project.profile.title }}"/>
            </a>
          {% endif %}
          <a href="{{ project.profile.url_for() }}" class="mui--text-subhead mui--text-bold project-banner__profile-details__text" data-cy="profile-link" data-action="View {{ project.profile.title }}(project page)">{{ project.profile.title }}</a>
        </div>
      </div>
      <div class="grid__col-sm-12 project-banner__headline">
        <h1 class="mui--text-headline mui--text-bold zero-top-margin project-banner__headline__title">{{ project.title }}
          {% if project.view_for('edit_slug').is_available() %}
            <a class="mui--text-body2" href="{{ project.url_for('edit_slug') }}" aria-label="edit project url" data-action="edit project url">{% trans %}Edit url{% endtrans %} {{ faicon(icon='edit') }}</a>
          {% endif %}
        </h1>
        <p class="mui--text-title mui--text-light zero-bottom-margin">{{ project.tagline }}</p>
      </div>
      {% if project.livestream_urls %}
        <div role="tabpanel" class="grid__col-sm-12 grid__col-md-8 livestream-box" id="livestream">
          <ul class="mui-tabs__bar project-banner__box" role="tablist">
            {%- for stream in project.livestream_urls %}
              <li role="presentation" {%- if loop.first %} class="mui--is-active"{% endif %}>
                <a role="tab" data-mui-toggle="tab" data-mui-controls="pane-justified-{{ loop.index }}">Livestream {{loop.index}}</a>
              </li>
            {%- endfor %}
          </ul>

          {%- for stream in project.livestream_urls %}
            <div role="tabpanel" class="mui-tabs__pane {%- if loop.first %} mui--is-active{% endif %}" id="pane-justified-{{ loop.index }}">
              <div class="project-banner__box">
                {{ livestream_edit_btn(project) }}
                <div class="embed-video-wrapper js-embed-video" data-video-src="{{ stream }}">
                  <p class="video_txt">
                    {{ faicon(icon='video', icon_size='display1') }}<br>
                    <a href="{{ stream }}" target="_blank" rel="noopener" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
                  </p>
                </div>
              </div>
            </div>
          {%- endfor %}
          {{ project_share(project, project_save_form) }}
        </div>
      {% else %}
        <div class="grid__col-sm-12 grid__col-md-8 project-banner__box">
          <div class="embed-video-wrapper">
            {{ livestream_edit_btn(project) }}
            {% if project.banner_video_url.url %}
              <div class="embed-video-wrapper js-embed-video" data-video-src="{{ project.banner_video_url }}">
                <p class="video_txt">
                  {{ faicon(icon='video', icon_size='display1') }}<br>
                  <a href="{{ project.banner_video_url }}" target="_blank" rel="noopener" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
                </p>
              </div>
            {%- elif project.bg_image.url %}
              {{ banner_edit_btn(project) }}
              <img class="project-banner__box__image" src="{{ project.bg_image }}" alt="{{ project.title }}" data-cy="bg_image"/>
            {%- else %}
              {{ banner_edit_btn(project) }}
              <img class="project-banner__box__image" src="{{ url_for('static', filename='img/default-banner.png') }}"/>
            {% endif %}
          </div>
          {{ project_share(project, project_save_form) }}
        </div>
      {% endif %}
      <div class="grid__col-md-4 project-details__box {% if project.livestream_urls %}project-details__box--topmargin{% endif %}">
        {% if project.schedule_state.PUBLISHED and project.calendar_weeks_full.weeks and project.calendar_weeks_full.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_full, compact=false) }}
          </div>
        {% endif %}
        <div class="project-details__box--ticketbox">
          {% if project.features.tickets()  %}
            <div class="mui--hidden-xs mui--hidden-sm">
              <a href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#tickets" class="mui-btn mui-btn--raised mui-btn--primary mui--d-block {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" data-action="Get tickets(header)" id="get-tickets">
              {% trans %}Get tickets{% endtrans %}</a>
            </div>
          {% elif project.features.rsvp() %}
            {%- if current_auth.is_anonymous %}
              <p class="mui--text-body2 mui--text-light">{{ project.views.registration_text() }}</p>
              <a class="mui-btn mui-btn--raised mui-btn--primary  mui--d-block"  href="{{ url_for('login') }}" data-action="Login to register">Login to register</a>
            {% elif project.features.rsvp_unregistered() -%}
              <p class="mui--text-body2 mui--text-light">{{ project.views.registration_text() }}</p>
              <a class="mui-btn mui-btn--raised mui-btn--primary  mui--d-block" href="#register-modal" id="register-btn">{% trans %}Register{% endtrans %}</a>
              <div class="modal reg-modal" id="register-modal">
                <div class="modal__header">
                  <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
                  <p class="mui--text-title mui--text-bold mui--text-dark reg-modal__txt">{{ project.title }}</p>
                </div>
                <div class="modal__body">
                  <p class="mui--text-body2 reg-modal__txt">{% trans %}This will share your name and email address with the projectâ€™s crew so they can keep you updated. You can cancel your registration at any time.{% endtrans %}</p>
                  <form action="{{ project.url_for('register') }}" method="post" class="form-inline">
                    {{ csrf_form.hidden_tag() }}
                    <div class="mui--text-right modal__body__btn">
                      <button class="mui-btn mui-btn--flat mui-btn--primary" type="submit" name="submit" value="yes" data-cy="confirm">{% trans %}Confirm{% endtrans %}</button>
                    </div>
                  </form>
                </div>
              </div>
            {%- elif project.features.rsvp_registered() %}
              <p class="mui--text-body2 mui--text-light">{{ faicon(icon='check', baseline=false, css_class='mui--align-middle mui--text-success check-icon') }}{{ project.views.registration_text() }}</p>
              <a class="mui-btn mui-btn--raised mui--d-block" href="#register-modal" id="register-btn">{% trans %}Cancel registration{% endtrans %}</a>
              <div class="modal reg-modal" id="register-modal">
                <div class="modal__header">
                  <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
                  <p class="mui--text-title mui--text-bold mui--text-dark reg-modal__txt">{{ project.title }}</p>
                </div>
                <div class="modal__body">
                  <p class="mui--text-subhead reg-modal__txt">{% trans %}Canâ€™t make it?{% endtrans %}</p>
                  <form action="{{ project.url_for('deregister') }}" method="post" class="form-inline">
                    {{ csrf_form.hidden_tag() }}
                    <div class="mui--text-right modal__body__btn">
                      <button class="mui-btn mui-btn--flat mui-btn--primary" type="submit" name="submit" value="no">{% trans %}Confirm cancellation{% endtrans %}</button>
                    </div>
                  </form>
                </div>
              </div>
            {%- endif %}
            {% if project.view_for('rsvp_list').is_available() %}
              <a href="{{ project.url_for('rsvp_list') }}" class="mui--d-block mui--text-center" data-cy="see-responses">{% trans %}View participants{% endtrans %}</a>
            {% endif %}
          {% elif project.view_for('edit_schedule').is_available() %}
            <a class="mui-btn mui-btn--raised mui-btn--dark  mui--d-block" href="{{ project.url_for('edit_schedule') }}">{% trans %}Add schedule to enable registrations{% endtrans %}</a>
          {%- endif %}
          <hr class="mui-divider">
          {% if project.cfp_state.OPEN -%}
            <div class="propose propose--lessmargin">
              <a class="mui-btn mui-btn--accent mui-btn--raised mui--d-block propose__btn" href="{{ project.url_for('new_proposal') }}" data-action="Submit a session proposal(header)" data-cy="propose-a-session">{% trans %}Submit a session proposal{% endtrans %}</a>
              {% if project.cfp_end_at_localized -%}<p class="propose__txt">{{ faicon(icon='info-circle', css_class='secondary-color-txt') }} <em class="mui--text-light">{% trans date=project.cfp_end_at_localized|datetime %}Proposal submission closes on {{ date }}{% endtrans %}</em></p>{% endif %}
            </div>
          {% elif project.view_for('cfp').is_available() -%}
            <div class="propose propose--lessmargin">
              <a href="{{ project.url_for('cfp') }}" class="mui-btn mui-btn--raised mui-btn--dark mui--d-block">
                {% if project.cfp_state.DRAFT or project.cfp_state.PRIVATE_DRAFT or project.cfp_state.UNAVAILABLE -%}
                  {% trans %}Open proposal submissions{% endtrans %}
                {%- else %}
                  {% trans %}Add proposal guidelines{% endtrans %}
                {%- endif %}
              </a>
            </div>
          {%- elif project.cfp_state.UNAVAILABLE %}
            <div class="propose propose--lessmargin">
              <a class="mui-btn mui-btn--accent mui-btn--raised mui--d-block propose__btn propose__btn--strike" data-cy="Submit a session proposal" data-action="Propose a session(closed)">{% trans %}Submit a session proposal{% endtrans %}</a>
              <p class="mui--text-light mui--text-caption mui--text-center zero-bottom-margin">{% trans %}Submissions are closed for this project{% endtrans %}</p>
            </div>
          {%- endif %}
          {%- if project.primary_venue %}
            <p class="project-venue"><a class="mui--text-hyperlink mui--text-subhead {% if current_page == 'project' %}js-smooth-scroll{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#venue" data-action="Venue(header)" data-action="Venue(header)">{{ faicon(icon='map-marker-alt') }} <span>{{ project.primary_venue.title }}</span>{%- if project.primary_venue.city %}, <span>{{ project.primary_venue.city }}</span>{%- endif %}</a></p>
          {% elif project.view_for('venues').is_available() %}
            <a href="{{ project.url_for('venues') }}" class="mui-btn mui-btn--raised mui--d-block mui-btn--dark">{% trans %}Add venue{% endtrans %}</a>
          {%- endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="sub-navbar-container sub-navbar-container--sticky mui--bg-accent {% if class %}{{ class }}{% endif %}">
    <nav class="sub-navbar mui-container" id="page-navbar">
      <a class="sub-navbar__item mui--text-subhead mui--text-light mui--hidden-xs mui--hidden-sm {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#about" data-action="About(navbar)" data-cy-navbar="about">{% trans %}About{% endtrans %}</a>
      {% if project.features.tickets() -%}
        <div class="sub-navbar__item--wrapper" id="ticket-wrapper"><a href='#tickets' class="open-ticket-widget sub-navbar__item sub-navbar__item--primarybg mui--text-subhead mui--text-light mui--hidden-md mui--hidden-lg mui--hidden-xl" data-action="Tickets(navbar)" id="ticket-btn" data-cy-navbar="tickets">{% trans %}Get tickets{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a></div>
      {%- endif %}
      {%- if project.featured_sessions %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#talks" data-action="Talks(navbar)" data-cy-navbar="talks">{% trans %}Talks{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.hasjob_embed_url.url -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#related-jobs" data-action="Jobs(navbar)" data-cy-navbar="jobs">{% trans %}Jobs{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.primary_venue -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#venue" data-action="Venue(navbar)" data-cy-navbar="venue">{% trans %}Venue{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'updates' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'updates' -%}{{ project.url_for('updates') }}{%- endif %}" data-action="Updates(navbar)" data-cy-navbar="updates">{% trans %}Updates{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'comments' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'comments' -%}{{ project.url_for('comments') }}{%- endif %}" data-action="comments(navbar)" data-cy-navbar="comments">{% trans %}Comments{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- if project.has_sessions_with_video %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'videos' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'videos' -%}{{ project.url_for('session_videos') }}{%- endif %}" data-action="Video(navbar)" data-cy-navbar="video">{% trans %}Video{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.current_roles.editor or not project.cfp_state.NONE -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'proposals' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'proposals' -%}{{ project.url_for('view_proposals') }}{%- endif %}" data-action="Proposals(navbar)" data-cy-navbar="proposals">{% trans %}Proposals{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.schedule_state.PUBLISHED %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'schedule' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'schedule' -%}{{ project.url_for('schedule') }}{%- endif %}" data-action="Schedule(navbar)" data-cy-navbar="schedule">{% trans %}Schedule{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'crew' %}sub-navbar__item--active{%- endif %}"" href="{%- if current_page != 'crew' -%}{{ project.url_for('crew') }}{%- endif %}" title="Crew" data-action="Crew(navbar)" data-cy-navbar="crew">{% trans %}Crew{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- if project.current_roles.editor or project.current_roles.concierge or project.current_roles.usher -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'settings' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'settings' -%}{{ project.url_for('settings') }}{%- endif %}" data-action="Settings(navbar)" data-cy-navbar="settings">{% trans %}Settings{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
    </nav>
  </div>
  {% with pinned_update = project.pinned_update %}{%- if pinned_update and pinned %}
  <ul class="mui-list--unstyled pinned  {% if current_page == 'project' %}pinned--about-page{%- endif %}">
    <li>
      <a href="{{ pinned_update.urls['view'] }}" class="pinned__update">
        <p class="pinned__update__heading mui-container">{{ faicon(icon='thumbtack', icon_size='caption') }} <span class="mui--text-subhead">{% trans %}Pinned update{% endtrans %}</span></p>
        <p class="pinned__update__body mui-container"><span class="mui--text-subhead mui--text-bold mui--text-dark">{{ pinned_update.title }}</span> <span><span class="mui--text-subhead mui--text-light pinned__update__body__text">{%- if not pinned_update.is_currently_restricted %}<span class="js-truncate" data-truncate-lines="1">{{ pinned_update.body.text }}</span>{% else %}<em>{% trans %}This update is for participants only{% endtrans %}</em>{%- endif %}</span></p>
      </a>
    </li>
  </ul>
  {%- endif %}{%- endwith %}
{% endmacro %}

{% macro embed_video_player(video) %}
  {% if video.source != 'raw' %}
    <iframe src="{{ video.embeddable_url }}" frameborder="0" allowfullscreen></iframe>
  {% else %}
    <p class="video_txt">
      {{ faicon(icon='video', icon_size='display1') }}<br>
      <a href="{{ video.id }}" target="_blank" rel="noopener" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
    </p>
  {%- endif %}
{% endmacro %}

{% macro video_action_bar(video, proposal='', session='') %}
  {%- if video.source == 'youtube' -%}
    <p><a href="https://videoken.com" target="_blank" rel="noopener" class="mui--text-caption details__box__control__link">Powered by VideoKen</a></p>
  {%- endif %}

  {%- if proposal and 'edit_proposal' in proposal.permissions(current_auth.user) %}
    <a class="details__box__control__link mui--text-subhead" href="{{ proposal.url_for('edit') }}#field-video" data-cy="edit-video" aria-label="{% trans %}Edit proposal video{% endtrans %}">{{ faicon(icon='edit', icon_size='subhead', css_class='fa5--link') }}</a>
  {% elif session and session.project.current_roles.editor %}
    <a class="details__box__control__link mui--text-subhead" href="{{ session.url_for('edit') }}" data-cy="edit-video" aria-label="{% trans %}Edit session video{% endtrans %}">{{ faicon(icon='edit', icon_size='subhead', css_class='fa5--link') }}</a>
  {%- endif %}

  {%- if proposal or session %}
    {%- if proposal %}
      {% set url, title = proposal.url_for(_external=true), proposal.title  %}
    {% else %}
      {% set url, title = session.url_for(_external=true), session.title %}
    {%- endif %}
      <div class="mui-dropdown">
        <a href="javascript:void(0)" class="details__box__control__link mui--text-subhead" data-mui-toggle="dropdown" data-action="Share dropdown" data-cy="share-project">{{ faicon(icon='share-square', icon_size='subhead', css_class=share_icon_css) }}</a>
        {{ share_dropdown(url, title) }}
      </div>
  {%- endif %}
{% endmacro %}

{% macro account_tabs(active_tab='account') %}
  <div class="tabs" id="jquery-scroll-tabs">
    <a {% if active_tab != 'account' %}href="{{ url_for('account') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase  {% if active_tab == 'account' %}tabs__item--active{%- endif %}">{% trans %}Account{% endtrans %}</a>
    <a {% if active_tab != 'saved' %}href="{{ url_for('saved') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase {% if active_tab == 'saved' %}tabs__item--active{%- endif %}">{% trans %}My saves{% endtrans %}</a>
    <a {% if active_tab != 'scan' %}href="{{ url_for('scan_contact') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase {% if active_tab == 'scan' %}tabs__item--active{%- endif %}">{% trans %}Scan badge{% endtrans %}</a>
    <a {% if active_tab != 'contacts' %}href="{{ url_for('contacts') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase {% if active_tab == 'contacts' %}tabs__item--active{%- endif %}">{% trans %}Contacts{% endtrans %}</a>
  </div>
{% endmacro %}

{% macro projectcard(project, project_save_form=none, include_calendar=true, calendarwidget_compact=true) %}
  <a class="card card--upcoming clickable-card" href="{{ project.url_for() }}" aria-label="{{ project.title }}" data-cy-title="{{ project.title }}" data-action="View {{ project.title }}(upcoming)">
    <div class="card__image-wrapper {% if not project.bg_image.url %}card__image-wrapper--default{% endif %}">
      {% if project.bg_image.url %}
        <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
        <noscript>
          <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
        </noscript>
      {% else %}
        <img class="card__image" src="{{ url_for('static', filename='img/default-banner.png') }}" alt="{{ project.title }}"/>
        <p class="card__image__tagline mui--text-body2">{{ project.title }}</p>
      {% endif %}
    </div>
    <div class="card__body">
      {%- if not current_auth.is_anonymous and project_save_form %}
        {% set save_form_id = "upcoming_" + project.uuid_b58 %}
        <div class="card__body__bookmark {% if not project.calendar_weeks_compact.weeks %} card__body__bookmark--pushup {% endif %}">{{ saveprojectform(project, project_save_form, save_form_id) }}</div>
      {% endif %}
      {%- if include_calendar%}
        {% if calendarwidget_compact and project.schedule_state.PUBLISHED and project.calendar_weeks_compact.weeks and project.calendar_weeks_compact.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_compact) }}
          </div>
        {% elif project.schedule_state.PUBLISHED and project.calendar_weeks_full.weeks and project.calendar_weeks_full.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_full, compact=false) }}
          </div>
        {% endif %}
        <h3 class="card__body__title mui--text-subhead {% if not project.calendar_weeks_compact.weeks %} card__body__title--smaller {% endif %}"><span class="mui--text-bold">{{ project.title_inline }}</span> <span class="mui--text-light js-truncate" data-truncate-lines="2">{{ project.tagline }}</span></h3>
        <p class="card__body__location mui--text-light">{% if project.primary_venue %}{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}{% elif project.location %}{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {{ project.location }}{% endif %}</p>
      {% else %}
        <h3 class="card__body__subtitle mui--text-subhead mui--text-bold">{{ project.title }}</h3>
        <p class="mui--text-caption mui--text-light js-truncate" data-truncate-lines="2">{{ project.tagline }}</p>
        <hr class="separator">
        {% if project.cfp_end_at_localized %}<p class="mui--text-caption zero-bottom-margin secondary-color-txt"><em>{% trans date=project.cfp_end_at_localized|datetime(format='dd MMM, YYYY, hh:mm a') %}Submission closes on {{ date }}{% endtrans %}</em></p>{% endif %}
      {% endif %}
    </div>
  </a>
{% endmacro %}

{% macro featured_section(featured_project, project_save_form) %}
  {% if featured_project %}
    {% with current_sessions = featured_project.current_sessions() if
    featured_project is not none else none %}
    {% if current_sessions and current_sessions.sessions|length > 0 %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">
              {% if not featured_project.livestream_urls and
              current_sessions.sessions|length > 0 %} {% trans %}Live schedule{%
              endtrans %} {% elif featured_project.livestream_urls and not
              current_sessions.sessions|length > 0 %} {% trans %}Livestream{%
              endtrans %} {% elif featured_project.livestream_urls and
              current_sessions.sessions|length > 0 %} {% trans %}Livestream and
              schedule{% endtrans %} {% endif %}
            </h2>
          </div>
          <div class="grid__col-xs-12">
            <div class="card card--spotlight card--spotlight--live">
              <div class="card__image-wrapper">
                {% if featured_project.bg_image.url %}
                  <img class="card__image" src="{{ featured_project.bg_image }}" alt="{{ featured_project.title }}"/>
                {% else %}
                  <img class="card__image" src="{{ url_for('static', filename='img/default-banner.png') }}" alt="{{ featured_project.title }}"/>
                  <p class="card__image__tagline">{{ featured_project.title }}</p>
                {% endif %}
              </div>
              <div class="card__body">
                <h3 class="card__body__title mui--text-headline mui--text-bold zero-top-margin">
                  <a class="clickable-card" href="{{ featured_project.url_for() }}">{{ featured_project.title }}</a>
                </h3>
                <p class="mui--text-title mui--text-bold primary-color-txt zero-bottom-margin">Live</p>
                {% if current_sessions.sessions|length > 0 %}
                  <p class="mui--text-subhead mui--text-light">{{ faicon(icon='clock') }} {% trans session=current_sessions.sessions[0].start_at_localized|time %}Session starts at {{ session }}{% endtrans %}</p>
                {% endif %}
                <div>
                  {%- if featured_project.livestream_urls %}
                    <a class="mui-btn mui-btn--primary mui-btn--raised" aria-label="{% trans %}Watch livestream{% endtrans %}" href="{{ featured_project.url_for() }}">{% trans %}Livestream{% endtrans %}</a>
                  {%- endif %}
                  {%- if current_sessions.sessions|length > 0 %}
                    <a class="mui-btn mui-btn--primary mui-btn--raised" data-action="View Schedule(live event card)" href="{{ featured_project.url_for('schedule') }}">{% trans %}Schedule{% endtrans %}</a>
                  {%- endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    {% endif %}
    {% endwith %}

    <div class="projects-wrapper">
      <div class="spotlight">
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Spotlight{% endtrans %}</h2>
            </div>
          </div>
        </div>
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              <a class="card card--spotlight clickable-card" href="{{ featured_project.url_for() }}" aria-label="{{ featured_project.title }}" data-cy-project="{{ featured_project.title }}" data-action="View {{ featured_project.title }}(spotlight)">
                <div class="card__image-wrapper">
                  {% if featured_project.bg_image.url %}
                    <img class="card__image" src="{{ featured_project.bg_image }}" alt="{{ featured_project.title }}"/>
                  {% else %}
                    <img class="card__image" src="{{ url_for('static', filename='img/default-banner.png') }}" alt="{{ featured_project.title }}"/>
                    <p class="card__image__tagline">{{ featured_project.title }}</p>
                  {% endif %}
                </div>
                <div class="card__body">
                  <h3 class="card__body__title mui--text-headline mui--text-bold">{{ featured_project.title }}</h3>
                  {% if featured_project.tagline %}
                  <p class="card__body__subtitle mui--text-subhead zero-top-margin js-truncate mui--text-light" data-truncate-lines="3">{{ featured_project.tagline }}</p>
                  {% endif %}
                  {%- if not current_auth.is_anonymous %}
                    {% set save_form_id = "featured_" + featured_project.uuid_b58 %}
                    <div class="card__body__bookmark">
                      {{ saveprojectform(featured_project, project_save_form, save_form_id) }}
                    </div>
                  {% endif %}
                  {% if featured_project.calendar_weeks_compact.weeks and featured_project.calendar_weeks_compact.weeks|length > 0 %}
                    <div aria-label="{{ featured_project.datelocation }}">
                      {{ calendarwidget(featured_project.calendar_weeks_compact) }}
                    </div>
                  {% endif %}
                  {% if featured_project.primary_venue %}
                    <p class="card__body__location mui--text-light">{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {{ featured_project.primary_venue.title }}{% if featured_project.primary_venue.city %}, {{ featured_project.primary_venue.city }}{% endif %}</p>
                  {% elif featured_project.location %}
                    <p class="card__body__location mui--text-light">{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {{ featured_project.location }}</p>
                  {% endif %}
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro upcoming_section(upcoming_projects, project_save_form) %}
  {% if upcoming_projects|length > 0 %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Upcoming{% endtrans %}</h2>
          </div>
        </div>
        <ul class="mui-list--unstyled grid upcoming" role="list">
          {% for project in upcoming_projects %}
          <li class="grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
            {{ projectcard(project, project_save_form) }}
          </li>
          {%- endfor -%}
        </ul>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro open_cfp_section(open_cfp_projects, project_save_form) %}
  {% if open_cfp_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Accepting proposal submissions{% endtrans %}</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in open_cfp_projects %}
            <li class="grid__col-xs-12 grid__col-sm-4 grid__col-lg-3 js-cfp-projects {% if loop.index > 4 %}mui--hide{% endif %}"
              role="listitem">
              {{ projectcard(project, include_calendar=false) }}
            </li>
          {%- endfor -%}
        </ul>
        {% if open_cfp_projects|length > 4 %}
          <div class="mui--text-center">
            <a href="javascript:void(0)" data-target="show all cfp projects" class="jquery-show-all mui--text-uppercase" data-projects="js-cfp-projects" data-action="Show all cfp projects(index page)" aria-expanded="true">{% trans %}Show more{% endtrans %}</a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro all_projects_section(all_projects, project_save_form) %}
  {% if all_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}All projects{% endtrans %}</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in all_projects %}
            <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
              {{ projectcard(project, project_save_form) }}
            </li>
          {%- endfor -%}
        </ul>
      </div>
    </div>
  {% endif %}
{% endmacro %}

{% macro past_projects_section() %}
  {% raw %}
    <div class="projects-wrapper" id="past-project-table" v-cloak>
      <div class="mui-container">
        <div class="grid projects">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline" v-if="pastprojects.length">{{ title }}</h2>
          </div>
          <div class="grid__col-12 mui-table--responsive-wrapper">
            <table class="mui-table mui-table--bordered mui-table--responsive past-events-table">
              <thead class="mui--bg-primary-dark">
                <tr>
                  <th class="mui--text-subhead mui--text-capitalize" v-for="heading in headings" v-if="pastprojects.length">{{ heading }}</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="project in pastprojects">
                  <td data-th="Date">
                    <p class="mui--text-subhead zero-bottom-margin">{{ project.datetime }}</p>
                  </td>
                  <td data-th="Event name" class="past-events-table__title">
                    <p class="mui--text-subhead zero-bottom-margin">
                      <a :href="project.url" data-action="past-event(index page list)">{{ project.title }}</a>
                    </p>
                  </td>
                  <td data-th="Location">
                    <p class="mui--text-subhead zero-bottom-margin">{{ project.venue }}</p>
                  </td>
                </tr>
              </tbody>
            </table>
            <p class="js-lazy-loader loading" v-if="next_page"></p>
          </div>
        </div>
      </div>
    </div>
  {% endraw %}
{% endmacro %}

{% macro profile_admin_buttons(profile) %}
  <div class="mui-dropdown mui--d-inlineblock">
    <a href="javascript:void(0)" class="mui--text-title mui-btn profile-dropdown-btn" data-mui-toggle="dropdown" data-action="Share dropdown" data-cy="admin-dropdown">{{ faicon(icon='ellipsis-v', icon_size='title', baseline=false) }}</a>
    <ul class="mui-dropdown__menu mui-dropdown__menu--right">
      {%- if profile.organization %}<li><a href="{{ profile.urls['members'] }}" data-cy-btn="profile-crew">{%- if profile.current_roles.owner %}{% trans %}Manage admins{% endtrans %}{% else %}{% trans %}View admins{% endtrans %}{% endif %}</a></li>{% endif %}
      <li><a href="{{ profile.url_for('edit') }}" data-cy-btn="edit-details">{% trans %}Edit this profile{% endtrans %}</a></li>
      {%- if profile.features.make_private() %}<li><a href="#make-private-modal" rel="modal:open">{% trans %}Make profile private{% endtrans %}</a></li>{% endif %}
    </ul>
  </div>
  <div class="modal" id="make-private-modal">
    <div class="modal__header">
      <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
      <p class="mui--text-title mui--text-bold mui--text-dark">{% trans %}Make this profile private?{% endtrans %}</p>
    </div>
    <div class="modal__body">
      <ul class="mui-list--aligned mui--text-body2">
        <li>{% trans %}Your profile will not be visible to anyone other than you{% endtrans %}</li>
        <li>{% trans %}It will not be listed in search results{% endtrans %}</li>
        <li>{% trans %}You cannot host projects from this profile{% endtrans %}</li>
        <li>{% trans %}Any existing projects will become inaccessible until the profile is public again{% endtrans %}</li>
      </ul>
      <form action="{{ profile.url_for('transition') }}" method="post">
        {{ profile.forms.transition().hidden_tag() }}
        <button name="transition" value="make_private" class="mui-btn mui-btn--accent mui--pull-right mui-btn--flat">{% trans %}Make private{% endtrans %}</button>
      </form>
    </div>
  </div>
{% endmacro %}

{% macro profile_header(profile, class='', current_page='profile') %}
  <div class="{% if class %}{{ class }}{% endif %}">
  <div class="profile mui--bg-accent">
    {%- if profile.banner_image_url.url %}
      <div class="profile__background">
        <img class="profile__background__image" src="{{ profile.banner_image_url.url }}" alt="{{ profile.title }}"/>
      </div>
    {% endif %}
    <div class="mui-container profile__banner">
      <div class="grid">
        <div class="grid__col-12">
          <div class="profile__banner__box">
            {%- if profile.banner_image_url.url %}
              <img class="profile__banner__box__img" src="{{ profile.banner_image_url }}" alt="{{ profile.title }}" data-cy="profile-banner-img"/>
            {% else %}
              <img class="profile__banner__box__img profile__banner__box__img--default" src="{{ url_for('static', filename='img/default-banner-profile.png') }}" alt="{{ profile.title }}"/>
            {% endif %}
          </div>
          {%- if profile.current_roles.admin %}
            <a href="{{ profile.url_for('edit_banner_image_url') }}" class="mui-btn mui-btn--default mui-btn--raised profile__banner__upload js-modal-form" title="{% trans %}Add cover photo url{% endtrans %}" aria-label="{% trans %}Add cover photo url{% endtrans %}" data-cy="add-banner" rel="modal:open" data-hash="edit_banner">{{ faicon(icon='camera', icon_size='body2', css_class='profile__banner__icon') }} <span class="mui--hidden-xs mui--hidden-sm">Add cover photo url</span></a>
          {% endif %}
          <div class="profile__logo">
            {%- if profile.logo_url.url %}
              <img class="profile__logo__img" src="{{ profile.logo_url.url }}" alt="{{ profile.title }}"/>
            {% else %}
              <span class="profile__logo__nologo">{{ faicon(icon='user-solid', css_class='profile__logo__icon') }}</span>
            {% endif %}
            {%- if profile.current_roles.admin %}
              <a href="{{ profile.url_for('edit_logo_url') }}" class="profile__logo__upload mui--text-dark js-modal-form" rel="modal:open" data-hash="edit_logo">{{ faicon(icon='camera', baseline=false, icon_size='body2', css_class='profile__logo__upload__icon') }}</a>
            {% endif %}
            <div class="mui--hidden-xs mui--hidden-sm profile__logo__details">
              <h2 class="mui--text-headline mui--text-dark mui--text-bold zero-bottom-margin"><a class="mui--text-dark" data-cy="profile-title" href="{{ profile.url_for() }}">{{ profile.title }}</a></h2>
              <p class="mui--text-title mui--text-light">@{{ profile.name }}</p>
            </div>
          </div>
          <div class="profile__banner__btns mui--hidden-xs mui--hidden-sm">
            {% if profile.features.new_project()  %}
              <a class="mui-btn mui-btn--primary mui-btn--raised profile-create-btn" href="{{ profile.url_for('new_project') }} ">{{ faicon(icon='plus', icon_size='caption') }}  {% trans %}New project{% endtrans %}</a>
            {% elif profile.features.make_public() %}
              <a class="mui-btn mui-btn--raised mui-btn--primary" href="#make-public-modal" rel="modal:open">{% trans %}Make profile public{% endtrans %}</a>
              <div class="modal" id="make-public-modal">
                <div class="modal__header">
                  <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
                  <p class="mui--text-title mui--text-bold mui--text-dark">{% trans %}Make this profile public?{% endtrans %}</p>
                </div>
                <div class="modal__body">
                  <ul class="mui-list--aligned mui--text-body2">
                    <li>{% trans %}Your profile will be visible to anyone visiting the page{% endtrans %}</li>
                    <li>{% trans %}Your profile will be listed in search results{% endtrans %}</li>
                    {#- <li>{% trans %}You can host projects{% endtrans %}</li> #}
                  </ul>
                  <form action="{{ profile.url_for('transition') }}" method="post">
                    {{ profile.forms.transition().hidden_tag() }}
                    <button name="transition" value="make_public" class="mui-btn mui-btn--accent mui-btn--flat mui--pull-right">{% trans %}Make public{% endtrans %}</button>
                  </form>
                </div>
              </div>
            {% endif %}
            {%- if profile.current_roles.admin %}
              <div class="mui--d-inlineblock">{{ profile_admin_buttons(profile) }}</div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="mui-container profile-details">
    <div class="grid">
      <div class="grid__col-12">
        <div>
        <div class="mui--hidden-md mui--hidden-lg mui--hidden-xl">
          <h2 class="mui--text-headline mui--text-bold zero-bottom-margin" data-cy="profile-title"><a href="{{ profile.url_for() }}" class="mui--text-dark">{{ profile.title }}</a></h2>
          <p class="mui--text-title mui--text-light">@{{ profile.name }}</p>
        </div>
        <ul class="bullet-separated-list">
          <li class="">{{ faicon(icon='history') }} {% trans date=profile.owner.created_at|date(format='MMM YYYY')%}Joined {{ date }}{% endtrans %}</li>
          {% if profile.website %}
            <li><a href="{{ profile.website }}" target="_blank" rel="noopener">{{ faicon(icon='globe') }} {{ profile.website|cleanurl }}</a></li>
          {% endif %}
        </ul>
        <div>{{ profile.description.html }}</div>
        <div class="mui--visible-xs-block mui--visible-sm-block">
          {% if profile.features.new_project() %}
            <p class="mui--d-inlineblock profile-create-btn"><a class="mui-btn mui-btn--primary mui-btn--raised" href="{{ profile.url_for('new_project') }} ">{{ faicon(icon='plus', icon_size='caption') }}  {% trans %}New project{% endtrans %}</a>
          {% elif profile.features.make_public() %}
            <p class="mui--d-inlineblock profile-create-btn"><a class="mui-btn mui-btn--primary mui-btn--raised" href="#make-public-modal" rel="modal:open">{% trans %}Make profile public{% endtrans %}</a>
          {% endif %}
          {%- if profile.current_roles.admin %}
            <div class="mui--d-inlineblock {% if profile.features.new_user_project() %}floating-menu-btns{% endif %}">{{ profile_admin_buttons(profile) }}</p></div>
          {% endif %}
        </div>
      </div>
      </div>
    </div>
  </div>
  <div class="sub-navbar-container sub-navbar-container--sticky mui--bg-accent {% if class %}{{ class }}{% endif %}">
    <nav class="sub-navbar mui-container" id="page-navbar">
      {% if profile.is_organization_profile %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light mui--hidden-xs mui--hidden-sm {% if current_page == 'profile' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'profile' -%}{{ profile.url_for() }}{%- endif %}" data-cy-navbar="profile">{% trans %}Home{% endtrans %}</a>
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'admins' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'admins' -%}{{ profile.urls['members'] }}{%- endif %}" data-action="manage-profile-admins" data-cy-navbar="admins">{% trans %}Admins{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {% else %}
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'profile' %}sub-navbar__item--active{%- endif %}" href="{{ profile.url_for() }}">{% trans %}Sessions{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'projects' %}sub-navbar__item--active{%- endif %}" href="{{ profile.url_for('user_participated_projects') }}">{% trans %}Projects{% endtrans %}<span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'proposals' %}sub-navbar__item--active{%- endif %}" href="{{ profile.url_for('user_proposals') }}">{% trans %}Proposals{% endtrans %}<span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {% endif %}
    </nav>
  </div>
</div>
{% endmacro %}

{% macro comments_tree() %}
  {% raw %}
    <div id="comments-wrapper" v-cloak>
      <ul class="mui-list--unstyled" v-for="comment in comments">
        <comment :comment="comment" :isuserparticipant="isuserparticipant"></comment>
      </ul>
      <div class="ajax-form">
        <component :is="Form"></component>
        <button class="mui-btn mui-btn--raised mui-btn--accent ajax-form_cancelbtn" @click="closeForm($event)" v-if="commentForm">Cancel</button>
        <p class="mui--text-subhead mui--text-danger mui--text-right" v-if="errorMsg">{{ errorMsg }}</p>
      </div>
      <p class="mui-panel mui--bg-accent" v-if="isuserloggedin && !isuserparticipant">You need to be a participant to comment.</p>
      <a class="post-form-block" @click="fetchForm($event, newCommentUrl)" aria-label="Post comment" data-cy="post-comment" v-if="isuserparticipant && !commentForm">
        <div class="user">
          <div class="user__box">
            <div class="user__box__gravatar user__box__gravatar--initials">{{ getInitials(user) }}</div>
            <input type="text" placeholder="Post commentâ€¦" />
          </div>
        </div>
      </a>
      <a class="mui-btn mui-btn--small mui-btn--raised mui-btn--primary" :href="loginUrl" data-cy="login-btn" v-if="!isuserloggedin">Login to leave a comment</a>
    </div>
    <script type="text/x-template" id="comment-template">
      <li class="comment">
        <div :id="'#c-' + comment.uuid_b58">
          <div class="comment__header">
            <button class="mui-btn mui-btn--nostyle" aria-label="Hide comment" aria-expanded="true" v-if="!hide" @click="collapse(true)">
              <svg class="fa5-icon fa5-icon--subhead test fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#caret-circle-up'"></use></svg>
            </button>
            <button class="mui-btn mui-btn--nostyle" aria-expanded="false" aria-label="Collapse comment" v-else @click="collapse(false)">
              <svg class="fa5-icon fa5-icon--subhead test fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#caret-circle-down'"></use></svg>
            </button>
            <div class="comment__header__details user">
              <div class="user__box" v-if="!comment.state">
                <img class="user__box__gravatar" :src="comment.user.avatar" v-if="comment.user.avatar"/>
                <div class="user__box__gravatar user__box__gravatar--initials" v-else-if="comment.user.fullname !== '[deleted]'">{{ getInitials(comment.user.fullname) }}</div>
                <div class="user__box__gravatar user__box__gravatar--initials" v-else>{{ getInitials() }}</div>
                <div class="mui--d-inlineblock">
                  <h3 class="mui--text-body2 user__box__fullname zero-bottom-margin">{{ comment.user.fullname }}</h3>
                  <h3 v-if="comment.user.username" class="mui--text-caption user__box__userid"><span>@{{ comment.user.username }}</span></h3>
                </div>
                <div class="mui--d-inlineblock">
                  <span class="commenter" v-if="comment.state && comment.state.DELETED">[deleted]</span>
                  <span class="commenter" v-if="comment.state && comment.state.SPAM">[removed]</span>
                  <span class="badge" v-for="badge in comment.badges">{{ badge }}</span>
                  <span class="mui--text-caption mui--text-accent">{{ created_at_age }}</span>
                  <span class="mui--text-caption mui--text-accent" v-if="comment.edited_at">(edited {{ edited_at_age }})</span>
                </div>
              </div>
            </div>
          </div>
          <transition name="slide">
            <div class="comment__body" v-if="!hide">
              <div v-if="!comment.state" v-html="comment.message.html"></div>
              <div>
                <a class="mui--text-menu mui--text-accent link" data-cy="reply" v-if="isuserparticipant"  @click="fetchForm($event, comment.urls.reply)">[Reply]</a>
                <a class="mui--text-menu mui--text-accent link" data-cy="report-spam" v-if="isuserparticipant" @click="fetchForm($event, comment.urls.report_spam)">[Report Spam]</a>
                <a class="mui--text-menu mui--text-accent link" data-cy="edit" v-if="comment.urls.edit" @click="fetchForm($event, comment.urls.edit)" v-if="comment.urls.edit">[Edit]</a>
                <a class="mui--text-menu mui--text-accent link" data-cy="delete" v-if="comment.urls.delete"  @click="fetchForm($event, comment.urls.delete)">[Delete]</a>
                <a class="mui--text-menu mui--text-accent comment--permalink" :href="'#c-' + comment.uuid_b58">[Link]</a>
              </div>
              <div class="ajax-form ">
                <component :is="Form"></component>
                <button class="mui-btn mui-btn--raised mui-btn--accent ajax-form__cancelbtn" @click="closeForm($event)" v-if="commentForm">Cancel</button>
                <p class="mui--text-subhead mui--text-danger mui--text-right" v-if="errorMsg">{{ errorMsg }}</p>
              </div>
              <ul class="mui-list--aligned mui-list--unstyled comment--children" v-for="child_comment in comment.replies">
                <comment :comment="child_comment" :isuserparticipant="isuserparticipant"></comment>
              </ul>
            </div>
          </transition>
        </div>
      </li>
    </script>
  {% endraw %}
{% endmacro %}

{% macro project_mini_header(project) %}
  <h1 class="mui--text-display1"><a href="{{ project.url_for() }}"><strong>{{ project.title }}</a></strong></h1>
  <p class="mui--text-headline">{{ project.tagline }}</p>
  <p>
  {% if project.features.tickets_or_rsvp() %}
    <a class="mui-btn mui-btn--primary mui--d-inlineblock" href="{{ project.url_for() }}#tickets" data-action="Tickets(header-proposalpage)">
      {%- if project.features.tickets() -%}
        {% if project.boxoffice_data.buy_btn_text -%}
          {{ project.boxoffice_data.buy_btn_text }}
        {% else %}
          {% trans %}Tickets{% endtrans %}
        {% endif %}
      {%- else -%}
        {% trans %}Attend{% endtrans %}
      {%- endif %}
    </a>
  {% endif %}
  {% if project.cfp_state.OPEN -%}
    <a class="mui-btn mui-btn--flat mui-btn--nopadding" href="{{ project.url_for('new_proposal') }}" data-action="Propose a session(header)">{{ faicon(icon='microphone-alt') }} {% trans %}Submit a session proposal{% endtrans %}</a>
  {% endif %}
  </p>
{% endmacro %}

{% macro updates_template() %}
  {% raw %}
    <div id="updates-wrapper" v-cloak>
      <div v-if="isEditor">
        <h2 class="mui--text-headline mui--text-left" v-if="draft">Draft</h2>
        <ul v-if="draft" class="draft-updates">
          <li v-for="update in draft"><a :href="update.urls.view">{{ update.title }}</a></li>
        </ul>
      </div>
      <ul class="mui-list--unstyled" v-if="updates.length > 0">
        <update :update="update" :iseditor="isEditor" v-for="update in updates"></update>
      </ul>
    </div>

    <script type="text/x-template" id="update-template">
      <li class="update user" :id="'#update-' + update.uuid_b58">
        <div class="mui--clearfix">
          <div class="mui--pull-left">
            <ul class="bullet-separated-list mui--text-light mui--text-body2 update__date" v-if="update.number">
              <li><a class="mui--text-uppercase mui--text-light" :href="update.urls.view">Update #{{ update.number }}</a></li>
              <li v-if="age"><a class="mui--text-light" :href="update.urls.view">{{ age }}</a></li>
              <li v-if="update.visibility_label == 'Restricted'"><svg class="fa5-icon fa5-icon--body2 fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#lock-alt'"></use></svg></li>
              <li v-if="update.is_pinned"><svg class="fa5-icon fa5-icon--body2 mui--align-middle" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#thumbtack'"></use></svg></li>
            </ul>
          </div>
          <div class="mui--pull-right">
            <a class="mui--text-menu mui--text-hyperlink right-padding" :href="update.urls.view" aria-label="Share this update"><svg class="fa5-icon fa5-icon--subhead fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#share-square'"></use></svg></a>
            <div class="mui-dropdown" v-if="iseditor">
              <a href="javascript:void(0)" class="mui--text-dark" data-mui-toggle="dropdown"><svg class="fa5-icon fa5-icon--subhead fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#ellipsis-v'"></use></svg></a>
              <ul class="mui-dropdown__menu mui-dropdown__menu--right" data-cy="share-dropdown">
                <li><a v-if="update.urls.edit" :href="update.urls.edit">Edit</a></li>
                <li><a v-if="update.urls.delete" :href="update.urls.delete">Delete</a></li>
              </ul>
            </div>
          </div>
        </div>
        <p class="mui--text-headline mui--text-bold"><a class="mui--text-dark" :href="update.urls.view">{{ update.title }}</a></p>
        <div class="user__box mui--clearfix update__header">
          <img class="user__box__gravatar" :src="update.user.avatar" v-if="update.user.avatar"/>
          <div class="user__box__gravatar user__box__gravatar--initials" v-else>{{ getInitials(update.user.fullname) }}</div>
          <div class="mui--d-inlineblock">
            <h3 class="mui--text-body2 user__box__fullname zero-bottom-margin">{{ update.user.fullname }}</h3>
            <h3 v-if="update.user.username" class="mui--text-caption user__box__userid"><span>@{{ update.user.username }}</span></h3>
          </div>
        </div>
        <div v-if="!update.is_currently_restricted">
          <div class="update__content mui--text-light" v-if="truncated" :inner-html.prop="truncate(update.body.html, 250)"></div>
          <div class="update__content mui--text-light fullcontent" v-else v-html="update.body.html"></div>
          <p class="mui--text-body2">
            <a @click="readMore($event, false)" v-if="setReadMore" class="read-more" aria-label="read more"><svg class="fa5-icon fa5-icon--caption fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#caret-circle-down'"></use></svg> Read more</a></p>
            <a @click="readMore($event, true)" v-if="!truncated && !setReadMore" class="read-more" aria-label="hide"><svg class="fa5-icon fa5-icon--caption fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#caret-circle-up'"></use></svg> Hide</a>
          </p>
        </div>
        <div v-else>
          <p class="mui--text-body2 mui--text-light mui--text-center top-padding zero-bottom-margin"><svg class="fa5-icon fa5-icon--caption fa5--align-baseline" aria-hidden="true" role="img"><use v-bind:xlink:href="svgIconUrl + '#lock-alt'"></use></svg> <em>This update is for participants only</em></p>
        </div>
        <hr class="mui--visible-xs-block mui--visible-sm-block">
      </li>
    </script>
  {% endraw %}
{% endmacro %}

{% macro page_footer() %}
  <div class="sub-navbar-container sub-navbar-container--footer mui--bg-accent">
    <nav class="sub-navbar mui-container" id="page-navbar">
      <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if path == 'index' %}sub-navbar__item--active{%- endif %}" href="/about">{% trans %}About Hasgeek{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-dark" href="/hasgeek">{% trans %}Team &amp; careers{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if path == 'contact' %}sub-navbar__item--active{%- endif %}" href="/about/contact">{% trans %}Contact{% endtrans %}</a>
      <a class="sub-navbar__item mui--text-subhead mui--text-dark {% if path == 'policy/terms' %}sub-navbar__item--active{%- endif %}" href="/about/policy/terms">{% trans %}Site policies{% endtrans %}</a>
    </nav>
  </div>
{% endmacro %}

{% macro video_thumbnail(session) %}
  <div class="video">
    <a class="video__thumbnail {%- if not (session.video.thumbnail or session.banner_image_url.url) %} video__thumnail--novideo {%- endif %}" href="{%- if session.proposal %}{{ session.proposal.url_for() }}{%- else %}{{ session.url_for() }}{%- endif %}"  data-action="view session video">
      {%- if session.video.thumbnail %}
        <img src="{{ session.video.thumbnail }}" class="video__thumbnail__img img-responsive" data-cy="thumbnail">
        <div class="video__thumbnail__icon">{{ faicon(icon='play-circle', icon_size='headline', baseline=false) }}</div>
      {%- elif session.banner_image_url.url %}
        <img src="{{ session.banner_image_url }}" class="video__thumbnail__img img-responsive" data-cy="thumbnail">
      {%- endif %}
    </a>
    <p class="mui--text-subhead mui--text-bold video__txt" data-cy="title">{{ session.title }}</p>
    {%- if session.speaker %}<p class="mui--text-body2 mui--text-light video__txt">{{ session.speaker }}</p>{%- endif %}
    {%- if session.video %}
      <div class="mui--text-caption mui--text-light">
          {%- if session.video.duration %}<span class="js-video-duration" data-duration="{{ session.video.duration }}"></span>{%- endif %}
          {%- if session.video.uploaded_at %}<span class="mui--pull-right">{{ session.video.uploaded_at|longdate }}</span>{%- endif %}
      </div>
    {%- else %}
    <div class="mui--text-caption mui--text-light">
      {%- if session.start_at_localized %}<span>{{ session.start_at_localized|date }}</span>{%- endif %}
    </div>
    {%- endif %}
  </div>
{% endmacro %}

{%- macro proposal_list(proposals, project='') %}
  <table id="proposals-table" class="proposal-list-table mui-table">
    <tbody>
      {% for proposal in proposals %}
        <tr id="{{ proposal.uuid_b58 }}">
          <td class='js-searchable'>
            <h3 class="mui--text-title zero-top-margin"><a href="{{ proposal.url_for() }}" class="mui--text-title mui--text-bold nounderline" data-cy-proposal="{{ proposal.title }}">{{ proposal.title }}</a></h3>
            <p class="speaker-details">
              {% if not project %}
                <span class="mui--text-subhead">{{ proposal.project.title }}</span>
              {%- elif proposal.speaker -%}
                <span class="mui--text-subhead">{{ proposal.speaker.pickername }}</span>
                {%- if proposal.user != proposal.speaker %}
                  <small class="mui--text-caption mui--text-accent">via {{ proposal.user.pickername }}</small>
                {%- endif %}
                {%- if project and project.current_roles.editor %}
                  {%- if proposal.has_outstation_speaker %}
                    {{ faicon(icon='plane', icon_size='subhead', baseline=false, css_class='mui--align-middle') }}
                    <span class="mui--hide" aria-label="{% trans %}Outstation speaker{% endtrans %}"></span>
                  {%- endif %}
                {%- endif %}
              {%- else -%}
                <span class="mui--text-subhead">{{ proposal.user.pickername }}</span> <em class="mui--text-caption mui--text-accent">{% trans %}(proposing){% endtrans %}</em>
              {%- endif -%}
            </p>
            <ul class="mui-list--inline mui--text-body2 list-item-rgborder zero-bottom-margin">
              {%- if proposal.project != project %}
                <li>{{ proposal.project.short_title }}</li>
              {% endif %}
              {%- if proposal.commentset %}
                <li>{{ proposal.commentset.count }} comments</li>
              {% endif %}
              {% if not project %}
                <li>
                  {{ proposal.state.label.title }}
                </li>
              {% endif %}
              <li class="no-border">{{ proposal.datetime|datetime(format='EEE, dd MMM') }}</li>
              {% if proposal.video %}
                <li class="no-border" data-toggle="tooltip" data-placement="top" title="{% trans %}This proposal has a preview video{% endtrans %}" aria-label="{% trans %}This proposal has a preview video{% endtrans %}">
                  {{ faicon(icon='video', icon_size='subhead', baseline=false, css_class='mui--align-middle') }}
                </li>
              {% endif %}
              {% if proposal.slides.url %}
                <li class="no-border" data-toggle="tooltip" data-placement="top" title="{% trans %}This proposal has slides{% endtrans %}" aria-label="{% trans %}This proposal has slides{% endtrans %}">
                  {{ faicon(icon='presentation', icon_size='subhead', baseline=false, css_class='mui--align-middle') }}
                </li>
              {% endif %}
            </ul>
          </td>
        </tr>
      {% else %}
        <tr>
          <td><em>{% trans %}(No sessions have been submitted){% endtrans %}</em></td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{%- endmacro %}

{%- macro user_avatar(user, css_class='') %}
  {% if user and user.avatar %}
    <img class="user__box__gravatar {% if css_class %}{{ css_class }}{% endif %}" src="{{ user.avatar }}"/>
  {%- else %}
    <div class="user__box__gravatar user__box__gravatar--initials {% if css_class %}{{ css_class }}{% endif %}">{{ user.fullname|initials }}</div>
  {% endif %}
{%- endmacro %}
