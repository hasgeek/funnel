{% from "baseframe/forms.html.jinja2" import renderform %}
{% from "baseframe/components.html.jinja2" import faicon, alertbox %}

{% macro calendarwidget(calendar, compact=true) %}
  <div class="card__calendar {% if compact %} card__calendar--compact {% endif %}" aria-hidden="true">
    <div class="calendar">
      {% set event = namespace(month='', year='', first_week='', previous='', next='') %}
      <div class="calendar__weekdays mui--bg-accent {% if calendar.weeks|length > 1 %} calendar__weekdays--rows {% endif %}">
        {% for week in calendar.weeks|sort(attribute='year') %}
          {% set event.previous = false %}
          {% set event.next = false %}
          {% if not event.first_week and week.upcoming %}
            {% set event.first_week = week %}
            {% if loop.index0 > 0 %}
              {% set event.previous = true %}
            {% endif %}
            {% if loop.index != calendar.weeks|length and calendar.weeks[loop.index].upcoming %}
              {% set event.next = true %}
            {% endif %}
          {% endif %}
          <p class="calendar__month-name {% if week.upcoming %}calendar__month-name--upcoming{% endif %} {% if event.first_week == week %}calendar__month-name--upcoming--first calendar__month-name--latest{% endif %} {% if week.month != event.month %}calendar__month-name--unique{% endif %} {% if loop.index == calendar.weeks|length and not week.upcoming %}calendar__month-name--latest{% endif %}">{{ week.month }} {{ week.year }}<span class="calendar__counting" data-today="{{ calendar.today }}" data-month="{{ week.month }}"></span></p>
          {% set event.month = week.month  %}
          {% set event.year = week.year  %}
          <div class="calendar__weekdays__dates {% if week.upcoming %}calendar__weekdays__dates--upcoming{% endif %} {% if event.first_week == week %}calendar__weekdays__dates--upcoming--first calendar__weekdays__dates--latest {% endif %} {% if loop.index == calendar.weeks|length and not week.upcoming %}calendar__weekdays__dates--latest {% endif %}"  data-month="{{ week.month }}">
            {% if event.previous  %}
              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__icon calendar__weekdays__dates__icon--left">
                {{ faicon(icon='chevron-left',  baseline=false, css_class='calendar__weekdays__dates__icon__next') }}
              </p>
            {% endif %}
            {% for date in week.dates %}
              <p class="calendar__weekdays__dates__date {% if date.count > 0 %}calendar__weekdays__dates__date--active {% elif date.isoformat == calendar.today %} calendar__weekdays__dates__date--today{% endif %} {% if date.day_start_at %} calendar__weekdays__dates__date--showtime{% endif %}" {% if date.count > 0 %} data-event-date="{{ date.isoformat }}" {% endif %} data-event-month="{{ week.month }}">
                <span class="calendar__weekdays__dates__date__day">{{ date.day }}</span>
                <span class="calendar__weekdays__dates__date__name">{{ calendar.days[loop.index-1] }}</span>
                {% if date.day_start_at %}<span class="calendar__weekdays__dates__time">{{ date.day_start_at }} – {{ date.day_end_at }}</span>{% endif %}
              </p>
            {% endfor %}
            {% if event.next  %}
              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__icon calendar__weekdays__dates__icon--right">
                {{ faicon(icon='chevron-right',  baseline=false, css_class='calendar__weekdays__dates__icon__next') }}
              </p>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    </div>
  </div>
{% endmacro %}

{% macro saveprojectform(project, form, formid='save-form', txt=false) %}
  <form id={{formid}} class="js-save-form" action="{{ project.url_for('save') }}" method="POST">
    {{ form.hidden_tag() }}
    <p class="no-jshidden zero-bottom-margin">
      {%- if current_auth.is_anonymous %}
        <a class="mui--text-body2"  href="{{ url_for('login') }}" data-action="Login to save project"><span class="mui--text-body2 mui--text-light login-txt">{% trans %}Login{% endtrans %} <span class="mui--hidden-xs mui--hidden-sm">{% trans %}to save{% endtrans %}</span></span>{{ faicon(icon='bookmark', css_class='mui--text-light') }}</a>
      {%- else %}
        <input type="hidden" name="save" value="">
        <button type="submit" value="true" class="mui-btn mui-btn--nostyle animate-btn {% if not project.is_saved_by(current_auth.user) %} animate-btn--show {% endif %}" data-action="Save {{project.title}}" onclick="this.form.save.value=this.value" data-cy="bookmark">{% if txt %}<span class="mui--text-body2 mui--text-light txt">{% trans %}Save <span class="mui--hidden-xs mui--hidden-sm">this project</span>{% endtrans %}</span>{% endif %}{{ faicon(icon='bookmark', icon_size='caption', baseline=false, css_class='mui--text-light') }}
        </button>
        <button type="submit" value="false" class="mui-btn mui-btn--nostyle animate-btn animate-btn--saved{% if project.is_saved_by(current_auth.user) %} animate-btn--show {% endif %}" data-action="Unsave {{project.title}}" onclick="this.form.save.value=this.value" data-cy="bookmarked">{% if txt %}<span class="mui--text-body2 mui--text-light txt">{% trans %}Unsave <span class="mui--hidden-xs mui--hidden-sm">this project</span>{% endtrans %}</span>{% endif %}{{ faicon(icon='bookmark-solid', icon_size='caption', baseline=false, css_class='bookmarked') }}</button>
      {%- endif %}
    </p>
  </form>
{% endmacro %}

{% macro share_dropdown(url, title) %}
  <ul class="mui-dropdown__menu mui-dropdown__menu--right" data-cy="share-dropdown">
    <li><a class="details__box__control__link mui--text-title" target="_blank" href="//twitter.com/share?url={{ url }}&amp;via=HasGeek&amp;text={{ title }}&amp;utm_campaign=share-twitter" data-url="{{ url }}" data-via="HasGeek" data-text="{{ title }}" data-action="Tweet video">Twitter</a></li>
    <li><a class="details__box__control__link mui--text-title" target="_blank" href="//www.facebook.com/sharer.php?u={{ url }}&amp;t={{ title }}&amp;utm_campaign=share-facebook" data-href="{{ url }}" data-action="Share video on facebook">Facebook</a></li>
    <li><a class="details__box__control__link mui--text-title" href="mailto:?subject={{ title }}&amp;body={{ url }}&amp;utm_campaign=share-email" data-action="Email video">Email</a></li>
    <li><a class="details__box__control__link mui--text-title" href="https://www.linkedin.com/shareArticle?mini=true&url={{ url }}&title={{ title }}&amp;utm_campaign=share-linkedin" data-action="Share about {{ title }} on linkedin">Linkedin</a></li>
  </ul>
{% endmacro %}

{% macro project_share(project, project_save_form) %}
  <div class="project-banner__footer">
    <div class="bookmark">{{ saveprojectform(project, project_save_form, txt=true) }}</div>
    {% if project.schedule_state.PUBLISHED %}
      <a class="add-calendar" aria-label="Add to calendar" href="{{ project.url_for('subscribe_schedule') }}" rel="modal:open" aria-label="Add to calendar" data-action="Add to calendar" data-cy="add-to-calendar"><span class="mui--text-body2 mui--text-light txt">{% trans %}Add to calendar{% endtrans %}</span>{{ faicon(icon='calendar-plus', baseline=false, css_class='mui--text-light') }}</a>
    {% endif %}
    <div class="mui-dropdown">
      <a href="javascript:void(0)" class="details__box__control__link mui--text-subhead share" data-mui-toggle="dropdown" data-action="Share dropdown" data-cy="share-project"><span class="mui--text-body2 mui--text-light txt">{% trans %}Share <span class="mui--hidden-xs mui--hidden-sm">this project</span>{% endtrans %}</span>{{ faicon(icon='share-square', icon_size='subhead', baseline=false, css_class='mui--text-light') }}</a>
      {{ share_dropdown(project.url_for(_external=true), project.title) }}
    </div>
  </div>
{% endmacro %}

{% macro livestream_edit_btn(project) %}
  {% if project.view_for('edit_livestream').is_available() %}
    <a href="{{ project.url_for('edit_livestream') }}" class="mui-btn mui-btn--primary mui-btn--raised project-banner__box__add-btn">{% trans %}Update livestream URLs{% endtrans %}</a>
  {% endif %}
{% endmacro %}

{% macro project_header(project, project_save_form, csrf_form, class='', current_page='project') %}
  <div class="mui-container project-banner {% if class %}{{ class }}{% endif %}">
    <div class="grid">
      {% if project.view_for('edit').is_available() and project.features.schedule_no_sessions() %}
        <div class="grid__col-sm-12">
          {{ alertbox('warning', 'This project will not be listed as it has no sessions in the schedule') }}
        </div>
      {% endif %}
      {% if project.view_for('view').is_available() and project.state.DRAFT %}
      <div class="grid__col-sm-12">
        {{ alertbox('warning', 'This project is currently not published') }}
      </div>
      {% endif %}
      <div class="grid__col-sm-12">
        <div class="profile-details">
          {%- if project.profile.logo_url.url %}
            <a href="{{ project.profile.url_for() }}" class="profile-details__logo-wrapper" data-action="View {{ project.profile.title }}(project page)">
              <img class="profile-details__logo_wrapper__logo" src="{{ project.profile.logo_url }}" alt="{{ project.profile.title }}"/>
            </a>
          {% endif %}
          <a href="{{ project.profile.url_for() }}" class="mui--text-subhead mui--text-bold profile-details__text" data-cy="profile-link" data-action="View {{ project.profile.title }}(project page)">{{ project.profile.title }}</a>
        </div>
      </div>
      <div class="grid__col-sm-12 project-banner__headline">
        <h1 class="mui--text-display1 mui--text-bold">{{ project.title }}
          {% if project.view_for('edit_slug').is_available() %}
            <a class="mui--text-body2" href="{{ project.url_for('edit_slug') }}" aria-label="edit project url" data-action="edit project url">{% trans %}Edit url{% endtrans %} {{ faicon(icon='edit') }}</a>
          {% endif %}
        </h1>
        <p class="mui--text-headline mui--text-light zero-bottom-margin">{{ project.tagline }}</p>
      </div>
      {% if project.livestream_urls %}
        <div role="tabpanel" class="grid__col-sm-12 grid__col-md-8 livestream-box" id="livestream">
          <ul class="mui-tabs__bar project-banner__box" role="tablist">
            {%- for stream in project.livestream_urls %}
              <li role="presentation" {%- if loop.first %} class="mui--is-active"{% endif %}>
                <a role="tab" data-mui-toggle="tab" data-mui-controls="pane-justified-{{ loop.index }}">Livestream {{loop.index}}</a>
              </li>
            {%- endfor %}
          </ul>

          {%- for stream in project.livestream_urls %}
            <div role="tabpanel" class="mui-tabs__pane {%- if loop.first %} mui--is-active{% endif %}" id="pane-justified-{{ loop.index }}">
              <div class="project-banner__box">
                {{ livestream_edit_btn(project) }}
                <div class="embed-video-wrapper js-embed-video" data-video-src="{{ stream }}">
                  <p class="video_txt">
                    {{ faicon(icon='video', icon_size='display1') }}<br>
                    <a href="{{ stream }}" target="_blank" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
                  </p>
                </div>
              </div>
            </div>
          {%- endfor %}
          {{ project_share(project, project_save_form) }}
        </div>
      {% else %}
        <div class="grid__col-sm-12 grid__col-md-8 project-banner__box">
          {{ livestream_edit_btn(project) }}
          <div class="embed-video-wrapper">
            {% if project.banner_video_url.url %}
              <div class="embed-video-wrapper js-embed-video" data-video-src="{{ project.banner_video_url }}">
                <p class="video_txt">
                  {{ faicon(icon='video', icon_size='display1') }}<br>
                  <a href="{{ project.banner_video_url }}" target="_blank" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
                </p>
              </div>
            {%- elif project.bg_image.url %}
              <img class="project-banner__box__image" src="{{ project.bg_image }}" alt="{{ project.title }}" data-cy="bg_image"/>
            {%- else %}
              <img class="project-banner__box__image" src="{{ url_for('static', filename='img/default-banner.png') }}"/>
            {% endif %}
          </div>
          {{ project_share(project, project_save_form) }}
        </div>
      {% endif %}
      <div class="grid__col-md-4 project-details__box {% if project.livestream_urls %}project-details__box--topmargin{% endif %}">
        {% if project.schedule_state.PUBLISHED and project.calendar_weeks_full.weeks and project.calendar_weeks_full.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_full, compact=false) }}
          </div>
        {% endif %}
        <div class="project-details__box--ticketbox">
          {% if project.features.tickets()  %}
            <div class="mui--hidden-xs mui--hidden-sm">
              <a href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#tickets" class="mui-btn mui-btn--raised mui-btn--primary mui--d-block {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" data-action="Get tickets(header)" id="get-tickets">
              {% trans %}Get tickets{% endtrans %}</a>
            </div>
          {% elif project.features.rsvp() %}
            {%- if current_auth.is_anonymous %}
              <p class="mui--text-body2 mui--text-light">{{ project.views.registration_text() }}</p>
              <a class="mui-btn mui-btn--raised mui-btn--primary  mui--d-block"  href="{{ url_for('login') }}" data-action="Login to register">Login to register</a>
            {% elif project.features.rsvp_unregistered() -%}
              <p class="mui--text-body2 mui--text-light">{{ project.views.registration_text() }}</p>
              <a class="mui-btn mui-btn--raised mui-btn--primary  mui--d-block" href="#register-modal" id="register-btn">{% trans %}Register{% endtrans %}</a>
              <div class="modal reg-modal" id="register-modal">
                <div class="modal__header">
                  <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
                  <p class="mui--text-title mui--text-bold mui--text-dark reg-modal__txt">{{ project.title }}</p>
                </div>
                <div class="modal__body">
                  <p class="mui--text-body2 reg-modal__txt">{% trans %}This will share your name and email address with the project’s crew so they can keep you updated. You can cancel your registration at any time.{% endtrans %}</p>
                  <form action="{{ project.url_for('register') }}" method="post" class="form-inline">
                    {{ csrf_form.hidden_tag() }}
                    <div class="mui--text-right modal__body__btn">
                      <button class="mui-btn mui-btn--small mui-btn--flat mui-btn--primary" type="submit" name="submit" value="yes" data-cy="confirm">{% trans %}Confirm{% endtrans %}</button>
                    </div>
                  </form>
                </div>
              </div>
            {%- elif project.features.rsvp_registered() %}
              <p class="mui--text-body2 mui--text-light">{{ faicon(icon='check', baseline=false, css_class='mui--align-middle mui--text-success check-icon') }}{{ project.views.registration_text() }}</p>
              <a class="mui-btn mui-btn--raised mui--d-block" href="#register-modal" id="register-btn">{% trans %}Cancel registration{% endtrans %}</a>
              <div class="modal reg-modal" id="register-modal">
                <div class="modal__header">
                  <a class="modal__close mui--text-dark" href="javascript:void(0);" data-target="close cancel register modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close">{{ faicon(icon='times', icon_size='title') }}</a>
                  <p class="mui--text-title mui--text-bold mui--text-dark reg-modal__txt">{{ project.title }}</p>
                </div>
                <div class="modal__body">
                  <p class="mui--text-subhead reg-modal__txt">{% trans %}Can’t make it?{% endtrans %}</p>
                  <form action="{{ project.url_for('deregister') }}" method="post" class="form-inline">
                    {{ csrf_form.hidden_tag() }}
                    <div class="mui--text-right modal__body__btn">
                      <button class="mui-btn mui-btn--small mui-btn--flat mui-btn--primary" type="submit" name="submit" value="no">{% trans %}Confirm cancellation{% endtrans %}</button>
                    </div>
                  </form>
                </div>
              </div>
            {%- endif %}
            {% if project.view_for('rsvp_list').is_available() %}
              <a href="{{ project.url_for('rsvp_list') }}" class="mui--d-block mui--text-center" data-cy="see-responses">{% trans %}View participants{% endtrans %}</a>
            {% endif %}
          {% elif project.view_for('edit_schedule').is_available() %}
            <a class="mui-btn mui-btn--raised mui-btn--accent  mui--d-block" href="{{ project.url_for('edit_schedule') }}">{% trans %}Add schedule to enable rsvp{% endtrans %}</a>
          {%- endif %}
          <hr class="mui-divider">
          {% if project.cfp_state.OPEN -%}
            <div class="propose propose--lessmargin">
              <a class="mui-btn mui-btn--raised mui--d-block propose__btn" href="{{ project.url_for('new_proposal') }}" data-action="Submit a session proposal(header)" data-cy="propose-a-session">{% trans %}Submit a session proposal{% endtrans %}</a>
              {% if project.cfp_end_at_localized -%}<p class="propose__txt">{{ faicon(icon='info-circle', css_class='secondary-color-txt') }} <em class="mui--text-light">{% trans date=project.cfp_end_at_localized|datetime %}Proposal submission closes on {{ date }}{% endtrans %}</em></p>{% endif %}
            </div>
          {% elif project.view_for('cfp').is_available() -%}
            <div class="propose propose--lessmargin">
              <a href="{{ project.url_for('cfp') }}" class="mui-btn mui-btn--raised mui-btn--dark mui--d-block">
                {% if project.cfp_state.DRAFT or project.cfp_state.PRIVATE_DRAFT or project.cfp_state.UNAVAILABLE -%}
                  {% trans %}Open proposal submissions{% endtrans %}
                {%- else %}
                  {% trans %}Add proposal guidelines{% endtrans %}
                {%- endif %}
              </a>
            </div>
          {%- elif project.cfp_state.UNAVAILABLE %}
            <div class="propose propose--lessmargin">
              <a class="mui-btn mui-btn--raised mui--d-block propose__btn propose__btn--strike" data-cy="Submit a session proposal" data-action="Propose a session(closed)">{% trans %}Submit a session proposal{% endtrans %}</a>
              <p class="mui--text-light mui--text-caption mui--text-center zero-bottom-margin">{% trans %}Submissions are closed for this project{% endtrans %}</p>
            </div>
          {%- endif %}
          {%- if project.primary_venue %}
            <p class="project-venue"><a class="mui--text-hyperlink mui--text-subhead {% if current_page == 'project' %}js-smooth-scroll{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#venue" data-action="Venue(header)" data-action="Venue(header)">{{ faicon(icon='map-marker-alt') }} <span>{{ project.primary_venue.title }}</span>{%- if project.primary_venue.city %}, <span>{{ project.primary_venue.city }}</span>{%- endif %}</a></p>
          {% elif project.view_for('venues').is_available() %}
            <a href="{{ project.url_for('venues') }}" class="mui-btn mui-btn--raised mui--d-block mui-btn--accent">{% trans %}Add venue{% endtrans %}</a>
          {%- endif %}
        </div>
      </div>
    </div>
  </div>
  <div class="sub-navbar-container sub-navbar-container--sticky mui--bg-accent {% if class %}{{ class }}{% endif %}">
    <nav class="sub-navbar mui-container" id="page-navbar">
      <a class="sub-navbar__item mui--text-subhead mui--text-light mui--hidden-xs mui--hidden-sm {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#about" data-action="About(navbar)" data-cy-navbar="about">{% trans %}About{% endtrans %}</a>
      {% if project.features.tickets() -%}
        <div class="sub-navbar__item--wrapper" id="ticket-wrapper"><a href='#tickets' class="open-ticket-widget sub-navbar__item sub-navbar__item--primarybg mui--text-subhead mui--text-light mui--hidden-md mui--hidden-lg mui--hidden-xl" data-action="Tickets(navbar)" id="ticket-btn" data-cy-navbar="tickets">{% trans %}Get tickets{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a></div>
      {%- endif %}
      {%- if project.featured_sessions %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#talks" data-action="Talks(navbar)" data-cy-navbar="talks">{% trans %}Talks{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.hasjob_embed_url.url -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#related-jobs" data-action="Jobs(navbar)" data-cy-navbar="jobs">{% trans %}Jobs{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.primary_venue -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'project' %}js-smooth-scroll js-samepage{%- endif %}" href="{%- if current_page != 'project' -%}{{ project.url_for() }}{%- endif %}#venue" data-action="Venue(navbar)" data-cy-navbar="venue">{% trans %}Venue{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'comments' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'comments' -%}{{ project.url_for('comments') }}{%- endif %}" data-action="comments(navbar)" data-cy-navbar="comments">{% trans %}Comments{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- if project.has_sessions_with_video %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'videos' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'videos' -%}{{ project.url_for('session_videos') }}{%- endif %}#videos" data-action="Video(navbar)" data-cy-navbar="video">{% trans %}Video{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.current_roles.editor or not project.cfp_state.NONE -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'proposals' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'proposals' -%}{{ project.url_for('view_proposals') }}{%- endif %}" data-action="Proposals(navbar)" data-cy-navbar="proposals">{% trans %}Proposals{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      {%- if project.schedule_state.PUBLISHED %}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'schedule' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'schedule' -%}{{ project.url_for('schedule') }}{%- endif %}" data-action="Schedule(navbar)" data-cy-navbar="schedule">{% trans %}Schedule{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
      <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'crew' %}sub-navbar__item--active{%- endif %}"" href="{%- if current_page != 'crew' -%}{{ project.url_for('crew') }}{%- endif %}" title="Crew" data-action="Crew(navbar)" data-cy-navbar="crew">{% trans %}Crew{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- if project.current_roles.editor or project.current_roles.concierge or project.current_roles.usher -%}
        <a class="sub-navbar__item mui--text-subhead mui--text-light {% if current_page == 'settings' %}sub-navbar__item--active{%- endif %}" href="{%- if current_page != 'settings' -%}{{ project.url_for('settings') }}{%- endif %}" data-action="Settings(navbar)" data-cy-navbar="settings">{% trans %}Settings{% endtrans %} <span class="sub-navbar__item__icon mui--pull-right">{{ faicon(icon='chevron-right', icon_size='subhead') }}</span></a>
      {%- endif %}
    </nav>
  </div>
{% endmacro %}

{% macro embed_video_player(video) %}
  {% if video.source != 'raw' %}
    <iframe src="{{ video.embeddable_url }}" frameborder="0" allowfullscreen></iframe>
  {% else %}
    <p class="video_txt">
      {{ faicon(icon='video', icon_size='display1') }}<br>
      <a href="{{ video.id }}" target="_blank" class="mui--text-title">{% trans %}Preview video{% endtrans %}</a>
    </p>
  {%- endif %}
{% endmacro %}

{% macro video_action_bar(video, proposal='', session='') %}
  {%- if video.source == 'youtube' -%}
    <p><a href="https://videoken.com" target="_blank" class="mui--text-caption details__box__control__link">Powered by VideoKen</a></p>
  {%- endif %}

  {%- if proposal and 'edit_proposal' in proposal.permissions(current_auth.user) %}
    <a class="details__box__control__link mui--text-subhead" href="{{ proposal.url_for('edit') }}#field-video" data-cy="edit-video" aria-label="{% trans %}Edit proposal video{% endtrans %}">{{ faicon(icon='edit', icon_size='subhead', css_class='fa5--link') }}</a>
  {% elif session and session.project.current_roles.editor %}
    <a class="details__box__control__link mui--text-subhead" href="{{ session.url_for('edit') }}" data-cy="edit-video" aria-label="{% trans %}Edit session video{% endtrans %}">{{ faicon(icon='edit', icon_size='subhead', css_class='fa5--link') }}</a>
  {%- endif %}

  {%- if proposal or session %}
    {%- if proposal %}
      {% set url, title = proposal.url_for(_external=true), proposal.title  %}
    {% else %}
      {% set url, title = session.url_for(_external=true), session.title %}
    {%- endif %}
      <div class="mui-dropdown">
        <a href="javascript:void(0)" class="details__box__control__link mui--text-subhead" data-mui-toggle="dropdown" data-action="Share dropdown" data-cy="share-project">{{ faicon(icon='share-square', icon_size='subhead', css_class=share_icon_css) }}</a>
        {{ share_dropdown(url, title) }}
      </div>
  {%- endif %}
{% endmacro %}

{% macro account_tabs(active_tab='account') %}
  <div class="tabs" id="jquery-scroll-tabs">
    <a class="tabs__item tabs__item-control tabs__item-control--prev mui--text-light js-scroll-prev" aria-label="{% trans %}Previous{% endtrans %}" href="javascript:void(0)"  data-target="prev tab" role="button"  data-action="Previous(tab)">{{ faicon(icon='chevron-left', icon_size='headline') }}
    </a>
    <a {% if active_tab != 'account' %}href="{{ url_for('account') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase  {% if active_tab == 'account' %}tabs__item--active{%- endif %}">{% trans %}Account{% endtrans %}</a>
    <a {% if active_tab != 'saved' %}href="{{ url_for('saved') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase {% if active_tab == 'saved' %}tabs__item--active{%- endif %}">{% trans %}My saves{% endtrans %}</a>
    <a {% if active_tab != 'scan' %}href="{{ url_for('scan_contact') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase {% if active_tab == 'scan' %}tabs__item--active{%- endif %}">{% trans %}Scan badge{% endtrans %}</a>
    <a {% if active_tab != 'contacts' %}href="{{ url_for('contacts') }}"{%- endif %} class="tabs__item mui--text-body2 mui--text-light mui--text-uppercase {% if active_tab == 'contacts' %}tabs__item--active{%- endif %}">{% trans %}Contacts{% endtrans %}</a>
    <a class="tabs__item tabs__item-control tabs__item-control--next mui--text-light js-scroll-next" aria-label="{% trans %}Next{% endtrans %}" href="javascript:void(0)"  data-target="next tab" role="button" data-action="Next(tab)">{{ faicon(icon='chevron-right', icon_size='headline') }}
    </a>
  </div>
{% endmacro %}

{% macro projectcard(project, project_save_form, include_calendar=true, calendarwidget_compact=true) %}
  <a class="card card--upcoming clickable-card" href="{{ project.url_for() }}" aria-label="{{ project.title }}" data-cy-title="{{ project.title }}" data-action="View {{ project.title }}(upcoming)">
    <div class="card__image-wrapper">
      {% if project.bg_image.url %}
        <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
        <noscript>
          <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
        </noscript>
      {% else %}
        <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
        <p class="card__image__tagline mui--text-body2">{{ project.title }}</p>
      {% endif %}
    </div>
    <div class="card__body">
      {%- if not current_auth.is_anonymous and project_save_form %}
        {% set save_form_id = "upcoming_" + project.uuid_b58 %}
        <div class="card__body__bookmark {% if not project.calendar_weeks_compact.weeks %} card__body__bookmark--pushup {% endif %}">{{ saveprojectform(project, project_save_form, save_form_id) }}</div>
      {% endif %}
      {%- if include_calendar%}
        {% if calendarwidget_compact and project.schedule_state.PUBLISHED and project.calendar_weeks_compact.weeks and project.calendar_weeks_compact.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_compact) }}
          </div>
        {% elif project.schedule_state.PUBLISHED and project.calendar_weeks_full.weeks and project.calendar_weeks_full.weeks|length > 0 %}
          <div aria-label="{{ project.datelocation }}">
            {{ calendarwidget(project.calendar_weeks_full, compact=false) }}
          </div>
        {% endif %}
        <h3 class="card__body__title mui--text-subhead {% if not project.calendar_weeks_compact.weeks %} card__body__title--smaller {% endif %}"><span class="mui--text-bold">{{ project.title_inline }}</span> <span class="mui--text-light js-truncate" data-truncate-lines="2">{{ project.tagline }}</span></h3>
        <p class="card__body__location mui--text-light">{% if project.primary_venue %}{{ faicon(icon='map-marker-alt', icon_size='caption', baseline=false) }} {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}{% endif %}</p>
      {% else %}
        <h3 class="card__body__subtitle mui--text-subhead mui--text-bold">{{ project.title }}</h3>
        <p class="mui--text-caption mui--text-light js-truncate" data-truncate-lines="2">{{ project.tagline }}</p>
        <hr class="separator">
        {% if project.cfp_end_at_localized %}<p class="mui--text-caption zero-bottom-margin secondary-color-txt"><em>{% trans date=project.cfp_end_at_localized|datetime(format='dd MMM, YYYY, hh:mm a') %}Submission closes on {{ date }}{% endtrans %}</em></p>{% endif %}
      {% endif %}
    </div>
  </a>
{% endmacro %}

