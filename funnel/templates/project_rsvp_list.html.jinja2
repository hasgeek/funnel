{% extends "layout.html.jinja2" %}
{% set title_suffix = project.title %}
{% block title %}{% trans %}View participants{% endtrans %}{% endblock %}

{% block pageheaders %}
  {% assets "css_footable" -%}
    <link rel="stylesheet" type="text/css" href="{{ ASSET_URL }}" />
  {%- endassets -%}
{% endblock %}

{% block top_title %}
  <h1 class="mui--text-display1"><a href="{{ project.url_for() }}">{{ project.title }}</a></h1>
  <p class="mui--text-headline">{% trans %}View participants{% endtrans %}</p>
{% endblock %}

{% block content %}{% with counts=project.rsvp_counts() %}
  <div role="tabpanel">
    <ul class="mui-tabs__bar mui-tabs__bar--justified" role="tablist">
      {%- for value, status in statuses.items() %}
        <li role="presentation" {%- if loop.first %} class="mui--is-active"{% endif %}>
          <a role="tab" data-mui-toggle="tab" data-mui-controls="pane-justified-{{status.name}}">{{ status.title }} {%- if counts[value] %}&nbsp;&nbsp;<span class="badge mui--text-caption">{{ counts[value] }}</span>{% endif %}</a>
        </li>
      {%- endfor %}
    </ul>
    <hr>

    {%- for value, status in statuses.items() %}
      <div role="tabpanel" class="mui-tabs__pane {%- if loop.first %} mui--is-active{% endif %}" id="pane-justified-{{ status.name }}" data-cy-status="{{ status.name }}">
        <table class="mui-table mui-table--bordered participants">
          <thead>
            <tr>
              <th>Name</th>
              <th>Email</th>
              <th>Responded at</th>
            </tr>
          </thead>
          <tbody>
            {%- for rsvp in project.rsvps_with(value) %}
              <tr>
                <td data-cy="user">{{rsvp.user.fullname}}</td>
                <td>
                  {%- if rsvp.user.email %}
                    {{ rsvp.user.email }}
                  {%- elif rsvp.user.emailclaims %}
                    {{ rsvp.user.emailclaims[0] }} <em>(unverified)</em>
                  {%- elif rsvp.user.phone %}
                    {{ rsvp.user.phone }}
                  {%- endif %}
                </td>
                <td data-cy="user">{{rsvp.updated_at|datetime}}</td>
              </tr>
            {%- else %}
              <tr><td colspan="2"><em>No users</em></td></tr>
            {%- endfor %}
          </tbody>
        </table>
      </div>
    {%- endfor %}
    </div>
  </div>
{% endwith %}{% endblock %}

{% block footerscripts %}
  {% assets "js_footable" -%}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
  {%- endassets -%}
  <script src="{{ url_for('static', filename=asset_path('rsvp_list')) }}" type="text/javascript"></script>
{% endblock %}
