{% extends "layout.html.jinja2" %}
{% block title %}{% if profile %}{{ profile.title }}{% else %}{{ config['SITE_TITLE'] }}{% endif %}{% endblock %}

{% block description %}{{ config['WELCOME_MESSAGE'] }}{% endblock %}

{%- block pageheaders %}
<script type="application/ld+json">
  {  "@context" : "http://schema.org",
     "@type" : "WebSite",
     "name" : "{{ config['SITE_TITLE'] }}",
     "url" : "{{ url_for('index', _external=true) }}"
  }
</script>
<script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "Organization",
    "name" : "{{ config['SITE_TITLE'] }}",
    "url" : "{{ url_for('index', _external=true) }}",
    "logo" : "{{ url_for('static', filename='img/hg-banner.png', _external=true) }}",
    "contactPoint" : [{
      "@type" : "ContactPoint",
      "telephone" : "+91 7676 33 2020",
      "contactType" : "customer service"
    }],
    "sameAs" : [
      "https://twitter.com/hasgeek",
      "https://www.facebook.com/hasgeek"
    ]
  }
</script>
{%- endblock %}

{%- block image_src %}
  <link rel="image_src" href="{{ url_for('static', filename='img/hg-banner.png') }}" />
  <meta property="og:image" content="{{ url_for('static', filename='img/hg-banner.png') }}" />
{%- endblock %}

{% block contenthead %}{% endblock %}

{% block baseheadline %}
  {%- if not profile %}
    <div class="grid hg-banner">
      <div class="grid__col-12">
        <h1 class="headline">Discussion spaces for geeks</h1>
        <p class="mui--text-title mui--text-light">Meet like-minded people, learn new things and discover new opportunities</p>
        <div class="mui-divider mui-divider--banner"></div>
      </div>
    </div>
  {% else %}
    <div class="grid hg-banner">
      <div class="grid__col-12">
        <div class="mui--text-headline">{{ profile.description.html }}</div>
        <div class="mui-divider mui-divider--banner"></div>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block basecontent %}
  {% if featured_project or upcoming_projects|length > 0 %}
  <div class="projects-wrapper">
    <div class="mui-container">
      <div class="grid">
        {% if featured_project %}
        <div class="grid__col-xs-12 grid__col-md-4 grid__col-lg-5 spotlight">
          <h2 class="mui--text-title mui--text-light mui--text-uppercase spotlight__headline">Spotlight</h2>
          <div class="grid__cell">
            <a class="card card--small clickable-card spotlight__card" href="{{ featured_project.url_for() }}" title="{{ featured_project.title }}" aria-label="{{ featured_project.title }}">
              <div class="card__image-wrapper">
                {% if featured_project.bg_image.url %}
                  <img class="card__image js-lazyload-img" data-src="{{ featured_project.bg_image }}" alt="{{ featured_project.title }}"/>
                  <noscript>
                    <img class="card__image" src="{{ featured_project.bg_image }}" alt="{{ featured_project.title }}"/>
                  </noscript>
                {% else %}
                  <div class="card__image--default">
                    <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ featured_project.title }}"/>
                    <p class="card__image__tagline">{{ featured_project.title }}</p>
                  </div>
                {% endif %}
                {% if featured_project.calendar_weeks.weeks and featured_project.calendar_weeks.weeks|length > 0 %}
                  <div class="card__calendar mui--clearfix mui--bg-accent">
                    <div class="calendar">
                      <div class="calendar__weekdays">
                        <p class="calendar__weekdays__name calendar__weekdays__name--first mui--text-title mui--text-light"></p>
                        <div class="calendar__weekdays__name__wrapper">
                        {% for weekday in featured_project.calendar_weeks.days %}
                          <p class="calendar__weekdays__name calendar__weekdays__name--weekday mui--text-title mui--text-light">{{ weekday }}</p>
                        {% endfor %}
                        </div>
                      </div>
                      <div class="calendar__weekdays">
                        {% for week in featured_project.calendar_weeks.weeks|sort(attribute='year') %}
                          {% if loop.index == 1 %}
                            {% set month = '' -%}
                          {% else %}
                            {% set month = featured_project.calendar_weeks.weeks[loop.index-1].month -%}
                          {% endif %}
                          <div class="calendar__weekdays__month">
                            {% if month != week.month %}
                              <p class="calendar__weekdays__month__name mui--text-title mui--text-bold">{{ week.month }}</p>
                            {% else %}
                              <p class="calendar__weekdays__month__name mui--text-title mui--text-bold"> </p>
                            {% endif %}
                          </div>
                          <div class="calendar__weekdays__dates">
                            {% for date in week.dates %}
                              <p class="calendar__weekdays__dates__date {% if date[1] > 0 %}calendar__weekdays__dates__date--active mui--text-dark {% elif date[0] == featured_project.calendar_weeks.today %} calendar__weekdays__dates__date--today {% else %}mui--text-accent{% endif %}"><span class="calendar__weekdays__dates__date__text">{{ date[0][-2:] }}</span></p>
                            {% endfor %}
                            {% if loop.index == 1 %}
                              {% set year = '' -%}
                            {% else %}
                              {% set year = featured_project.calendar_weeks.weeks[loop.index-1].year -%}
                            {% endif %}
                            {% if year != week.year %}
                              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__date--year mui--text-title mui--text-bold">{{ week.year }}</p>
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>
              <div class="card__title">
                <h3 class="mui--text-display1 zero-top-margin zero-bottom-margin">{{ featured_project.title }}</h3>
                {% if featured_project.primary_venue %}<p class="mui--text-body1 zero-bottom-margin"><i class="material-icons mui--text-subhead mui--text-light mui--align-middle" aria-hidden="true" title="Project venue">place</i> {{ featured_project.primary_venue.title }}{% if featured_project.primary_venue.city %}, {{ featured_project.primary_venue.city }}{% endif %}</p>{% endif %}
              </div>
              {% if featured_project.tagline %}
                <div class="card__body">
                  <p class="mui--text-title">{{ featured_project.tagline }}</p>
                </div>
              {% endif %}
            </a>
          </div>
        </div>
        {% endif %}
        {% if upcoming_projects|length > 0 %}
        <div class="grid__col-xs-12 grid__col-md-8 grid__col-lg-7 upcoming">
          <h2 class="mui--text-title mui--text-light mui--text-uppercase">Upcoming</h2>
          <ul class="mui-list--unstyled" role="list">
          {% for project in upcoming_projects %}
            <li class="card card--upcoming" role="listitem">
              <div class="card__image-wrapper">
                {% if project.bg_image.url %}
                  <a href="{{ project.url_for() }}" data-image="{{ project.bg_image }}" aria-label="{{ project.title }}"><img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/></a>
                  <noscript>
                    <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                  </noscript>
                {% else %}
                  <div class="card__image--default">
                    <a href="{{ project.url_for() }}" aria-label="{{ project.title }}"><img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/></a>
                    <p class="card__image__tagline mui--text-body1">{{ project.title }}</p>
                  </div>
                {% endif %}
              </div>
              <div class="card__body">
                <h3 class="zero-top-margin zero-bottom-margin"><a href="{{ project.url_for() }}" class="mui--text-headline mui--text-dark">{{ project.title }}</a></h3>
                {% if project.primary_venue %}<p class="mui--text-body1 zero-top-margin zero-bottom-margin"><i class="material-icons mui--text-subhead mui--text-light mui--align-middle" aria-hidden="true" title="Project venue">place</i> {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}</p>{% endif %}
                <p class="mui--text-subhead mui--text-light zero-top-margin">{{ project.tagline }}</p>
                {% if project.calendar_weeks.weeks and project.calendar_weeks.weeks|length > 0 %}
                  <div class="card__calendar">
                    <div class="calendar">
                      <div class="calendar__weekdays">
                        <p class="calendar__weekdays__name calendar__weekdays__name--first mui--text-title mui--text-light"></p>
                        <div class="calendar__weekdays__name__wrapper">
                          {% for weekday in project.calendar_weeks.days %}
                            <p class="calendar__weekdays__name calendar__weekdays__name--weekday mui--text-title mui--text-light">{{ weekday }}</p>
                          {% endfor %}
                        </div>
                      </div>
                      <div class="calendar__weekdays">
                        {% for week in project.calendar_weeks.weeks|sort(attribute='year') %}
                          {% if loop.index == 1 %}
                            {% set month = '' -%}
                          {% else %}
                            {% set month = featured_project.calendar_weeks.weeks[loop.index-1].month -%}
                          {% endif %}
                          <div class="calendar__weekdays__month">
                            {% if month != week.month %}
                              <p class="calendar__weekdays__month__name mui--text-title mui--text-bold">{{ week.month }}</p>
                            {% else %}
                              <p class="calendar__weekdays__month__name mui--text-title mui--text-bold"> </p>
                            {% endif %}
                          </div>
                          <div class="calendar__weekdays__dates">
                            {% for date in week.dates %}
                              <p class="calendar__weekdays__dates__date {% if date[1] > 0 %}calendar__weekdays__dates__date--active mui--text-dark {% elif date[0] == project.calendar_weeks.today %} calendar__weekdays__dates__date--today {% else %}mui--text-accent{% endif %}"><span class="calendar__weekdays__dates__date__text">{{ date[0][-2:] }}</span></p>
                            {% endfor %}
                            {% if loop.index == 1 %}
                              {% set year = '' -%}
                            {% else %}
                              {% set year = project.calendar_weeks.weeks[loop.index-1].year -%}
                            {% endif %}
                            {% if year != week.year %}
                              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__date--year mui--text-title mui--text-bold">{{ week.year }}</p>
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                {% endif %}
              </div>
            </li>
          {%- endfor -%}
          </ul>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% endif %}

  {% if open_cfp_projects %}
    <div class="projects-wrapper mui--bg-accent">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-title mui--text-light mui--text-uppercase">Call for proposals open now</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in open_cfp_projects %}
            <li class="grid__col-xs-12 grid__col-lg-6 js-cfp-projects {% if loop.index > 4 %}mui--hide{% endif %}" role="listitem">
              <div class="card card--cfp">
                <a class="card__image-wrapper card__image-wrapper--cfp clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                  <div class="card__image-wrapper__overlay"></div>
                  <p class="card__image-wrapper__text"><i class="material-icons mui--pull-left mui--text-display1" aria-hidden="true">mic</i> <span class="mui--text-menu mui--pull-left">CFP <br>Now open</span></p>
                  {% if project.bg_image.url %}
                    <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    <noscript>
                      <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    </noscript>
                  {% else %}
                    <div class="card__image--default">
                      <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                      <p class="card__image__tagline mui--text-body1">{{ project.title }}</p>
                    </div>
                  {% endif %}
                </a>
                <div class="card__body card__body--cfp">
                  <h3 class="mui--text-title zero-top-margin zero-bottom-margin"><a href="{{ project.url_for() }}">{{ project.title }}</a></h3>
                  {% if project.cfp_end_at %}<p class="mui--text-caption zero-top-margin mui--text-danger">Last date of submission - {{ project.cfp_end_at|longdate }}</p>{% endif %}
                  <p class="mui--text-subhead mui--text-light zero-top-margin">{{ project.tagline }}</p>
                </a>
              </div>
            </li>
          {%- endfor -%}
        </ul>
        {% if open_cfp_projects|length > 4 %}
          <div class="mui--text-center">
            <a href="javascript:void(0)" class="jquery-show-all mui--text-uppercase" title="show all cfp projects" data-projects="js-cfp-projects" data-action="Show all cfp projects(index page card)">Show more</a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  {%- if profile and current_auth.permissions.new_project %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-title mui--text-light mui--text-uppercase">Introducing drafts <span class="chip chip--new mui--text-caption mui--align-middle">New</span></h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
            <div class="grid__cell">
              <div class="card">
                <a class="card__image-wrapper clickable-card" href="{{ g.profile.url_for('new_project')}}" title="New project" aria-label="Create new project">
                  <div class="card__image--default card__image--new">
                    <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="new"/>
                    <p class="card__image__tagline mui--text-display1">+</p>
                  </div>
                </a>
                <a class="card__title clickable-card clickable-card--padding" href="{{ g.profile.url_for('new_project')}}" title="New project" aria-label="Create new project">
                  <h4 class="mui--text-title card__title__heading mui--text-bold">Start a project</h4>
                  <p class="mui--text-caption card__title__heading">Write, collaborate and get feedback.</p>
                </a>
                <div class="mui-divider"></div>
                <div class="card__footer">
                  <a href="{{ g.profile.url_for('new_project') }}" class="mui-btn mui-btn--small mui-btn--flat mui-btn--accent" title="Participate" data-action="Participate(index page card)">Start project</a>
                </div>
              </div>
            </div>
          </li>
        {% if draft_projects %}
          {% for project in draft_projects %}
            <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4 js-draft-projects {% if loop.index > 2 %}mui--hide{% endif %}" role="listitem">
              <div class="grid__cell">
                <div class="card">
                  <a class="card__image-wrapper clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                    {% if project.bg_image.url %}
                      <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                      <noscript>
                        <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                      </noscript>
                    {% else %}
                      <div class="card__image--default">
                        <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                        <p class="card__image__tagline">{{ project.title }}</p>
                      </div>
                    {% endif %}
                  </a>
                  <a class="card__title clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                    <h3 class="mui--text-title card__title__heading">{{ project.title }}</h3>
                    <p class="mui--text-caption card__title__heading">{{ project.datelocation }}</p>
                  </a>
                  {% if project.tagline %}
                    <a class="card__body clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                      <p class="mui--text-body2 zero-bottom-margin">{{ project.tagline }}</p>
                    </a>
                  {% endif %}
                  <div class="mui-divider"></div>
                  <div class="card__footer">
                    <a href="{{ project.url_for() }}" class="mui-btn mui-btn--small mui-btn--flat mui-btn--accent" title="Publish project" data-action="Publish project">Publish project</a>
                  </div>
                </div>
              </div>
            </li>
          {%- endfor -%}
          </ul>
          {% if draft_projects|length > 3 %}
            <div class="mui--text-center">
              <a href="javascript:void(0)" class="jquery-show-all mui--text-uppercase" title="show all cfp projects" data-projects="js-draft-projects" data-action="Show all cfp projects(index page card)">Show more</a>
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
    <div class="mui-divider"></div>
  {% endif %}

  {% if all_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-title mui--text-light mui--text-uppercase">All projects</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in all_projects %}
            <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
              <div class="grid__cell">
                <a class="card clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                  {% if project.bg_image.url %}
                    <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    <noscript>
                      <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    </noscript>
                  {% else %}
                    <div class="card__image--default">
                      <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                      <p class="card__image__tagline">{{ project.title }}</p>
                    </div>
                  {% endif %}
                  {% if project.calendar_weeks.weeks and project.calendar_weeks.weeks|length > 0 %}
                  <div class="card__calendar mui--clearfix mui--bg-accent">
                    <div class="calendar">
                      <div class="calendar__weekdays">
                        <p class="calendar__weekdays__name calendar__weekdays__name--first mui--text-title mui--text-light"></p>
                        <div class="calendar__weekdays__name__wrapper">
                          {% for weekday in project.calendar_weeks.days %}
                            <p class="calendar__weekdays__name calendar__weekdays__name--weekday mui--text-title mui--text-light">{{ weekday }}</p>
                          {% endfor %}
                        </div>
                      </div>
                      <div class="calendar__weekdays">
                        {% for week in project.calendar_weeks.weeks|sort(attribute='year') %}
                          {% if loop.index == 1 %}
                            {% set month = '' -%}
                          {% else %}
                            {% set month = project.calendar_weeks.weeks[loop.index-1].month -%}
                          {% endif %}
                          <div class="calendar__weekdays__month">
                            {% if month != week.month %}
                              <p class="calendar__weekdays__month__name mui--text-title mui--text-bold">{{ week.month }}</p>
                            {% else %}
                              <p class="calendar__weekdays__month__name mui--text-title mui--text-bold"> </p>
                            {% endif %}
                          </div>
                          <div class="calendar__weekdays__dates">
                            {% for date in week.dates %}
                              <p class="calendar__weekdays__dates__date {% if date[1] > 0 %}calendar__weekdays__dates__date--active mui--text-dark {% elif date[0] == project.calendar_weeks.today %} calendar__weekdays__dates__date--today {% else %}mui--text-accent{% endif %}"><span class="calendar__weekdays__dates__date__text">{{ date[0][-2:] }}</span></p>
                            {% endfor %}
                            {% if loop.index == 1 %}
                              {% set year = '' -%}
                            {% else %}
                              {% set year = project.calendar_weeks.weeks[loop.index-1].year -%}
                            {% endif %}
                            {% if year != week.year %}
                              <p class="calendar__weekdays__dates__date calendar__weekdays__dates__date--year mui--text-title mui--text-bold">{{ week.year }}</p>
                            {% endif %}
                          </div>
                        {% endfor %}
                      </div>
                    </div>
                  </div>
                {% endif %}
                  <div class="card__title">
                    <h3 class="mui--text-display1 zero-top-margin zero-bottom-margin">{{ project.title }}</h3>
                    {% if project.primary_venue %}<p class="mui--text-body1 zero-bottom-margin"><i class="material-icons mui--text-subhead mui--text-light mui--align-middle" aria-hidden="true" title="Project venue">place</i> {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}</p>{% endif %}
                  </div>
                  {% if project.tagline %}
                    <div class="card__body">
                      <p class="mui--text-body2">{{ project.tagline }}</p>
                    </div>
                  {% endif %}
                </a>
              </div>
            </li>
          {%- endfor -%}
        </ul>
      </div>
    </div>
  {% endif %}

  {% if past_projects %}
    <div class="projects-wrapper mui--bg-accent">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-title mui--text-light mui--text-uppercase">Past projects</h2>
            <p class="mui--text-body1">{{ past_projects|length }} projects</p>
          </div>
        </div>
        <div class="grid projects">
          <div class="grid__col-12 mui-table--responsive-wrapper">
            <table class="mui-table mui-table--bordered mui-table--responsive past-events-table">
              <thead class="mui--bg-primary-light">
                <tr>
                  <th class="mui--text-subhead mui--text-capitalize">Date</th>
                  <th class="mui--text-subhead mui--text-capitalize">Event name</th>
                  <th class="mui--text-subhead mui--text-capitalize">Location</th>
                </tr>
              </thead>
              <tbody>
                {% for project in past_projects %}
                  <tr>
                    <td data-th="Date"><p class="mui--text-subhead zero-bottom-margin">{{ project.schedule_start_at|longdate }}</p></td>
                    <td data-th="Event name"><p class="mui--text-subhead zero-bottom-margin"><a href="{{ project.url_for() }}" title="{{ project.title }}" data-action="past-event(index page list)">{{ project.title }}</a></p></td>
                    <td data-th="Location">{% if project.primary_venue %}<p class="mui--text-subhead zero-bottom-margin">{{ project.primary_venue.city }}</p>{% endif %}</td>
                  </tr>
                {%- endfor -%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

{% endblock %}
