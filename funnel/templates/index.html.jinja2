{% extends "layout.html.jinja2" %}
{% block title %}{% if profile %}{{ profile.title }}{% else %}{{ config['SITE_TITLE'] }}{% endif %}{% endblock %}
{%- from "macros.html.jinja2" import calendarwidget, saveprojectform %}
{% block description %}{% if profile %}{{ profile.description.html|firstline }}{% else %}{% trans %}HasGeek creates discussion spaces for geeks. Meet like-minded people, learn new things and discover new opportunities.{% endtrans %}{% endif %}{% endblock %}

{%- block pageheaders %}
<link rel="search" type="application/opensearchdescription+xml" href="{{ url_for('opensearch') }}" title="{{ config['SITE_TITLE'] }}" />
<script type="application/ld+json">
  {
    "@context" : "http://schema.org",
     "@type" : "WebSite",
     "name" : {{ config['SITE_TITLE']|tojson }},
     "url" : {{ url_for('index', _external=true)|tojson }},
    "potentialAction": {
      "@type": "SearchAction",
      "target": "{{ url_for('SearchView_search', _external=true) }}?q={query}",
      "query-input": "required name=query"
    }
  }
</script>
<script type="application/ld+json">
  {
    "@context" : "http://schema.org",
    "@type" : "Organization",
    "name" : {{ config['SITE_TITLE']|tojson }},
    "url" : {{ url_for('index', _external=true)|tojson }},
    "logo" : {{ url_for('static', filename='img/hg-banner.png', _external=true)|tojson }},
    "contactPoint" : [{
      "@type" : "ContactPoint",
      "telephone" : "+91 7676 33 2020",
      "contactType" : "customer service"
    }],
    "sameAs" : [
      "https://twitter.com/hasgeek",
      "https://www.facebook.com/hasgeek"
    ]
  }
</script>
{%- endblock %}

{% block bodytag %}
  <body class="mui--bg-accent hg-app">
{% endblock %}

{% block contenthead %}{% endblock %}

{% block baseheadline %}
  {%- if profile %}
    <div class="mui-container">
      <div class="grid hg-banner mui--bg-accent">
        <div class="grid__col-12">
          <h2 class="mui--text-display1 mui--text-bold" data-cy="profile-title">{{ profile.title }}</h2>
          <div class="mui--text-headline">{{ profile.description.html }}</div>
          <div class="mui-divider mui-divider--banner"></div>
        </div>
      </div>
    </div>
  {% endif %}
{% endblock %}

{% block basecontent %}
  {% with current_sessions = featured_project.current_sessions() if featured_project is not none else none %}
  {% if featured_project and featured_project.livestream_urls or current_sessions and current_sessions.sessions|length > 0 %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">
              {% if not featured_project.livestream_urls and current_sessions.sessions|length > 0 %}
                {% trans %}Live schedule{% endtrans %}
              {% elif featured_project.livestream_urls and not current_sessions.sessions|length > 0 %}
                {% trans %}LiveStream{% endtrans %}
              {% elif featured_project.livestream_urls and current_sessions.sessions|length > 0 %}
                {% trans %}LiveStream and Schedule{% endtrans %}
              {% endif %}
            </h2>
          </div>
          <div class="grid__col-xs-12">
            <div class="card card--spotlight card--spotlight--live">
              <div class="card__image-wrapper">
                {% if featured_project.bg_image.url %}
                  <img class="card__image" src="{{ featured_project.bg_image }}" alt="{{ featured_project.title }}"/>
                {% else %}
                  <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ featured_project.title }}"/>
                  <p class="card__image__tagline">{{ featured_project.title }}</p>
                {% endif %}
              </div>
              <div class="card__body">
                <h3 class="mui--text-headline zero-top-margin"><a class="clickable-card" href="{{ featured_project.url_for() }}" title="{{ featured_project.title }}">{{ featured_project.title }}</a></h3>
                <p class="mui--text-title mui--text-bold hg-text">Live</p>
                {% if current_sessions.sessions|length > 0 %}
                  <p class="mui--text-title mui--text-light">{% assets "fa5-sprite" %}<svg class="fa5-icon fa5-title fa5--align-baseline" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#clock"></use></svg>{% endassets %} Session starts at {{ current_sessions.sessions[0].start_at.astimezone(featured_project.timezone).strftime('%I:%M %p') }}</p>
                {% endif %}
                <div>
                  {%- if featured_project.livestream_urls %}
                    <a class="mui-btn mui-btn--primary mui-btn--raised" title="Watch LiveStream" data-action="Watch LiveStream(homepage)" href="{{ featured_project.url_for() }}">{% trans %}Livestream{% endtrans %}</a>
                  {%- endif %}
                  {%- if current_sessions.sessions|length > 0 %}
                    <a class="mui-btn mui-btn--primary mui-btn--raised" title="Schedule" data-action="Schedule(homepage)" href="{{ featured_project.url_for('schedule') }}">{% trans %}Schedule{% endtrans %}</a>
                  {%- endif %}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}
  {% endwith %}

  {% if featured_project %}
    <div class="projects-wrapper">
      <div class="spotlight">
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              <h2 class="mui--text-display1 mui--text-bold project-headline">{% trans %}Spotlight{% endtrans %}</h2>
            </div>
          </div>
        </div>
        <div class="mui-container">
          <div class="grid">
            <div class="grid__col-12">
              <a class="card card--spotlight clickable-card" href="{{ featured_project.url_for() }}" title="{{ featured_project.title }}" aria-label="{{ featured_project.title }}">
                <div class="card__image-wrapper">
                  {% if featured_project.bg_image.url %}
                    <img class="card__image" src="{{ featured_project.bg_image }}" alt="{{ featured_project.title }}"/>
                  {% else %}
                    <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ featured_project.title }}"/>
                    <p class="card__image__tagline">{{ featured_project.title }}</p>
                  {% endif %}
                </div>
                <div class="card__body">
                  <h3 class="mui--text-headline zero-top-margin js-truncate" data-truncate-lines="3"><span class="mui--text-bold">{{ featured_project.title }}</span>{% if featured_project.tagline %}: <span class="mui--text-light">{{ featured_project.tagline }}</span>{% endif %}</h3>
                  {%- if not current_auth.is_anonymous %}
                    {% set save_form_id = "featured_" + featured_project.name %}
                    <div class="card__body__bookmark">{{ saveprojectform(featured_project, project_save_form, save_form_id) }}</div>
                  {% endif %}
                  {% if featured_project.calendar_weeks.weeks and featured_project.calendar_weeks.weeks|length > 0 %}
                    {{ calendarwidget(featured_project) }}
                  {% endif %}
                  <p class="mui--text-subhead mui--text-light">{% if featured_project.primary_venue %}
                  {% assets "fa5-sprite" %}<svg class="fa5-icon fa5-icon--caption" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#map-marker-alt"></use></svg>{% endassets %} {{ featured_project.primary_venue.title }}{% if featured_project.primary_venue.city %}, {{ featured_project.primary_venue.city }}{% endif %}{% endif %}</p>
                </div>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {%- if not profile %}
    <div class="mui-container">
      <div class="projects-wrapper">
        <div class="grid hg-about">
          <div class="grid__col-xs-12 grid__col-sm-6 grid__col-md-3 hg-about__content">
            <div class="mui--text-bold project-headline project-headline--secondary hg-about__content__txt">
              <p class="hg-about__content__txt__string">Meet <br class="mui--hidden-xs mui--hidden-sm mui--hidden-md"> like-minded <br class="mui--hidden-xs mui--hidden-sm mui--hidden-md"> people</p>
              <p class="hg-about__content__txt__string">Learn <br class="mui--hidden-xs mui--hidden-sm mui--hidden-md"> new <br class="mui--hidden-sm"> things</p>
              <p class="hg-about__content__txt__string">Discover <br class="mui--hidden-xs mui--hidden-sm mui--hidden-md"> new <br class="mui--hidden-xs mui--hidden-sm mui--hidden-md"> opportunities</p>
            </div>
            <p class="mui--text-title mui--text-light">HasGeek creates discussion spaces for geeks</p>
          </div>
          <div class="grid__col-xs-12 grid__col-sm-6 grid__col-md-6">
            <img class="hg-about__img hg-about__img--main js-hg-banner" src="" alt="{{ config['SITE_TITLE'] }}"/>
            <noscript>
              <img src="{{ url_for('static', filename='img/hg-banner-default.png') }}" alt="{{ config['SITE_TITLE'] }}" class="hg-about__img">
            </noscript>
          </div>
          <div class="grid__col-md-3 mui--hidden-xs mui--hidden-sm mui--hidden-md">
            <img class="hg-about__img hg-about__img--top js-hg-banner" src="" alt="{{ config['SITE_TITLE'] }}"/>
            <img class="hg-about__img hg-about__img--bottom js-hg-banner" src="" alt="{{ config['SITE_TITLE'] }}"/>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  {% if upcoming_projects|length > 0 %}
  <div class="projects-wrapper">
    <div class="mui-container">
      <div class="grid">
        <div class="grid__col-12">
          <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Upcoming{% endtrans %}</h2>
        </div>
      </div>
      <ul class="mui-list--unstyled grid upcoming" role="list">
      {% for project in upcoming_projects %}
        <li class="grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
          <a class="card card--upcoming clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
            <div class="card__image-wrapper">
              {% if project.bg_image.url %}
                <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                <noscript>
                  <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                </noscript>
              {% else %}
                <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                <p class="card__image__tagline mui--text-body1">{{ project.title }}</p>
              {% endif %}
            </div>
            <div class="card__body">
              {%- if not current_auth.is_anonymous %}<div class="card__body__bookmark {% if not project.calendar_weeks.weeks %} card__body__bookmark--pushup {% endif %}">{{ saveprojectform(project, project_save_form, project.name) }}</div>{% endif %}
              {% if project.calendar_weeks.weeks and project.calendar_weeks.weeks|length > 0 %}
                {{ calendarwidget(project) }}
              {% endif %}
              <h3 class="card__body__title js-truncate {% if not project.calendar_weeks.weeks %} card__body__title--smaller {% endif %}" data-truncate-lines="3"><span class="mui--text-bold">{{ project.title }}</span>: <span class="mui--text-light">{{ project.tagline }}</span></h3>
              <p class="card__body__location">{% if project.primary_venue %}{% assets "fa5-sprite" %}<svg class="fa5-icon fa5-icon--caption" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#map-marker-alt"></use></svg>{% endassets %} {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}{% endif %}</p>
            </div>
          </a>
        </li>
      {%- endfor -%}
      </ul>
    </div>
  </div>
  {% endif %}

  {% if open_cfp_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Call for proposals open now{% endtrans %}</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in open_cfp_projects %}
            <li class="grid__col-xs-12 grid__col-lg-6 js-cfp-projects {% if loop.index > 4 %}mui--hide{% endif %}" role="listitem">
              <div class="card card--cfp">
                <a class="card__image-wrapper card__image-wrapper--cfp clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}" data-cy-project="{{ project.title }}">
                  <div class="card__image-wrapper__overlay"></div>
                  <div class="card__image-wrapper__text">{% assets "fa5-sprite" %}<svg class="fa5-icon fa5-icon--display1 mui--align-middle" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#microphone-alt"></use></svg>{% endassets %} <div class="mui--d-inlineblock mui--align-middle"><p class="mui--text-menu zero-bottom-margin">CFP</p> <p class="mui--text-menu zero-bottom-margin">{% trans %}Now open{% endtrans %}</p></div></div>
                  {% if project.bg_image.url %}
                    <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    <noscript>
                      <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    </noscript>
                  {% else %}
                    <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                    <p class="card__image__tagline mui--text-body1">{{ project.title }}</p>
                  {% endif %}
                </a>
                <div class="card__body card__body--cfp">
                  <h3 class="card--cfp__title mui--text-title zero-top-margin zero-bottom-margin"><a href="{{ project.url_for() }}" class="js-truncate" data-truncate-lines="2">{{ project.title }}</a></h3>
                  {% if project.cfp_end_at %}<p class="mui--text-caption zero-top-margin mui--text-danger">Last date of submission - {{ project.cfp_end_at|longdate }}</p>{% endif %}
                  <p class="mui--text-subhead mui--text-light zero-top-margin card--cfp__tagline js-truncate-readmore" data-truncate-lines="2">{{ project.tagline }}</p>
                </div>
              </div>
            </li>
          {%- endfor -%}
        </ul>
        {% if open_cfp_projects|length > 4 %}
          <div class="mui--text-center">
            <a href="javascript:void(0)" class="jquery-show-all mui--text-uppercase" title="show all cfp projects" data-projects="js-cfp-projects" data-action="Show all cfp projects(index page card)" aria-expanded="true">{% trans %}Show more{% endtrans %}</a>
          </div>
        {% endif %}
      </div>
    </div>
  {% endif %}

  {%- if profile and current_auth.permissions.new_project %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headlinee">{% trans %}Introducing drafts{% endtrans %} <span class="chip chip--new mui--text-caption mui--align-middle">{% trans %}New{% endtrans %}</span></h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
            <a class="card card--upcoming card--new clickable-card" href="{{ g.profile.url_for('new_project')}}" title="New project" aria-label="Create new project" data-cy="new-project">
              <div class="card__image-wrapper">
                <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="new"/>
                <p class="card__image-wrapper__icon-wrapper">{% assets "fa5-sprite" %}<svg class="fa5-icon fa5-icon--display1 mui--align-middle card__image-wrapper__icon-wrapper__icon" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#plus"></use></svg>{% endassets %}</p>
              </div>
              <div class="card__body">
                <h4 class="mui--text-headline mui--text-bold">{% trans %}Start a project{% endtrans %}</h4>
                <p class="mui--text-subhead mui--text-light zero-top-margin"">{% trans %}Write, collaborate and get feedback.{% endtrans %}</p>
              </div>
              <div class="mui-divider"></div>
              <div class="card__footer">
                <p class="mui-btn mui-btn--small mui-btn--flat mui-btn--accent" title="Participate" data-action="Participate(index page card)">{% trans %}Start project{% endtrans %}</p>
              </div>
            </a>
          </li>
        {% if draft_projects %}
          {% for project in draft_projects %}
            <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4 js-draft-projects {% if loop.index > 2 %}mui--hide{% endif %}" role="listitem">
              <a class="card card--upcoming clickable-card" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                <div class="card__image-wrapper">
                  {% if project.bg_image.url %}
                    <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    <noscript>
                      <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    </noscript>
                  {% else %}
                    <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                    <p class="card__image__tagline mui--text-body1">{{ project.title }}</p>
                  {% endif %}
                </div>
                <div class="card__body">
                  {% if project.calendar_weeks.weeks and project.calendar_weeks.weeks|length > 0 %}
                    {{ calendarwidget(project) }}
                  {% endif %}
                  <h3 class="card__body__title {% if not project.calendar_weeks.weeks %} card__body__title--smaller {% endif %} js-truncate" data-truncate-lines="3"><span class="mui--text-bold">{{ project.title }}</span>: <span class="mui--text-light">{{ project.tagline }}</span></h3>
                  <p class="card__body__location">{% if project.primary_venue %}{% assets "fa5-sprite" %}<svg class="fa5-icon fa5-icon--caption" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#map-marker-alt"></use></svg>{% endassets %} {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}{% endif %}</p>
                </div>
              </a>
            </li>
          {%- endfor -%}
          </ul>
          {% if draft_projects|length > 3 %}
            <div class="mui--text-center">
              <a href="javascript:void(0)" class="jquery-show-all mui--text-uppercase" title="show all cfp projects" data-projects="js-draft-projects" data-action="Show all cfp projects(index page card)" aria-expanded="true">{% trans %}Show more{% endtrans %}</a>
            </div>
          {% endif %}
        {% endif %}
      </div>
    </div>
  {% endif %}

  {% if all_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}All projects{% endtrans %}</h2>
          </div>
        </div>
        <ul class="grid projects" role="list">
          {% for project in all_projects %}
            <li class="grid__col-12 grid__col-xs-12 grid__col-sm-6 grid__col-lg-4" role="listitem">
              <a class="card clickable-card card--upcoming" href="{{ project.url_for() }}" title="{{ project.title }}" aria-label="{{ project.title }}">
                <div class="card__image-wrapper">
                  {% if project.bg_image.url %}
                    <img class="card__image js-lazyload-img" data-src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    <noscript>
                      <img class="card__image" src="{{ project.bg_image }}" alt="{{ project.title }}"/>
                    </noscript>
                  {% else %}
                    <img class="card__image" src="{{ url_for('static', filename='img/card-background.png') }}" alt="{{ project.title }}"/>
                    <p class="card__image__tagline">{{ project.title }}</p>
                  {% endif %}
                </div>
                <div class="card__body">
                  {%- if not current_auth.is_anonymous %}<div class="card__body__bookmark {% if not project.calendar_weeks.weeks %} card__body__bookmark--pushup {% endif %}">{{ saveprojectform(project, project_save_form, project.name) }}</div>{% endif %}
                  {% if project.calendar_weeks.weeks and project.calendar_weeks.weeks|length > 0 %}
                    {{ calendarwidget(project) }}
                  {% endif %}
                  <h3 class="card__body__title {% if not project.calendar_weeks.weeks %} card__body__title--smaller {% endif %} js-truncate" data-truncate-lines="3"><span class="mui--text-bold">{{ project.title }}</span>: <span class="mui--text-light">{{ project.tagline }}</span></h3>
                  <p class="card__body__location">{% if project.primary_venue %}{% assets "fa5-sprite" %}<svg class="fa5-icon fa5-icon--caption" aria-hidden="true" role="img"><use xlink:href="{{ ASSET_URL }}#map-marker-alt"></use></svg>{% endassets %} {% if project.primary_venue.city %}{{ project.primary_venue.city }}{% else %}{{ project.primary_venue.title }}{% endif %}{% endif %}</p>
                </div>
              </a>
            </li>
          {%- endfor -%}
        </ul>
      </div>
    </div>
  {% endif %}

  {% if past_projects %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Past projects{% endtrans %}</h2>
            <p class="mui--text-body1">{{ past_projects|length }} projects</p>
          </div>
        </div>
        <div class="grid projects">
          <div class="grid__col-12 mui-table--responsive-wrapper">
            <table class="mui-table mui-table--bordered mui-table--responsive past-events-table">
              <thead class="mui--bg-primary-light">
                <tr>
                  <th class="mui--text-subhead mui--text-capitalize">{% trans %}Date{% endtrans %}</th>
                  <th class="mui--text-subhead mui--text-capitalize">{% trans %}Event name{% endtrans %}</th>
                  <th class="mui--text-subhead mui--text-capitalize">{% trans %}Location{% endtrans %}</th>
                </tr>
              </thead>
              <tbody>
                {% for project in past_projects %}
                  <tr>
                    <td data-th="Date"><p class="mui--text-subhead zero-bottom-margin">{{ project.schedule_start_at|longdate }}</p></td>
                    <td data-th="Event name"><p class="mui--text-subhead zero-bottom-margin"><a href="{{ project.url_for() }}" title="{{ project.title }}" data-action="past-event(index page list)">{{ project.title }}</a></p></td>
                    <td data-th="Location">{% if project.primary_venue %}<p class="mui--text-subhead zero-bottom-margin">{{ project.primary_venue.city }}</p>{% endif %}</td>
                  </tr>
                {%- endfor -%}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  {% endif %}

{% endblock %}

{% block footerscripts %}
  <script src="{{ url_for('static', filename=asset_path('index')) }}" type="text/javascript"></script>
  <script type="text/javascript">
    $(function() {

      var hgBannerConfig = {
        hgBannerImgList: [],
        ImgFolderPath: "{{ url_for('static', filename='img/') }}",
        defaultBanner: "{{ url_for('static', filename='img/hg-banner-default.png') }}",
      };

      {% if hg_banner %}
        hgBannerConfig.hgBannerImgList = {{ hg_banner|tojson }};
      {% endif %}

      window.HasGeek.HomeInit(hgBannerConfig);

    });
  </script>
{% endblock %}
