{% extends "layout.html.jinja2" %}
{% block title %}{{ config['SITE_TITLE'] }}{% endblock title %}
{%- from "macros.html.jinja2" import faicon, calendarwidget, saveprojectform, featured_section, upcoming_section, open_cfp_section, all_projects_section %}
{%- from "js/past_projects.js.jinja2" import past_projects_section %}

{%- block pageheaders %}
  <link rel="stylesheet" type="text/css" href="{{ built_asset('css/index.scss') }}" />
  <meta name="author" href="/humans.txt" />
  <link rel="search" type="application/opensearchdescription+xml" href="{{ url_for('opensearch') }}" title="{{ config['SITE_TITLE'] }}" />
  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
       "@type" : "WebSite",
       "name" : {{ config['SITE_TITLE']|tojson }},
       "url" : {{ url_for('index', _external=true)|tojson }},
      "potentialAction": {
        "@type": "SearchAction",
        "target": "{{ url_for('SearchView_search', _external=true) }}?q={query}",
        "query-input": "required name=query"
      }
    }
  </script>
  <script type="application/ld+json">
    {
      "@context" : "http://schema.org",
      "@type" : "Organization",
      "name" : {{ config['SITE_TITLE']|tojson }},
      "url" : {{ url_for('index', _external=true)|tojson }},
      "logo" : {{ url_for('static', filename='img/hg-banner.png', v=2, _external=true)|tojson }},
      "contactPoint" : [{
        "@type" : "ContactPoint",
        "telephone" : {{ config['SITE_SUPPORT_PHONE']|tojson }},
        "email": {{ config['SITE_SUPPORT_EMAIL']|tojson }},
        "contactType" : "customer service"
      }],
      "sameAs" : [
        "https://twitter.com/hasgeek",
        "https://www.facebook.com/hasgeek"
      ]
    }
  </script>
{%- endblock pageheaders %}

{% block bodyattrs %}class="homepage mui--bg-accent"{% endblock bodyattrs %}

{% block description -%}
  {% trans %}Explore your passions with communities of like-minded geeks{% endtrans %}
  {%- if featured_project %} {% trans %}Spotlight:{% endtrans %} {{ featured_project.title_inline }} {{ featured_project.tagline }}
  {%- endif %}
{%- endblock description %}

{% block contenthead %}
{% endblock contenthead %}

{% block baseheadline %}
{% endblock baseheadline %}

{% block basecontent %}
  <a href="{{ url_for('about') }}" class="logo-about"><span class="emoji-hand" aria-label="hidden">{{ faicon(icon='hand-point-down', icon_size='subhead', baseline=false, css_class="mui--align-middle") }} </span>{% trans %}Whatâ€™s this about?{% endtrans %}</a>
  {{ featured_section(featured_project, heading=false) }}
  {{ upcoming_section(upcoming_projects) }}

  {% if featured_profiles %}
    <div class="projects-wrapper">
      <div class="mui-container">
        <div class="grid">
          <div class="grid__col-12">
            <h2 class="mui--text-headline mui--text-bold project-headline">{% trans %}Explore communities{% endtrans %}</h2>
          </div>
        </div>
      </div>
      <div class="featured-profiles">
        <div class="mui-container">
          <ul class="grid projects flex-wrapper flex-wrapper--nowrap" role="list">
            {% for profile in featured_profiles %}
              <li class="grid__col-12 grid-no-right-padding" role="listitem">
                <div class="card profile-card">
                  <div class="card__body">
                    <div>
                      <span class="profile-avatar profile-avatar--bigger margin-auto">
                        {%- if profile.logo_url.url %}
                          <img src="{{ profile.logo_url }}"
                               alt="{{ profile.title }}"/>
                        {% else %}
                          <img src="{{ url_for('static', filename='img/default-profile-logo.png') }}"
                               alt="{{ profile.title }}"/>
                        {% endif %}
                      </span>
                    </div>
                    <h3 class="mui--text-subhead mui--text-bold top-padding margin-bottom mui--text-center">{{ profile.title }}</h3>
                    <div class="markdown js-truncate mui--text-center mui--text-caption mui--text-light bottom-padding" data-truncate-lines="3">{{ profile.tagline or profile.description }}</div>
                    <div class="profile-card__btn-wrapper">
                      <p class=" mui--text-center mui--text-caption mui--text-light top-padding margin-bottom">{% trans count=profile.published_project_count %}One project{% pluralize %}{{ count }} projects{% endtrans %}</p>
                      <a class="mui-btn mui-btn--primary mui-btn--raised full-width-btn" href="{{ profile.url_for() }} ">{% trans %}Explore{% endtrans %}</a>
                    </div>
                  </div>
                </div>
              </li>
            {%- endfor -%}
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

  {{ open_cfp_section(open_cfp_projects) }}
  {{ all_projects_section(all_projects) }}
  {{ past_projects_section() }}
{% endblock basecontent %}

{% block footerscripts %}
  <script src="{{ built_asset('index.js') }}" type="text/javascript"></script>
  <script type="text/javascript">
    $(function() {
      var homeConfig = {
        past_projects_json_url: "{{ url_for('past_projects_json') }}"
      }
      window.Hasgeek.homeInit(homeConfig);
    });

    if ('serviceWorker' in navigator) {
      caches.keys().then(function(cacheNames) {
        cacheNames.forEach(function(cacheName) {
          if(cacheName === 'routes' || cacheName.includes('workbox-precache')) {
            caches.delete(cacheName);
          }
        });
      });
    }
  </script>
{% endblock footerscripts %}
