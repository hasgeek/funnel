{% from "macros.html.jinja2" import faicon, csrf_tag %}

<link rel="stylesheet" type="text/css" href="{{ manifest('css/form.css') }}" />

<div class="modal__header">
  <a class="modal__close mui--text-dark" href="#" onclick="return false;" data-target="close modal" aria-label="{% trans %}Close{% endtrans %}" rel="modal:close" data-cy="close-modal" role="button" tabindex="0">{{ faicon(icon='times', baseline=false, icon_size='title') }}</a>
  <p class="mui--text-title text-bold mui--text-dark" id="confirm-rsvp">{{ faicon(icon='info-circle', baseline=true, icon_size='subhead') }} {% trans profile=account %}Share contact info with {{ profile }}{% endtrans %}</p>
</div>
<div class="modal__body">
  <form action="" method="post" class="mui-form form-inline" id="rsvp-form">
    {{ form.hidden_tag() }}
    {{ csrf_tag() }}

    <div class="mui-form__fields listwidget">
      <div class="mui-form__controls">
        {% if current_auth.user.views.emails_sorted()|length < 3 %}
          <div class="mui-textfield">
            <label class="mui-form__label">{% trans %}Email address{% endtrans %}</label>
            <ul>
              {% for useremail in current_auth.user.views.emails_sorted() %}
                <li>
                  <input id="useremail-{{ loop.index }}" name="email" type="radio" value="{{ useremail }}">
                  <label for="useremail-{{ loop.index }}">{{ useremail }}</label>
                </li>
              {% endfor %}
              <li>
                <input id="useremail-last" name="email" type="radio" value="no">
                <label for="useremail-last">{% trans %}Do not share{% endtrans %}</label>
              </li>
            </ul>
          </div>
        {%- else %}
          <div class="mui-select">
            <select name="email" id="shared-email">
              {% for useremail in current_auth.user.views.emails_sorted() %}
                <option value="{{ useremail }}">{{ useremail }}</option>
              {% endfor %}
              <option value="no">{% trans %}Do not share{% endtrans %}</option>
            </select>
            <label for="shared-email">{% trans %}Email address{% endtrans %}</label>
          </div>
        {%- endif %}
      </div>
    </div>

    <div class="mui-form__fields listwidget">
      <div class="mui-form__controls">
        {% if current_auth.user.views.phones_sorted()|length < 3 %}
          <div class="mui-textfield">
            <label class="mui-form__label">{% trans %}Phone number{% endtrans %}</label>
            <ul>
              {% for userphone in current_auth.user.views.phones_sorted() %}
                <li>
                  <input id="userphone-{{ loop.index }}" name="email" type="radio" value="{{ userphone }}">
                  <label for="userphone-{{ loop.index }}">{{ userphone }}</label>
                </li>
              {% endfor %}
              <li>
                <input id="userphone-last" name="email" type="radio" value="no">
                <label for="userphone-last">{% trans %}Do not share{% endtrans %}</label>
              </li>
            </ul>
          </div>
        {%- else %}
          <div class="mui-select">
            <select name="email" id="shared-email">
              {% for userphone in current_auth.user.views.phones_sorted() %}
                <option value="{{ userphone }}">{{ userphone }}</option>
              {% endfor %}
              <option value="no">{% trans %}Do not share{% endtrans %}</option>
            </select>
            <label for="shared-email">{% trans %}Phone number{% endtrans %}</label>
          </div>
        {%- endif %}
      </div>
    </div>

    <p class="mui--text-body2 top-padding zero-bottom-margin">{% trans  profile=account, url=url_for('index', _external=true) %}This allows {{ profile }} to send direct updates. {{ profile }} may also choose to contact you outside of {{ url }}{% endtrans %}</p>
    <div class="mui--text-right">
      <button class="mui-btn mui-btn--raised mui-btn--primary" type="submit" name="submit" value="yes" data-cy="confirm">{% trans %}Share{% endtrans %}</button>
    </div>
  </form>
</div>
<script src="{{ manifest('form.js') }}" type="text/javascript"></script>
